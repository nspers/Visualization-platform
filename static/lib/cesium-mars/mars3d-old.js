/*! Copyright by 火星科技 http://cesium.marsgis.cn  */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Cesium"),require("jQuery")):"function"==typeof define&&define.amd?define(["Cesium","jQuery"],t):"object"==typeof exports?exports.mars3d=t(require("Cesium"),require("jQuery")):e.mars3d=t(e.Cesium,e.jQuery)}("undefined"!=typeof self?self:this,function(__WEBPACK_EXTERNAL_MODULE_0__,__WEBPACK_EXTERNAL_MODULE_4__){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=29)}([function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_0__},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawutils=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=i(2),s={DraggerPixelSize:12,DrawPointColor:new a.default.Color.fromCssColorString("#792ae0"),MoveHeightPointColor:new a.default.Color.fromCssColorString("#d600c8"),MovePointColor:new a.default.Color.fromCssColorString("#ffff00"),DrawTooltip:"修改 坐标位置",MoveHeightTooltip:"修改 高度",MoveEllipseMajorTooltip:"修改 长半径",MoveEllipseMinorTooltip:"修改 短半径",MoveRadiusTooltip:"修改 半径",createDragger:function(e,t){var i;if(t.dragger)i=t.dragger;else{var r=a.default.defaultValue(t.position,a.default.Cartesian3.ZERO),n=t.clampToGround?a.default.HeightReference.CLAMP_TO_GROUND:a.default.HeightReference.NONE;window.viewer&&viewer.scene.mode!==a.default.SceneMode.SCENE3D&&(n=a.default.HeightReference.NONE),i=e.entities.add({position:r,point:{scale:1,color:t.color||this.DrawPointColor,pixelSize:this.DraggerPixelSize||12,outlineColor:new a.default.Color.fromCssColorString("#ffffff").withAlpha(.8),outlineWidth:2,scaleByDistance:new a.default.NearFarScalar(1e3,1,1e6,.5),heightReference:n}})}return i._isDragger=!0,i.onDrag=a.default.defaultValue(t.onDrag,null),i.horizontal=a.default.defaultValue(t.horizontal,!0),i.vertical=a.default.defaultValue(t.vertical,!1),i.verticalCtrl=a.default.defaultValue(t.vertical,!1),i},getCoordinates:function(e){for(var t=[],i=0;i<e.length;i++){var r=a.default.Cartographic.fromCartesian(e[i]),n=Number(a.default.Math.toDegrees(r.longitude).toFixed(6)),o=Number(a.default.Math.toDegrees(r.latitude).toFixed(6)),s=Number(r.height.toFixed(1));t.push([n,o,s])}return t},getMaxHeightForPositions:function(e,t){null==t&&(t=0);var i=t;if(null==e||0==e.length)return i;for(var r=(e[0],0);r<e.length;r++){var n=a.default.Cartographic.fromCartesian(e[r]);n.height>i&&(i=n.height)}return i},getPositionsWithHeight:function(e,t){if(e instanceof Array){for(var i=[],r=0;r<e.length;r++){var n=a.default.Ellipsoid.WGS84.cartesianToCartographic(e[r]),o={lon:a.default.Math.toDegrees(n.longitude),lat:a.default.Math.toDegrees(n.latitude),hgt:Math.ceil(Number(n.height)+Number(t))},s=[o.lon,o.lat,o.hgt];i=i.concat(s)}return a.default.Cartesian3.fromDegreesArrayHeights(i)}var n=a.default.Ellipsoid.WGS84.cartesianToCartographic(e),l=a.default.Math.toDegrees(n.longitude),u=a.default.Math.toDegrees(n.latitude);return a.default.Cartesian3.fromDegrees(l,u,Number(n.height)+Number(t))},getZHeightPosition:function(e,t){var i=a.default.Cartographic.fromCartesian(e),r=Number(a.default.Math.toDegrees(i.longitude)),n=Number(a.default.Math.toDegrees(i.latitude)),o=Number(i.height.toFixed(2)),s=a.default.Cartographic.fromCartesian(t),l=Number(a.default.Math.toDegrees(s.longitude)),u=Number(a.default.Math.toDegrees(s.latitude)),c=Number(s.height.toFixed(2));return o>c?a.default.Cartesian3.fromDegrees(l,u,o):a.default.Cartesian3.fromDegrees(r,n,c)},getHDistance:function(e,t){var i=this.getZHeightPosition(e,t),r=a.default.Cartographic.fromCartesian(t),n=a.default.Cartographic.fromCartesian(i),o=a.default.Cartesian3.distance(e,i);return Math.abs(Number(n.height)-Number(r.height))<.01&&(o=a.default.Cartesian3.distance(t,i)),o},getMidPosition:function(e,t){var i=a.default.Cartographic.fromCartesian(e),r=Number(a.default.Math.toDegrees(i.longitude)),n=Number(a.default.Math.toDegrees(i.latitude)),o=Number(i.height.toFixed(2)),s=a.default.Cartographic.fromCartesian(t),l=Number(a.default.Math.toDegrees(s.longitude)),u=Number(a.default.Math.toDegrees(s.latitude)),c=Number(s.height.toFixed(2)),d=(r+l)/2,h=(n+u)/2,f=(o+c)/2;return a.default.Cartesian3.fromDegrees(d,h,f)},isArray:function(e){return"object"==(void 0===e?"undefined":r(e))&&e.constructor==Array},getPositionsFromJson:function(e){if(!e)return null;switch(e.type){case"Point":var t=e.coordinates;return 1==t.length&&this.isArray(t[0])&&(t=t[0]),this.lonLatToCartesian(t);case"MultiPoint":case"LineString":return this.lonLatsToCartesians(e.coordinates);case"MultiLineString":case"Polygon":return this.lonLatsToCartesians(e.coordinates[0]);case"MultiPolygon":return this.lonLatsToCartesians(e.coordinates[0][0]);default:throw new Error("Invalid GeoJSON object.")}},lonLatToCartesian:function(e){return a.default.Cartesian3.fromDegrees(Number(e[0]),Number(e[1]),Number(e[2]||0))},lonLatsToCartesians:function(e){for(var t=[],i=0;i<e.length;i++){var r=[Number(e[i][0]),Number(e[i][1]),Number(e[i][2]||0)];t=t.concat(r)}return a.default.Cartesian3.fromDegreesArrayHeights(t)},normalizeJsonData:function(e){var t={};t.type="FeatureCollection",t.features=[];var i;if((i="string"==typeof e?JSON.parse(e):e)instanceof Array){for(var r=0;r<i.length;r++){var n={type:"Feature"};n.properties=i[r].properties||i[r].PROPERTIES,n.geometry=i[r].geometry||i[r].GEOMETRY,t.features.push(n)}return JSON.stringify(t)}if(e.features&&e.features instanceof Array)return e},normalizeBusinessData:function(e){var t={};try{t=JSON.parse(e)}catch(e){return void(0,o.alert)(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}for(var i=t.features,r=[],n=0;n<i.length;n++){var a=i[n],s={dataID:a.properties.attr.id,dataType:a.properties.attr.type,properties:a.properties,geometry:a.geometry};r.push(s)}return JSON.stringify(r)}};t.drawutils=s},function(e,t,i){"use strict";function r(e){return"number"==typeof e&&e.constructor==Number}function n(e){return"string"==typeof e&&e.constructor==String}function a(e,t){window.haoutil&&window.haoutil.alert?window.haoutil.alert(e):window.layer?layer.alert(e,{title:t||"提示",skin:"layui-layer-lan layer-mars-dialog",closeBtn:0,anim:0}):a(e)}function o(e){window.haoutil&&window.haoutil.msg?window.haoutil.msg(e):window.toastr?toastr.info(e):window.layer?layer.msg(e):a(e)}function s(){var e=location.search,t=new Object;if(-1!=e.indexOf("?"))for(var i=e.substr(1),r=i.split("&"),n=0;n<r.length;n++)t[r[n].split("=")[0]]=decodeURI(r[n].split("=")[1]);return t}function l(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?decodeURI(i[2]):null}function u(e){if(null==e||"object"!=(void 0===e?"undefined":b(e)))return e;if(e instanceof Date){var t=new Date;return t.setTime(e.getTime()),t}if(e instanceof Array){for(var t=[],i=0,r=e.length;i<r;++i)t[i]=u(e[i]);return t}if("object"===(void 0===e?"undefined":b(e))){var t={};for(var n in e)"_layer"!=n&&"_layers"!=n&&"_parent"!=n&&e.hasOwnProperty(n)&&(t[n]=u(e[n]));return t}return e}function c(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone"==e.match(/iphone/i),r="midp"==e.match(/midp/i),n="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),a="ucweb"==e.match(/ucweb/i),o="android"==e.match(/android/i),s="windows ce"==e.match(/windows ce/i),l="windows mobile"==e.match(/windows mobile/i);return!(t||i||r||n||a||o||s||l)}function d(){var e=window.navigator.userAgent.toLowerCase();if(e.indexOf("msie")>=0){var t=Number(e.match(/msie ([\d]+)/)[1]);return{type:"IE",version:t}}if(e.indexOf("firefox")>=0){var t=Number(e.match(/firefox\/([\d]+)/)[1]);return{type:"Firefox",version:t}}if(e.indexOf("chrome")>=0){var t=Number(e.match(/chrome\/([\d]+)/)[1]);return{type:"Chrome",version:t}}if(e.indexOf("opera")>=0){var t=Number(e.match(/opera.([\d]+)/)[1]);return{type:"Opera",version:t}}if(e.indexOf("Safari")>=0){var t=Number(e.match(/version\/([\d]+)/)[1]);return{type:"Safari",version:t}}return{type:e,version:-1}}function h(){var e=d();if("IE"==e.type&&e.version<11)return!1;try{var t,i=document.createElement("canvas");if("undefined"!=typeof WebGL2RenderingContext&&(t=i.getContext("webgl2")||i.getContext("experimental-webgl2")||void 0),null==t&&(t=i.getContext("webgl")||i.getContext("experimental-webgl")||void 0),null==t)return!1}catch(e){return!1}return!0}function f(e,t){var i=e.viewer,r=e.positions;if(null==r||0==r.length)return void(e.calback&&e.calback(r));for(var n=C.default.PolylinePipeline.generateArc({positions:r,granularity:e.granularity||1e-5}),a=[],o=i.scene.globe.ellipsoid,s=0;s<n.length;s+=3){var l=C.default.Cartesian3.unpack(n,s);a.push(o.cartesianToCartographic(l))}var u=C.default.Cartographic.fromCartesian(r[0]).height;C.default.when(C.default.sampleTerrain(i.terrainProvider,t||13,a),function(t){for(var n=!1,a=e.offset||2,s=0;s<t.length;++s)null==t[s].height?(n=!0,t[s].height=u):t[s].height=a+t[s].height*i.scene._terrainExaggeration;var l=o.cartographicArrayToCartesianArray(t);e.calback?e.calback(l,n):r.setValue&&r.setValue(l)})}function p(){return x}function g(e){e.hasOwnProperty("requestWaterMask")||(e.requestWaterMask=!0),e.hasOwnProperty("requestVertexNormals")||(e.requestVertexNormals=!0);return""==e.url||null==e.url||"ellipsoid"==e.url||"null"==e.url?x:new C.default.CesiumTerrainProvider(e)}function m(e,t){e=t.mars.point2map(e);var i=C.default.Cartesian3.fromDegrees(e.x,e.y,e.z||0),r=C.default.Math.toRadians(e.heading||0),n=C.default.Math.toRadians(e.pitch||0),a=C.default.Math.toRadians(e.roll||0),o=new C.default.HeadingPitchRoll(r,n,a),s=e.converter||C.default.Transforms.eastNorthUpToFixedFrame,l=C.default.Transforms.headingPitchRollQuaternion(i,o,t.scene.globe.ellipsoid,s);return t.entities.add({name:e.name||"",position:i,orientation:l,model:e,tooltip:e.tooltip,popup:e.popup})}function y(e){e=Math.abs(e);var t=Math.floor(e);return t+"° "+Math.floor(60*(e-t))+"'  "+Math.round(3600*(e-t)%60)+'"'}function v(e){var t=(new Date).getTime(),i=Number(window.localStorage.getItem("tokenTime1987")||t),r=new Date(e.start).getTime(),n=new Date(e.end).getTime();return e.hostname&&-1===window.location.hostname.indexOf(e.hostname)||t<=r||t>=n||i<=r||i>=n?(window.layer?layer.open({type:1,title:unescape("%u8BB8%u53EF%u5230%u671F%u63D0%u793A"),skin:"layer-mars-dialog",shade:[1,"#000"],closeBtn:0,resize:!1,area:["400px","150px"],content:'<div style="margin: 20px;">'+e.msg+"</div>"}):a(e.msg),!1):(window.localStorage.setItem("tokenTime1987",t),setTimeout(function(){v(e)},6e5+6e5*Math.random()),!0)}function _(e,t,i,r){var n=[],a=C.default.Cartographic.fromCartesian(e),o=C.default.Cartographic.fromCartesian(t),s=180*a.longitude/Math.PI,l=180*a.latitude/Math.PI,u=180*o.longitude/Math.PI,c=180*o.latitude/Math.PI,d=Math.sqrt((s-u)*(s-u)+(l-c)*(l-c)),h=d*i,f=C.default.Cartesian3.clone(e),p=C.default.Cartesian3.clone(t),g=C.default.Cartesian3.distance(f,C.default.Cartesian3.ZERO),m=C.default.Cartesian3.distance(p,C.default.Cartesian3.ZERO);if(C.default.Cartesian3.normalize(f,f),C.default.Cartesian3.normalize(p,p),0==C.default.Cartesian3.distance(f,p))return n;var y=C.default.Cartesian3.angleBetween(f,p);n.push(e);for(var v=1;v<r-1;v++){var _=1*v/(r-1),b=1-_,w=Math.sin(b*y)/Math.sin(y),x=Math.sin(_*y)/Math.sin(y),P=C.default.Cartesian3.multiplyByScalar(f,w,new C.default.Cartesian3),M=C.default.Cartesian3.multiplyByScalar(p,x,new C.default.Cartesian3),E=C.default.Cartesian3.add(P,M,new C.default.Cartesian3),L=_*Math.PI,S=g*b+m*_+Math.sin(L)*h;E=C.default.Cartesian3.multiplyByScalar(E,S,E),n.push(E)}return n.push(t),n}Object.defineProperty(t,"__esModule",{value:!0}),t.checkToken=t.getLinkedPointList=t.formatDegree=t.createModel=t.getTerrainProvider=t.getEllipsoidTerrain=t.terrainPolyline=t.webglreport=t.getExplorerInfo=t.clone=t.isPCBroswer=t.msg=t.alert=t.isString=t.isNumber=t.getRequestByName=t.getRequest=void 0;var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=i(0),C=function(e){return e&&e.__esModule?e:{default:e}}(w),x=new C.default.EllipsoidTerrainProvider({ellipsoid:C.default.Ellipsoid.WGS84});t.getRequest=s,t.getRequestByName=l,t.isNumber=r,t.isString=n,t.alert=a,t.msg=o,t.isPCBroswer=c,t.clone=u,t.getExplorerInfo=d,t.webglreport=h,t.terrainPolyline=f,t.getEllipsoidTerrain=p,t.getTerrainProvider=g,t.createModel=m,t.formatDegree=y,t.getLinkedPointList=_,t.checkToken=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicProperty=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new n.default.Event,this._constant=!1,this.setValue(e)};n.default.defineProperties(a.prototype,{isConstant:{get:function(){return this._constant},set:function(e){this._constant!==e&&(this._constant=e,this._definitionChanged.raiseEvent(this))}},definitionChanged:{get:function(){return this._definitionChanged}}}),a.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value},a.prototype.setValue=function(e){var t=this._value;if(t!==e){var i=n.default.defined(e),r=i&&"function"==typeof e.clone,a=i&&"function"==typeof e.equals;this._hasClone=r,this._hasEquals=a;(!a||!e.equals(t))&&(this._value=r?e.clone():e,this._definitionChanged.raiseEvent(this))}},a.prototype.equals=function(e){return this===e||e instanceof a&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))},a.prototype.valueOf=function(e){return this._value},a.prototype.toString=function(e){return String(this._value)},t.DynamicProperty=a},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_4__},function(e,t,i){"use strict";var r,n,a,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i,s){"object"===o(t)&&void 0!==e?s(t):(n=[t],r=s,void 0!==(a="function"==typeof r?r.apply(t,n):r)&&(e.exports=a))}(0,function(e){function t(e){var t,i,r,n;for(i=1,r=arguments.length;i<r;i++){n=arguments[i];for(t in n)e[t]=n[t]}return e}function i(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(i.call(arguments)):arguments)}}function r(e){return e._leaflet_id=e._leaflet_id||++$e,e._leaflet_id}function n(e,t,i){var r,n,a,o;return o=function(){r=!1,n&&(a.apply(i,n),n=!1)},a=function(){r?n=arguments:(e.apply(i,arguments),setTimeout(o,t),r=!0)}}function a(e,t,i){var r=t[1],n=t[0],a=r-n;return e===r&&i?e:((e-n)%a+a)%a+n}function s(){return!1}function l(e,t){var i=Math.pow(10,void 0===t?6:t);return Math.round(e*i)/i}function u(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function c(e){return u(e).split(/\s+/)}function d(e,t){e.hasOwnProperty("options")||(e.options=e.options?Ke(e.options):{});for(var i in t)e.options[i]=t[i];return e.options}function h(e,t,i){var r=[];for(var n in e)r.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(e[n]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}function f(e,t){return e.replace(et,function(e,i){var r=t[i];if(void 0===r)throw new Error("No value provided for variable "+e);return"function"==typeof r&&(r=r(t)),r})}function p(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function g(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}function m(e){var t=+new Date,i=Math.max(0,16-(t-it));return it=t+i,window.setTimeout(e,i)}function y(e,t,r){if(!r||rt!==m)return rt.call(window,i(e,t));e.call(t)}function v(e){e&&nt.call(window,e)}function _(){}function b(e){if("undefined"!=typeof L&&L&&L.Mixin){e=tt(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}function w(e,t,i){this.x=i?Math.round(e):e,this.y=i?Math.round(t):t}function C(e,t,i){return e instanceof w?e:tt(e)?new w(e[0],e[1]):void 0===e||null===e?e:"object"===(void 0===e?"undefined":o(e))&&"x"in e&&"y"in e?new w(e.x,e.y):new w(e,t,i)}function x(e,t){if(e)for(var i=t?[e,t]:e,r=0,n=i.length;r<n;r++)this.extend(i[r])}function P(e,t){return!e||e instanceof x?e:new x(e,t)}function M(e,t){if(e)for(var i=t?[e,t]:e,r=0,n=i.length;r<n;r++)this.extend(i[r])}function E(e,t){return e instanceof M?e:new M(e,t)}function S(e,t,i){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==i&&(this.alt=+i)}function T(e,t,i){return e instanceof S?e:tt(e)&&"object"!==o(e[0])?3===e.length?new S(e[0],e[1],e[2]):2===e.length?new S(e[0],e[1]):null:void 0===e||null===e?e:"object"===(void 0===e?"undefined":o(e))&&"lat"in e?new S(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new S(e,t,i)}function D(e,t,i,r){if(tt(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=i,this._d=r}function O(e,t,i,r){return new D(e,t,i,r)}function k(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}function A(e,t,i,r){return"touchstart"===t?I(e,i,r):"touchmove"===t?V(e,i,r):"touchend"===t&&G(e,i,r),this}function N(e,t,i){var r=e["_leaflet_"+t+i];return"touchstart"===t?e.removeEventListener(Xt,r,!1):"touchmove"===t?e.removeEventListener(Yt,r,!1):"touchend"===t&&(e.removeEventListener(Kt,r,!1),e.removeEventListener($t,r,!1)),this}function I(e,t,r){var n=i(function(e){if("mouse"!==e.pointerType&&e.MSPOINTER_TYPE_MOUSE&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE){if(!(ei.indexOf(e.target.tagName)<0))return;we(e)}H(e,t)});e["_leaflet_touchstart"+r]=n,e.addEventListener(Xt,n,!1),ii||(document.documentElement.addEventListener(Xt,R,!0),document.documentElement.addEventListener(Yt,F,!0),document.documentElement.addEventListener(Kt,j,!0),document.documentElement.addEventListener($t,j,!0),ii=!0)}function R(e){ti[e.pointerId]=e,ri++}function F(e){ti[e.pointerId]&&(ti[e.pointerId]=e)}function j(e){delete ti[e.pointerId],ri--}function H(e,t){e.touches=[];for(var i in ti)e.touches.push(ti[i]);e.changedTouches=[e],t(e)}function V(e,t,i){var r=function(e){(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||0!==e.buttons)&&H(e,t)};e["_leaflet_touchmove"+i]=r,e.addEventListener(Yt,r,!1)}function G(e,t,i){var r=function(e){H(e,t)};e["_leaflet_touchend"+i]=r,e.addEventListener(Kt,r,!1),e.addEventListener($t,r,!1)}function B(e,t,i){function r(e){var t;if(Gt){if(!bt||"mouse"===e.pointerType)return;t=ri}else t=e.touches.length;if(!(t>1)){var i=Date.now(),r=i-(a||i);o=e.touches?e.touches[0]:e,s=r>0&&r<=l,a=i}}function n(e){if(s&&!o.cancelBubble){if(Gt){if(!bt||"mouse"===e.pointerType)return;var i,r,n={};for(r in o)i=o[r],n[r]=i&&i.bind?i.bind(o):i;o=n}o.type="dblclick",t(o),a=null}}var a,o,s=!1,l=250;return e[oi+ni+i]=r,e[oi+ai+i]=n,e[oi+"dblclick"+i]=t,e.addEventListener(ni,r,!1),e.addEventListener(ai,n,!1),e.addEventListener("dblclick",t,!1),this}function z(e,t){var i=e[oi+ni+t],r=e[oi+ai+t],n=e[oi+"dblclick"+t];return e.removeEventListener(ni,i,!1),e.removeEventListener(ai,r,!1),bt||e.removeEventListener("dblclick",n,!1),this}function W(e){return"string"==typeof e?document.getElementById(e):e}function U(e,t){var i=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!i||"auto"===i)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);i=r?r[t]:null}return"auto"===i?null:i}function q(e,t,i){var r=document.createElement(e);return r.className=t||"",i&&i.appendChild(r),r}function J(e){var t=e.parentNode;t&&t.removeChild(e)}function Z(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Q(e){var t=e.parentNode;t.lastChild!==e&&t.appendChild(e)}function X(e){var t=e.parentNode;t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function Y(e,t){if(void 0!==e.classList)return e.classList.contains(t);var i=te(e);return i.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)}function K(e,t){if(void 0!==e.classList)for(var i=c(t),r=0,n=i.length;r<n;r++)e.classList.add(i[r]);else if(!Y(e,t)){var a=te(e);ee(e,(a?a+" ":"")+t)}}function $(e,t){void 0!==e.classList?e.classList.remove(t):ee(e,u((" "+te(e)+" ").replace(" "+t+" "," ")))}function ee(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function te(e){return void 0===e.className.baseVal?e.className:e.className.baseVal}function ie(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&re(e,t)}function re(e,t){var i=!1,r="DXImageTransform.Microsoft.Alpha";try{i=e.filters.item(r)}catch(e){if(1===t)return}t=Math.round(100*t),i?(i.Enabled=100!==t,i.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}function ne(e){for(var t=document.documentElement.style,i=0;i<e.length;i++)if(e[i]in t)return e[i];return!1}function ae(e,t,i){var r=t||new w(0,0);e.style[si]=(At?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")}function oe(e,t){e._leaflet_pos=t,Rt?ae(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function se(e){return e._leaflet_pos||new w(0,0)}function le(){pe(window,"dragstart",we)}function ue(){ge(window,"dragstart",we)}function ce(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(de(),di=e,hi=e.style.outline,e.style.outline="none",pe(window,"keydown",de))}function de(){di&&(di.style.outline=hi,di=void 0,hi=void 0,ge(window,"keydown",de))}function he(e){do{e=e.parentNode}while(!(e.offsetWidth&&e.offsetHeight||e===document.body));return e}function fe(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}function pe(e,t,i,r){if("object"===(void 0===t?"undefined":o(t)))for(var n in t)me(e,n,t[n],i);else{t=c(t);for(var a=0,s=t.length;a<s;a++)me(e,t[a],i,r)}return this}function ge(e,t,i,r){if("object"===(void 0===t?"undefined":o(t)))for(var n in t)ye(e,n,t[n],i);else if(t){t=c(t);for(var a=0,s=t.length;a<s;a++)ye(e,t[a],i,r)}else{for(var l in e[gi])ye(e,l,e[gi][l]);delete e[gi]}return this}function me(e,t,i,n){var a=t+r(i)+(n?"_"+r(n):"");if(e[gi]&&e[gi][a])return this;var o=function(t){return i.call(n||e,t||window.event)},s=o;Gt&&0===t.indexOf("touch")?A(e,t,o,a):!Bt||"dblclick"!==t||!B||Gt&&Lt?"addEventListener"in e?"mousewheel"===t?e.addEventListener("onwheel"in e?"wheel":"mousewheel",o,!1):"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,Le(e,t)&&s(t)},e.addEventListener("mouseenter"===t?"mouseover":"mouseout",o,!1)):("click"===t&&Ct&&(o=function(e){Se(e,s)}),e.addEventListener(t,o,!1)):"attachEvent"in e&&e.attachEvent("on"+t,o):B(e,o,a),e[gi]=e[gi]||{},e[gi][a]=o}function ye(e,t,i,n){var a=t+r(i)+(n?"_"+r(n):""),o=e[gi]&&e[gi][a];if(!o)return this;Gt&&0===t.indexOf("touch")?N(e,t,a):!Bt||"dblclick"!==t||!z||Gt&&Lt?"removeEventListener"in e?"mousewheel"===t?e.removeEventListener("onwheel"in e?"wheel":"mousewheel",o,!1):e.removeEventListener("mouseenter"===t?"mouseover":"mouseleave"===t?"mouseout":t,o,!1):"detachEvent"in e&&e.detachEvent("on"+t,o):z(e,a),e[gi][a]=null}function ve(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,Ee(e),this}function _e(e){return me(e,"mousewheel",ve),this}function be(e){return pe(e,"mousedown touchstart dblclick",ve),me(e,"click",Me),this}function we(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Ce(e){return we(e),ve(e),this}function xe(e,t){if(!t)return new w(e.clientX,e.clientY);var i=fe(t),r=i.boundingClientRect;return new w((e.clientX-r.left)/i.x-t.clientLeft,(e.clientY-r.top)/i.y-t.clientTop)}function Pe(e){return bt?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/mi:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function Me(e){yi[e.type]=!0}function Ee(e){var t=yi[e.type];return yi[e.type]=!1,t}function Le(e,t){var i=t.relatedTarget;if(!i)return!0;try{for(;i&&i!==e;)i=i.parentNode}catch(e){return!1}return i!==e}function Se(e,t){var i=e.timeStamp||e.originalEvent&&e.originalEvent.timeStamp,r=fi&&i-fi;if(r&&r>100&&r<500||e.target._simulatedClick&&!e._simulated)return void Ce(e);fi=i,t(e)}function Te(e,t){if(!t||!e.length)return e.slice();var i=t*t;return e=Ne(e,i),e=ke(e,i)}function De(e,t,i){return Math.sqrt(He(e,t,i,!0))}function Oe(e,t,i){return He(e,t,i)}function ke(e,t){var i=e.length,r=("undefined"==typeof Uint8Array?"undefined":o(Uint8Array))!==void 0+""?Uint8Array:Array,n=new r(i);n[0]=n[i-1]=1,Ae(e,n,t,0,i-1);var a,s=[];for(a=0;a<i;a++)n[a]&&s.push(e[a]);return s}function Ae(e,t,i,r,n){var a,o,s,l=0;for(o=r+1;o<=n-1;o++)(s=He(e[o],e[r],e[n],!0))>l&&(a=o,l=s);l>i&&(t[a]=1,Ae(e,t,i,r,a),Ae(e,t,i,a,n))}function Ne(e,t){for(var i=[e[0]],r=1,n=0,a=e.length;r<a;r++)je(e[r],e[n])>t&&(i.push(e[r]),n=r);return n<a-1&&i.push(e[a-1]),i}function Ie(e,t,i,r,n){var a,o,s,l=r?wi:Fe(e,i),u=Fe(t,i);for(wi=u;;){if(!(l|u))return[e,t];if(l&u)return!1;a=l||u,o=Re(e,t,a,i,n),s=Fe(o,i),a===l?(e=o,l=s):(t=o,u=s)}}function Re(e,t,i,r,n){var a,o,s=t.x-e.x,l=t.y-e.y,u=r.min,c=r.max;return 8&i?(a=e.x+s*(c.y-e.y)/l,o=c.y):4&i?(a=e.x+s*(u.y-e.y)/l,o=u.y):2&i?(a=c.x,o=e.y+l*(c.x-e.x)/s):1&i&&(a=u.x,o=e.y+l*(u.x-e.x)/s),new w(a,o,n)}function Fe(e,t){var i=0;return e.x<t.min.x?i|=1:e.x>t.max.x&&(i|=2),e.y<t.min.y?i|=4:e.y>t.max.y&&(i|=8),i}function je(e,t){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}function He(e,t,i,r){var n,a=t.x,o=t.y,s=i.x-a,l=i.y-o,u=s*s+l*l;return u>0&&(n=((e.x-a)*s+(e.y-o)*l)/u,n>1?(a=i.x,o=i.y):n>0&&(a+=s*n,o+=l*n)),s=e.x-a,l=e.y-o,r?s*s+l*l:new w(a,o)}function Ve(e){return!tt(e[0])||"object"!==o(e[0][0])&&void 0!==e[0][0]}function Ge(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ve(e)}function Be(e,t,i){var r,n,a,o,s,l,u,c,d,h=[1,4,2,8];for(n=0,u=e.length;n<u;n++)e[n]._code=Fe(e[n],t);for(o=0;o<4;o++){for(c=h[o],r=[],n=0,u=e.length,a=u-1;n<u;a=n++)s=e[n],l=e[a],s._code&c?l._code&c||(d=Re(l,s,c,t,i),d._code=Fe(d,t),r.push(d)):(l._code&c&&(d=Re(l,s,c,t,i),d._code=Fe(d,t),r.push(d)),r.push(s));e=r}return e}function ze(e,t){var i,r,n,a,o="Feature"===e.type?e.geometry:e,s=o?o.coordinates:null,l=[],u=t&&t.pointToLayer,c=t&&t.coordsToLatLng||We;if(!s&&!o)return null;switch(o.type){case"Point":return i=c(s),u?u(e,i):new Gi(i);case"MultiPoint":for(n=0,a=s.length;n<a;n++)i=c(s[n]),l.push(u?u(e,i):new Gi(i));return new Fi(l);case"LineString":case"MultiLineString":return r=Ue(s,"LineString"===o.type?0:1,c),new Ui(r,t);case"Polygon":case"MultiPolygon":return r=Ue(s,"Polygon"===o.type?1:2,c),new qi(r,t);case"GeometryCollection":for(n=0,a=o.geometries.length;n<a;n++){var d=ze({geometry:o.geometries[n],type:"Feature",properties:e.properties},t);d&&l.push(d)}return new Fi(l);default:throw new Error("Invalid GeoJSON object.")}}function We(e){return new S(e[1],e[0],e[2])}function Ue(e,t,i){for(var r,n=[],a=0,o=e.length;a<o;a++)r=t?Ue(e[a],t-1,i):(i||We)(e[a]),n.push(r);return n}function qe(e,t){return t="number"==typeof t?t:6,void 0!==e.alt?[l(e.lng,t),l(e.lat,t),l(e.alt,t)]:[l(e.lng,t),l(e.lat,t)]}function Je(e,t,i,r){for(var n=[],a=0,o=e.length;a<o;a++)n.push(t?Je(e[a],t-1,i,r):qe(e[a],r));return!t&&i&&n.push(n[0]),n}function Ze(e,i){return e.feature?t({},e.feature,{geometry:i}):Qe(i)}function Qe(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}function Xe(e,t){return new Ji(e,t)}var Ye=Object.freeze;Object.freeze=function(e){return e};var Ke=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),$e=0,et=/\{ *([\w_-]+) *\}/g,tt=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},it=0,rt=window.requestAnimationFrame||g("RequestAnimationFrame")||m,nt=window.cancelAnimationFrame||g("CancelAnimationFrame")||g("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)},at=(Object.freeze||Object)({freeze:Ye,extend:t,create:Ke,bind:i,lastId:$e,stamp:r,throttle:n,wrapNum:a,falseFn:s,formatNum:l,trim:u,splitWords:c,setOptions:d,getParamString:h,template:f,isArray:tt,indexOf:p,emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",requestFn:rt,cancelFn:nt,requestAnimFrame:y,cancelAnimFrame:v});_.extend=function(e){var i=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=i.__super__=this.prototype,n=Ke(r);n.constructor=i,i.prototype=n;for(var a in this)this.hasOwnProperty(a)&&"prototype"!==a&&"__super__"!==a&&(i[a]=this[a]);return e.statics&&(t(i,e.statics),delete e.statics),e.includes&&(b(e.includes),t.apply(null,[n].concat(e.includes)),delete e.includes),n.options&&(e.options=t(Ke(n.options),e.options)),t(n,e),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=n._initHooks.length;e<t;e++)n._initHooks[e].call(this)}},i},_.include=function(e){return t(this.prototype,e),this},_.mergeOptions=function(e){return t(this.prototype.options,e),this},_.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var ot={on:function(e,t,i){if("object"===(void 0===e?"undefined":o(e)))for(var r in e)this._on(r,e[r],t);else{e=c(e);for(var n=0,a=e.length;n<a;n++)this._on(e[n],t,i)}return this},off:function(e,t,i){if(e)if("object"===(void 0===e?"undefined":o(e)))for(var r in e)this._off(r,e[r],t);else{e=c(e);for(var n=0,a=e.length;n<a;n++)this._off(e[n],t,i)}else delete this._events;return this},_on:function(e,t,i){this._events=this._events||{};var r=this._events[e];r||(r=[],this._events[e]=r),i===this&&(i=void 0);for(var n={fn:t,ctx:i},a=r,o=0,s=a.length;o<s;o++)if(a[o].fn===t&&a[o].ctx===i)return;a.push(n)},_off:function(e,t,i){var r,n,a;if(this._events&&(r=this._events[e])){if(!t){for(n=0,a=r.length;n<a;n++)r[n].fn=s;return void delete this._events[e]}if(i===this&&(i=void 0),r)for(n=0,a=r.length;n<a;n++){var o=r[n];if(o.ctx===i&&o.fn===t)return o.fn=s,this._firingCount&&(this._events[e]=r=r.slice()),void r.splice(n,1)}}},fire:function(e,i,r){if(!this.listens(e,r))return this;var n=t({},i,{type:e,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var a=this._events[e];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var l=a[o];l.fn.call(l.ctx||this,n)}this._firingCount--}}return r&&this._propagateEvent(n),this},listens:function(e,t){var i=this._events&&this._events[e];if(i&&i.length)return!0;if(t)for(var r in this._eventParents)if(this._eventParents[r].listens(e,t))return!0;return!1},once:function(e,t,r){if("object"===(void 0===e?"undefined":o(e))){for(var n in e)this.once(n,e[n],t);return this}var a=i(function(){this.off(e,t,r).off(e,a,r)},this);return this.on(e,t,r).on(e,a,r)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[r(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[r(e)],this},_propagateEvent:function(e){for(var i in this._eventParents)this._eventParents[i].fire(e.type,t({layer:e.target,propagatedFrom:e.target},e),!0)}};ot.addEventListener=ot.on,ot.removeEventListener=ot.clearAllEventListeners=ot.off,ot.addOneTimeEventListener=ot.once,ot.fireEvent=ot.fire,ot.hasEventListeners=ot.listens;var st=_.extend(ot),lt=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};w.prototype={clone:function(){return new w(this.x,this.y)},add:function(e){return this.clone()._add(C(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(C(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new w(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new w(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=lt(this.x),this.y=lt(this.y),this},distanceTo:function(e){e=C(e);var t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},equals:function(e){return e=C(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=C(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+l(this.x)+", "+l(this.y)+")"}},x.prototype={extend:function(e){return e=C(e),this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},getCenter:function(e){return new w((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new w(this.min.x,this.max.y)},getTopRight:function(){return new w(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,i;return e="number"==typeof e[0]||e instanceof w?C(e):P(e),e instanceof x?(t=e.min,i=e.max):t=i=e,t.x>=this.min.x&&i.x<=this.max.x&&t.y>=this.min.y&&i.y<=this.max.y},intersects:function(e){e=P(e);var t=this.min,i=this.max,r=e.min,n=e.max,a=n.x>=t.x&&r.x<=i.x,o=n.y>=t.y&&r.y<=i.y;return a&&o},overlaps:function(e){e=P(e);var t=this.min,i=this.max,r=e.min,n=e.max,a=n.x>t.x&&r.x<i.x,o=n.y>t.y&&r.y<i.y;return a&&o},isValid:function(){return!(!this.min||!this.max)}},M.prototype={extend:function(e){var t,i,r=this._southWest,n=this._northEast;if(e instanceof S)t=e,i=e;else{if(!(e instanceof M))return e?this.extend(T(e)||E(e)):this;if(t=e._southWest,i=e._northEast,!t||!i)return this}return r||n?(r.lat=Math.min(t.lat,r.lat),r.lng=Math.min(t.lng,r.lng),n.lat=Math.max(i.lat,n.lat),n.lng=Math.max(i.lng,n.lng)):(this._southWest=new S(t.lat,t.lng),this._northEast=new S(i.lat,i.lng)),this},pad:function(e){var t=this._southWest,i=this._northEast,r=Math.abs(t.lat-i.lat)*e,n=Math.abs(t.lng-i.lng)*e;return new M(new S(t.lat-r,t.lng-n),new S(i.lat+r,i.lng+n))},getCenter:function(){return new S((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new S(this.getNorth(),this.getWest())},getSouthEast:function(){return new S(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"==typeof e[0]||e instanceof S||"lat"in e?T(e):E(e);var t,i,r=this._southWest,n=this._northEast;return e instanceof M?(t=e.getSouthWest(),i=e.getNorthEast()):t=i=e,t.lat>=r.lat&&i.lat<=n.lat&&t.lng>=r.lng&&i.lng<=n.lng},intersects:function(e){e=E(e);var t=this._southWest,i=this._northEast,r=e.getSouthWest(),n=e.getNorthEast(),a=n.lat>=t.lat&&r.lat<=i.lat,o=n.lng>=t.lng&&r.lng<=i.lng;return a&&o},overlaps:function(e){e=E(e);var t=this._southWest,i=this._northEast,r=e.getSouthWest(),n=e.getNorthEast(),a=n.lat>t.lat&&r.lat<i.lat,o=n.lng>t.lng&&r.lng<i.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=E(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},S.prototype={equals:function(e,t){return!!e&&(e=T(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+l(this.lat,e)+", "+l(this.lng,e)+")"},distanceTo:function(e){return ct.distance(this,T(e))},wrap:function(){return ct.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return E([this.lat-t,this.lng-i],[this.lat+t,this.lng+i])},clone:function(){return new S(this.lat,this.lng,this.alt)}};var ut={latLngToPoint:function(e,t){var i=this.projection.project(e),r=this.scale(t);return this.transformation._transform(i,r)},pointToLatLng:function(e,t){var i=this.scale(t),r=this.transformation.untransform(e,i);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,i=this.scale(e);return new x(this.transformation.transform(t.min,i),this.transformation.transform(t.max,i))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?a(e.lng,this.wrapLng,!0):e.lng;return new S(this.wrapLat?a(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),i=this.wrapLatLng(t),r=t.lat-i.lat,n=t.lng-i.lng;if(0===r&&0===n)return e;var a=e.getSouthWest(),o=e.getNorthEast();return new M(new S(a.lat-r,a.lng-n),new S(o.lat-r,o.lng-n))}},ct=t({},ut,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var i=Math.PI/180,r=e.lat*i,n=t.lat*i,a=Math.sin((t.lat-e.lat)*i/2),o=Math.sin((t.lng-e.lng)*i/2),s=a*a+Math.cos(r)*Math.cos(n)*o*o,l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*l}}),dt={R:6378137,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,i=this.MAX_LATITUDE,r=Math.max(Math.min(i,e.lat),-i),n=Math.sin(r*t);return new w(this.R*e.lng*t,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(e){var t=180/Math.PI;return new S((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=6378137*Math.PI;return new x([-e,-e],[e,e])}()};D.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new w((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var ht,ft,pt,gt=t({},ct,{code:"EPSG:3857",projection:dt,transformation:function(){var e=.5/(Math.PI*dt.R);return O(e,.5,-e,.5)}()}),mt=t({},gt,{code:"EPSG:900913"}),yt=document.documentElement.style,vt="ActiveXObject"in window,_t=vt&&!document.addEventListener,bt="msLaunchUri"in navigator&&!("documentMode"in document),wt=k("webkit"),Ct=k("android"),xt=k("android 2")||k("android 3"),Pt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Mt=Ct&&k("Google")&&Pt<537&&!("AudioNode"in window),Et=!!window.opera,Lt=k("chrome"),St=k("gecko")&&!wt&&!Et&&!vt,Tt=!Lt&&k("safari"),Dt=k("phantom"),Ot="OTransition"in yt,kt=0===navigator.platform.indexOf("Win"),At=vt&&"transition"in yt,Nt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!xt,It="MozPerspective"in yt,Rt=!window.L_DISABLE_3D&&(At||Nt||It)&&!Ot&&!Dt,Ft="undefined"!=typeof orientation||k("mobile"),jt=Ft&&wt,Ht=Ft&&Nt,Vt=!window.PointerEvent&&window.MSPointerEvent,Gt=!(!window.PointerEvent&&!Vt),Bt=!window.L_NO_TOUCH&&(Gt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),zt=Ft&&Et,Wt=Ft&&St,Ut=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,qt=function(){return!!document.createElement("canvas").getContext}(),Jt=!(!document.createElementNS||!function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}("svg").createSVGRect),Zt=!Jt&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===o(t.adj)}catch(e){return!1}}(),Qt=(Object.freeze||Object)({ie:vt,ielt9:_t,edge:bt,webkit:wt,android:Ct,android23:xt,androidStock:Mt,opera:Et,chrome:Lt,gecko:St,safari:Tt,phantom:Dt,opera12:Ot,win:kt,ie3d:At,webkit3d:Nt,gecko3d:It,any3d:Rt,mobile:Ft,mobileWebkit:jt,mobileWebkit3d:Ht,msPointer:Vt,pointer:Gt,touch:Bt,mobileOpera:zt,mobileGecko:Wt,retina:Ut,canvas:qt,svg:Jt,vml:Zt}),Xt=Vt?"MSPointerDown":"pointerdown",Yt=Vt?"MSPointerMove":"pointermove",Kt=Vt?"MSPointerUp":"pointerup",$t=Vt?"MSPointerCancel":"pointercancel",ei=["INPUT","SELECT","OPTION"],ti={},ii=!1,ri=0,ni=Vt?"MSPointerDown":Gt?"pointerdown":"touchstart",ai=Vt?"MSPointerUp":Gt?"pointerup":"touchend",oi="_leaflet_",si=ne(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),li=ne(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ui="webkitTransition"===li||"OTransition"===li?li+"End":"transitionend";if("onselectstart"in document)ht=function(){pe(window,"selectstart",we)},ft=function(){ge(window,"selectstart",we)};else{var ci=ne(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ht=function(){if(ci){var e=document.documentElement.style;pt=e[ci],e[ci]="none"}},ft=function(){ci&&(document.documentElement.style[ci]=pt,pt=void 0)}}var di,hi,fi,pi=(Object.freeze||Object)({TRANSFORM:si,TRANSITION:li,TRANSITION_END:ui,get:W,getStyle:U,create:q,remove:J,empty:Z,toFront:Q,toBack:X,hasClass:Y,addClass:K,removeClass:$,setClass:ee,getClass:te,setOpacity:ie,testProp:ne,setTransform:ae,setPosition:oe,getPosition:se,disableTextSelection:ht,enableTextSelection:ft,disableImageDrag:le,enableImageDrag:ue,preventOutline:ce,restoreOutline:de,getSizedParentNode:he,getScale:fe}),gi="_leaflet_events",mi=kt&&Lt?2*window.devicePixelRatio:St?window.devicePixelRatio:1,yi={},vi=(Object.freeze||Object)({on:pe,off:ge,stopPropagation:ve,disableScrollPropagation:_e,disableClickPropagation:be,preventDefault:we,stop:Ce,getMousePosition:xe,getWheelDelta:Pe,fakeStop:Me,skipped:Ee,isExternalTarget:Le,addListener:pe,removeListener:ge}),_i=st.extend({run:function(e,t,i,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=se(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=y(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,i=1e3*this._duration;t<i?this._runFrame(this._easeOut(t/i),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var i=this._startPos.add(this._offset.multiplyBy(e));t&&i._round(),oe(this._el,i),this.fire("step")},_complete:function(){v(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),bi=_.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});bi.addTo=function(e,t){return e.addHandler(t,this),this};var wi,Ci={Events:ot},xi=Bt?"touchstart mousedown":"mousedown",Pi={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Mi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Ei=st.extend({options:{clickTolerance:3},initialize:function(e,t,i,r){d(this,r),this._element=e,this._dragStartTarget=t||e,this._preventOutline=i},enable:function(){this._enabled||(pe(this._dragStartTarget,xi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ei._dragging===this&&this.finishDrag(),ge(this._dragStartTarget,xi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(!e._simulated&&this._enabled&&(this._moved=!1,!Y(this._element,"leaflet-zoom-anim")&&!(Ei._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||(Ei._dragging=this,this._preventOutline&&ce(this._element),le(),ht(),this._moving)))){this.fire("down");var t=e.touches?e.touches[0]:e,i=he(this._element);this._startPoint=new w(t.clientX,t.clientY),this._parentScale=fe(i),pe(document,Mi[e.type],this._onMove,this),pe(document,Pi[e.type],this._onUp,this)}},_onMove:function(e){if(!e._simulated&&this._enabled){if(e.touches&&e.touches.length>1)return void(this._moved=!0);var t=e.touches&&1===e.touches.length?e.touches[0]:e,i=new w(t.clientX,t.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,we(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=se(this._element).subtract(i),K(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),K(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,v(this._animRequest),this._lastEvent=e,this._animRequest=y(this._updatePosition,this,!0)))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),oe(this._element,this._newPos),this.fire("drag",e)},_onUp:function(e){!e._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){$(document.body,"leaflet-dragging"),this._lastTarget&&($(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var e in Mi)ge(document,Mi[e],this._onMove,this),ge(document,Pi[e],this._onUp,this);ue(),ft(),this._moved&&this._moving&&(v(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,Ei._dragging=!1}}),Li=(Object.freeze||Object)({simplify:Te,pointToSegmentDistance:De,closestPointOnSegment:Oe,clipSegment:Ie,_getEdgeIntersection:Re,_getBitCode:Fe,_sqClosestPointOnSegment:He,isFlat:Ve,_flat:Ge}),Si=(Object.freeze||Object)({clipPolygon:Be}),Ti={project:function(e){return new w(e.lng,e.lat)},unproject:function(e){return new S(e.y,e.x)},bounds:new x([-180,-90],[180,90])},Di={R:6378137,R_MINOR:6356752.314245179,bounds:new x([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,i=this.R,r=e.lat*t,n=this.R_MINOR/i,a=Math.sqrt(1-n*n),o=a*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/Math.pow((1-o)/(1+o),a/2);return r=-i*Math.log(Math.max(s,1e-10)),new w(e.lng*t*i,r)},unproject:function(e){for(var t,i=180/Math.PI,r=this.R,n=this.R_MINOR/r,a=Math.sqrt(1-n*n),o=Math.exp(-e.y/r),s=Math.PI/2-2*Math.atan(o),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)t=a*Math.sin(s),t=Math.pow((1-t)/(1+t),a/2),u=Math.PI/2-2*Math.atan(o*t)-s,s+=u;return new S(s*i,e.x*i/r)}},Oi=(Object.freeze||Object)({LonLat:Ti,Mercator:Di,SphericalMercator:dt}),ki=t({},ct,{code:"EPSG:3395",projection:Di,transformation:function(){var e=.5/(Math.PI*Di.R);return O(e,.5,-e,.5)}()}),Ai=t({},ct,{code:"EPSG:4326",projection:Ti,transformation:O(1/180,1,-1/180,.5)}),Ni=t({},ut,{projection:Ti,transformation:O(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var i=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(i*i+r*r)},infinite:!0});ut.Earth=ct,ut.EPSG3395=ki,ut.EPSG3857=gt,ut.EPSG900913=mt,ut.EPSG4326=Ai,ut.Simple=Ni;var Ii=st.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[r(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[r(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var i=this.getEvents();t.on(i,this),this.once("remove",function(){t.off(i,this)},this)}this.onAdd(t),this.getAttribution&&t.attributionControl&&t.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),t.fire("layeradd",{layer:this})}}}),Ri=Ii.extend({initialize:function(e,t){d(this,t),this._layers={};var i,r;if(e)for(i=0,r=e.length;i<r;i++)this.addLayer(e[i])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return!!e&&(e in this._layers||this.getLayerId(e)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,i,r=Array.prototype.slice.call(arguments,1);for(t in this._layers)i=this._layers[t],i[e]&&i[e].apply(i,r);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var i in this._layers)e.call(t,this._layers[i]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return r(e)}}),Fi=Ri.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Ri.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Ri.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new M;for(var t in this._layers){var i=this._layers[t];e.extend(i.getBounds?i.getBounds():i.getLatLng())}return e}}),ji=_.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(e){d(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var i=this._getIconUrl(e);if(!i){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(i,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(r,e),r},_setIconStyles:function(e,t){var i=this.options,r=i[t+"Size"];"number"==typeof r&&(r=[r,r]);var n=C(r),a=C("shadow"===t&&i.shadowAnchor||i.iconAnchor||n&&n.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(i.className||""),a&&(e.style.marginLeft=-a.x+"px",e.style.marginTop=-a.y+"px"),n&&(e.style.width=n.x+"px",e.style.height=n.y+"px")},_createImg:function(e,t){return t=t||document.createElement("img"),t.src=e,t},_getIconUrl:function(e){return Ut&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}}),Hi=ji.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return Hi.imagePath||(Hi.imagePath=this._detectIconPath()),(this.options.imagePath||Hi.imagePath)+ji.prototype._getIconUrl.call(this,e)},_detectIconPath:function(){var e=q("div","leaflet-default-icon-path",document.body),t=U(e,"background-image")||U(e,"backgroundImage");return document.body.removeChild(e),t=null===t||0!==t.indexOf("url")?"":t.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),Vi=bi.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Ei(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),K(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&$(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,i=t._map,r=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,a=se(t._icon),o=i.getPixelBounds(),s=i.getPixelOrigin(),l=P(o.min._subtract(s).add(n),o.max._subtract(s).subtract(n));if(!l.contains(a)){var u=C((Math.max(l.max.x,a.x)-l.max.x)/(o.max.x-l.max.x)-(Math.min(l.min.x,a.x)-l.min.x)/(o.min.x-l.min.x),(Math.max(l.max.y,a.y)-l.max.y)/(o.max.y-l.max.y)-(Math.min(l.min.y,a.y)-l.min.y)/(o.min.y-l.min.y)).multiplyBy(r);i.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),oe(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=y(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(v(this._panRequest),this._panRequest=y(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,i=t._shadow,r=se(t._icon),n=t._map.layerPointToLatLng(r);i&&oe(i,r),t._latlng=n,e.latlng=n,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){v(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Gi=Ii.extend({options:{icon:new Hi,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){d(this,t),this._latlng=T(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=T(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=e.icon.createIcon(this._icon),r=!1;i!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(i.title=e.title),"IMG"===i.tagName&&(i.alt=e.alt||"")),K(i,t),e.keyboard&&(i.tabIndex="0"),this._icon=i,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var n=e.icon.createShadow(this._shadow),a=!1;n!==this._shadow&&(this._removeShadow(),a=!0),n&&(K(n,t),n.alt=""),this._shadow=n,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&a&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),J(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&J(this._shadow),this._shadow=null},_setPos:function(e){oe(this._icon,e),this._shadow&&oe(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon.style.zIndex=this._zIndex+e},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(K(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Vi)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Vi(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;ie(this._icon,e),this._shadow&&ie(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Bi=Ii.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return d(this,e),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),zi=Bi.extend({options:{fill:!0,radius:10},initialize:function(e,t){d(this,t),this._latlng=T(e),this._radius=this.options.radius},setLatLng:function(e){return this._latlng=T(e),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return Bi.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,i=this._clickTolerance(),r=[e+i,t+i];this._pxBounds=new x(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Wi=zi.extend({initialize:function(e,i,r){if("number"==typeof i&&(i=t({},r,{radius:i})),d(this,i),this._latlng=T(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new M(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Bi.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,i=this._map,r=i.options.crs;if(r.distance===ct.distance){var n=Math.PI/180,a=this._mRadius/ct.R/n,o=i.project([t+a,e]),s=i.project([t-a,e]),l=o.add(s).divideBy(2),u=i.unproject(l).lat,c=Math.acos((Math.cos(a*n)-Math.sin(t*n)*Math.sin(u*n))/(Math.cos(t*n)*Math.cos(u*n)))/n;(isNaN(c)||0===c)&&(c=a/Math.cos(Math.PI/180*t)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-i.project([u,e-c]).x,this._radiusY=l.y-o.y}else{var d=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(d).x}this._updateBounds()}}),Ui=Bi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){d(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,i,r=1/0,n=null,a=He,o=0,s=this._parts.length;o<s;o++)for(var l=this._parts[o],u=1,c=l.length;u<c;u++){t=l[u-1],i=l[u];var d=a(e,t,i,!0);d<r&&(r=d,n=a(e,t,i))}return n&&(n.distance=Math.sqrt(r)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,i,r,n,a,o,s=this._rings[0],l=s.length;if(!l)return null;for(e=0,t=0;e<l-1;e++)t+=s[e].distanceTo(s[e+1])/2;if(0===t)return this._map.layerPointToLatLng(s[0]);for(e=0,r=0;e<l-1;e++)if(n=s[e],a=s[e+1],i=n.distanceTo(a),(r+=i)>t)return o=(r-t)/i,this._map.layerPointToLatLng([a.x-o*(a.x-n.x),a.y-o*(a.y-n.y)])},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=T(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new M,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Ve(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],i=Ve(e),r=0,n=e.length;r<n;r++)i?(t[r]=T(e[r]),this._bounds.extend(t[r])):t[r]=this._convertLatLngs(e[r]);return t},_project:function(){var e=new x;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e);var t=this._clickTolerance(),i=new w(t,t);this._bounds.isValid()&&e.isValid()&&(e.min._subtract(i),e.max._add(i),this._pxBounds=e)},_projectLatlngs:function(e,t,i){var r,n,a=e[0]instanceof S,o=e.length;if(a){for(n=[],r=0;r<o;r++)n[r]=this._map.latLngToLayerPoint(e[r]),i.extend(n[r]);t.push(n)}else for(r=0;r<o;r++)this._projectLatlngs(e[r],t,i)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e)){if(this.options.noClip)return void(this._parts=this._rings);var t,i,r,n,a,o,s,l=this._parts;for(t=0,r=0,n=this._rings.length;t<n;t++)for(s=this._rings[t],i=0,a=s.length;i<a-1;i++)(o=Ie(s[i],s[i+1],e,i,!0))&&(l[r]=l[r]||[],l[r].push(o[0]),o[1]===s[i+1]&&i!==a-2||(l[r].push(o[1]),r++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,i=0,r=e.length;i<r;i++)e[i]=Te(e[i],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var i,r,n,a,o,s,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,a=this._parts.length;i<a;i++)for(s=this._parts[i],r=0,o=s.length,n=o-1;r<o;n=r++)if((t||0!==r)&&De(e,s[n],s[r])<=l)return!0;return!1}});Ui._flat=Ge;var qi=Ui.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var e,t,i,r,n,a,o,s,l,u=this._rings[0],c=u.length;if(!c)return null;for(a=o=s=0,e=0,t=c-1;e<c;t=e++)i=u[e],r=u[t],n=i.y*r.x-r.y*i.x,o+=(i.x+r.x)*n,s+=(i.y+r.y)*n,a+=3*n;return l=0===a?u[0]:[o/a,s/a],this._map.layerPointToLatLng(l)},_convertLatLngs:function(e){var t=Ui.prototype._convertLatLngs.call(this,e),i=t.length;return i>=2&&t[0]instanceof S&&t[0].equals(t[i-1])&&t.pop(),t},_setLatLngs:function(e){Ui.prototype._setLatLngs.call(this,e),Ve(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ve(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,i=new w(t,t);if(e=new x(e.min.subtract(i),e.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e)){if(this.options.noClip)return void(this._parts=this._rings);for(var r,n=0,a=this._rings.length;n<a;n++)r=Be(this._rings[n],e,!0),r.length&&this._parts.push(r)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,i,r,n,a,o,s,l,u=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,s=this._parts.length;n<s;n++)for(t=this._parts[n],a=0,l=t.length,o=l-1;a<l;o=a++)i=t[a],r=t[o],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(u=!u);return u||Ui.prototype._containsPoint.call(this,e,!0)}}),Ji=Fi.extend({initialize:function(e,t){d(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,i,r,n=tt(e)?e:e.features;if(n){for(t=0,i=n.length;t<i;t++)r=n[t],(r.geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var a=this.options;if(a.filter&&!a.filter(e))return this;var o=ze(e,a);return o?(o.feature=Qe(e),o.defaultOptions=o.options,this.resetStyle(o),a.onEachFeature&&a.onEachFeature(e,o),this.addLayer(o)):this},resetStyle:function(e){return e.options=t({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){"function"==typeof t&&(t=t(e.feature)),e.setStyle&&e.setStyle(t)}}),Zi={toGeoJSON:function(e){return Ze(this,{type:"Point",coordinates:qe(this.getLatLng(),e)})}};Gi.include(Zi),Wi.include(Zi),zi.include(Zi),Ui.include({toGeoJSON:function(e){var t=!Ve(this._latlngs),i=Je(this._latlngs,t?1:0,!1,e);return Ze(this,{type:(t?"Multi":"")+"LineString",coordinates:i})}}),qi.include({toGeoJSON:function(e){var t=!Ve(this._latlngs),i=t&&!Ve(this._latlngs[0]),r=Je(this._latlngs,i?2:t?1:0,!0,e);return t||(r=[r]),Ze(this,{type:(i?"Multi":"")+"Polygon",coordinates:r})}}),Ri.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(i){t.push(i.toGeoJSON(e).geometry.coordinates)}),Ze(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var i="GeometryCollection"===t,r=[];return this.eachLayer(function(t){if(t.toGeoJSON){var n=t.toGeoJSON(e);if(i)r.push(n.geometry);else{var a=Qe(n);"FeatureCollection"===a.type?r.push.apply(r,a.features):r.push(a)}}}),i?Ze(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var Qi=Xe;Object.freeze=Ye,e.version="1.3.4",e.Browser=Qt,e.Evented=st,e.Mixin=Ci,e.Util=at,e.Class=_,e.Handler=bi,e.extend=t,e.bind=i,e.stamp=r,e.setOptions=d,e.DomEvent=vi,e.DomUtil=pi,e.PosAnimation=_i,e.Draggable=Ei,e.LineUtil=Li,e.PolyUtil=Si,e.Point=w,e.point=C,e.Bounds=x,e.bounds=P,e.Transformation=D,e.transformation=O,e.Projection=Oi,e.LatLng=S,e.latLng=T,e.LatLngBounds=M,e.latLngBounds=E,e.CRS=ut,e.GeoJSON=Ji,e.geoJSON=Xe,e.geoJson=Qi,window.L||(window.L=e)})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLayer=void 0;var r=i(5),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(2),o=n.default.Class.extend({config:{},viewer:null,initialize:function(e,t){this.viewer=t,this.config=e,this.name=e.name,this.config.hasOwnProperty("alpha")?this._opacity=Number(this.config.alpha):this.config.hasOwnProperty("opacity")&&(this._opacity=Number(this.config.opacity)),this.config.hasOwnProperty("hasOpacity")&&(this.hasOpacity=this.config.hasOpacity),this.create(),e.visible?this.setVisible(!0):this._visible=!1,e.visible&&e.flyTo&&this.centerAt(0)},create:function(){},showError:function(e,t){t||(t="未知错误"),this.viewer&&this.viewer.cesiumWidget.showErrorPanel(e,void 0,t),console.log("layer错误:"+e+t)},_visible:null,getVisible:function(){return this._visible},setVisible:function(e){null!=this._visible&&this._visible==e||(this._visible=e,e?(this.config.msg&&(0,a.msg)(this.config.msg),this.add()):this.remove())},add:function(){this._visible=!0,this.config.onAdd&&this.config.onAdd()},remove:function(){this._visible=!1,this.config.onRemove&&this.config.onRemove()},centerAt:function(e){this.config.extent||this.config.center?this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.config.onCenterAt&&this.config.onCenterAt(e)},hasOpacity:!1,_opacity:1,setOpacity:function(e){this.config.onSetOpacity&&this.config.onSetOpacity(e)},hasZIndex:!1,setZIndex:function(e){this.config.onSetZIndex&&this.config.onSetZIndex(e)},destroy:function(){this.setVisible(!1)}});t.BaseLayer=o},function(e,t,i){"use strict";function r(e,t){return Number(e.toFixed(t||0))}function n(e){var t=g.default.Cartographic.fromCartesian(e),i={};return i.y=r(g.default.Math.toDegrees(t.latitude),6),i.x=r(g.default.Math.toDegrees(t.longitude),6),i.z=r(t.height,2),i}function a(e,t){null==t&&(t=0);var i=t;if(null==e||0==e.length)return i;for(var n=0;n<e.length;n++){var a=g.default.Cartographic.fromCartesian(e[n]);a.height>i&&(i=a.height)}return r(i,2)}function o(e,t){if(t=Number(t)||0,e instanceof Array){for(var i=[],r=0,n=e.length;r<n;r++){var a=g.default.Cartographic.fromCartesian(e[r]),o=g.default.Cartesian3.fromRadians(a.longitude,a.latitude,a.height+t);i.push(o)}return i}var a=g.default.Cartographic.fromCartesian(e);return g.default.Cartesian3.fromRadians(a.longitude,a.latitude,a.height+t)}function s(e,t){if(t=Number(t)||0,e instanceof Array){for(var i=[],r=0,n=e.length;r<n;r++){var a=g.default.Cartographic.fromCartesian(e[r]),o=g.default.Cartesian3.fromRadians(a.longitude,a.latitude,t);i.push(o)}return i}var a=g.default.Cartographic.fromCartesian(e);return g.default.Cartesian3.fromRadians(a.longitude,a.latitude,t)}function l(e){var t=g.default.Cartographic.fromCartesian(e),i=t.height,r=viewer.scene.sampleHeight(t);return null!=r&&r>0&&(i=r),g.default.Cartesian3.fromRadians(t.longitude,t.latitude,i+1)}function u(e,t,i){var r,n=e.pick(t);if(e.pickPositionSupported&&g.default.defined(n)&&(null==i||i&&n.id!==i&&n.primitive!==i)){var r=e.pickPosition(t);if(g.default.defined(r)){var a=g.default.Cartographic.fromCartesian(r),o=a.height;if(o>=0)return r;if(!g.default.defined(n.id)&&o>=-500)return r}}var r=e.pickPosition(t);if(g.default.defined(r))return r;if(e.mode===g.default.SceneMode.SCENE3D){var s=e.camera.getPickRay(t);r=e.globe.pick(s,e)}else r=e.camera.pickEllipsoid(t,e.globe.ellipsoid);return r}function c(e,t){var i=e.scene,r=d(i),a=r;if(!a){var o=i.globe,s=i.camera.positionCartographic.clone(),l=o.getHeight(s);s.height=l||0,a=g.default.Ellipsoid.WGS84.cartographicToCartesian(s)}var u=n(a);t&&(u=e.mars.point2wgs(u));var c=g.default.Cartesian3.distance(a,e.scene.camera.positionWC);return u.cameraZ=c,u}function d(e){var t=e.canvas,i=new g.default.Cartesian2(t.clientWidth/2,t.clientHeight/2),r=e.camera.getPickRay(i);return e.globe.pick(r,e)||e.camera.pickEllipsoid(i)}function h(e,t){var i={xmin:70,xmax:140,ymin:0,ymax:55},r=e.scene,n=r.globe.ellipsoid,a=r.canvas,o=e.camera.pickEllipsoid(new g.default.Cartesian2(0,0),n);if(o){var s=n.cartesianToCartographic(o);i.xmin=g.default.Math.toDegrees(s.longitude),i.ymax=g.default.Math.toDegrees(s.latitude)}else{for(var l,u=a.width/2,c=a.height/2,d=0;d<=c;d+=10){var h=d<=u?d:u;if(l=e.camera.pickEllipsoid(new g.default.Cartesian2(h,d),n))break}if(l){var s=n.cartesianToCartographic(l);i.xmin=g.default.Math.toDegrees(s.longitude),i.ymax=g.default.Math.toDegrees(s.latitude)}}var f=e.camera.pickEllipsoid(new g.default.Cartesian2(a.width,a.height),n);if(f){var p=n.cartesianToCartographic(f);i.xmax=g.default.Math.toDegrees(p.longitude),i.ymin=g.default.Math.toDegrees(p.latitude)}else{for(var m,u=a.width/2,c=a.height/2,d=a.height;d>=c;d-=10){var h=d>=u?d:u;if(m=e.camera.pickEllipsoid(new g.default.Cartesian2(h,d),n))break}if(m){var p=n.cartesianToCartographic(m);i.xmax=g.default.Math.toDegrees(p.longitude),i.ymin=g.default.Math.toDegrees(p.latitude)}}if(t){var y=e.mars.point2wgs({x:i.xmin,y:i.ymin});i.xmin=y.x,i.ymin=y.y;var v=e.mars.point2wgs({x:i.xmax,y:i.ymax});i.xmax=v.x,i.ymax=v.y}if(i.xmax<i.xmin){var _=i.xmax;i.xmax=i.xmin,i.xmin=_}if(i.ymax<i.ymin){var _=i.ymax;i.ymax=i.ymin,i.ymin=_}return i}function f(e,t){var i=e.camera,n=i.positionCartographic,a={};return a.y=r(g.default.Math.toDegrees(n.latitude),6),a.x=r(g.default.Math.toDegrees(n.longitude),6),a.z=r(n.height,2),a.heading=r(g.default.Math.toDegrees(i.heading||-90),1),a.pitch=r(g.default.Math.toDegrees(i.pitch||0),1),a.roll=r(g.default.Math.toDegrees(i.roll||0),1),t&&(a=e.mars.point2wgs(a)),a}Object.defineProperty(t,"__esModule",{value:!0}),t.aroundPoint=t.windingPoint=void 0,t.formatNum=r,t.formatPositon=n,t.getMaxHeight=a,t.addPositionsHeight=o,t.setPositionsHeight=s,t.updateHeightForClampToGround=l,t.getCurrentMousePosition=u,t.getCenter=c,t.getExtent=h,t.getCameraView=f;var p=i(0),g=function(e){return e&&e.__esModule?e:{default:e}}(p);t.windingPoint={isStart:!1,viewer:null,start:function(e,t){t||(t=c(e)),this.viewer=e,this.position=g.default.Cartesian3.fromDegrees(t.x,t.y,t.z),this.distance=t.distance||g.default.Cartesian3.distance(this.position,e.camera.positionWC),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(e){var t=g.default.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),i=g.default.Math.toRadians(t*this.angle)+this.heading;this.viewer.scene.camera.setView({destination:this.position,orientation:{heading:i,pitch:this.pitch}}),this.viewer.scene.camera.moveBackward(this.distance)},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}},t.aroundPoint={isStart:!1,viewer:null,start:function(e,t){t||(t=c(e)),this.viewer=e,this.position=g.default.Cartesian3.fromDegrees(t.x,t.y,t.z),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(e){var t=g.default.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),i=g.default.Math.toRadians(t*this.angle)+this.heading;viewer.scene.camera.setView({orientation:{heading:i,pitch:this.pitch}})},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(13),l={typename:"label",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({label:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={scale:1,horizontalOrigin:n.default.HorizontalOrigin.CENTER,verticalOrigin:n.default.VerticalOrigin.BOTTOM});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"font_style":case"font_weight":case"font_size":case"font_family":case"text":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":case"background_opacity":case"pixelOffsetY":break;case"color":t.fillColor=new n.default.Color.fromCssColorString(r||"#ffffff").withAlpha(Number(e.style.opacity||1));break;case"border":t.style=r?n.default.LabelStyle.FILL_AND_OUTLINE:n.default.LabelStyle.FILL;break;case"border_color":t.outlineColor=new n.default.Color.fromCssColorString(r||"#000000").withAlpha(Number(e.style.opacity||1));break;case"border_width":t.outlineWidth=r;break;case"background":t.showBackground=r;break;case"background_color":t.backgroundColor=new n.default.Color.fromCssColorString(r||"#000000").withAlpha(Number(e.style.background_opacity||e.style.opacity||.5));break;case"pixelOffset":t.pixelOffset=new n.default.Cartesian2(e.style.pixelOffset[0],e.style.pixelOffset[1]);break;case"hasPixelOffset":r||(t.pixelOffset=new n.default.Cartesian2(0,0));break;case"pixelOffsetX":t.pixelOffset=new n.default.Cartesian2(r,e.style.pixelOffsetY);break;case"scaleByDistance":t.scaleByDistance=r?new n.default.NearFarScalar(Number(e.style.scaleByDistance_near||1e3),Number(e.style.scaleByDistance_nearValue||1),Number(e.style.scaleByDistance_far||1e6),Number(e.style.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=r?new n.default.DistanceDisplayCondition(Number(e.style.distanceDisplayCondition_near||0),Number(e.style.distanceDisplayCondition_far||1e5)):null}}t.text=(e.style.text||"文字").replace(new RegExp("<br />","gm"),"\n");var a=(e.style.font_style||"normal")+" small-caps "+(e.style.font_weight||"normal")+" "+(e.style.font_size||"25")+"px "+(e.style.font_family||"楷体");return t.font=a,t},getEditor:function(e,t,i){return new s.PointEditor(e,t,i)},setPositions:function(e,t){e.position=new a.DynamicProperty(t)},getPositions:function(e){return[e.position.getValue()]},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.LabelControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BillboardControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(13),l={typename:"billboard",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({billboard:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={scale:1,horizontalOrigin:n.default.HorizontalOrigin.CENTER,verticalOrigin:n.default.VerticalOrigin.BOTTOM});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"opacity":t.color=new n.default.Color.fromCssColorString("#FFFFFF").withAlpha(Number(r||1));break;case"rotation":t.rotation=n.default.Math.toRadians(r);break;case"scaleByDistance":t.scaleByDistance=r?new n.default.NearFarScalar(Number(e.style.scaleByDistance_near||1e3),Number(e.style.scaleByDistance_nearValue||1),Number(e.style.scaleByDistance_far||1e6),Number(e.style.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=r?new n.default.DistanceDisplayCondition(Number(e.style.distanceDisplayCondition_near||0),Number(e.style.distanceDisplayCondition_far||1e5)):null}}return t},getEditor:function(e,t,i){return new s.PointEditor(e,t,i)},setPositions:function(e,t){e.position=new a.DynamicProperty(t)},getPositions:function(e){return[e.position.getValue()]},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.BillboardControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolygonControl=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=i(3),s=i(1),l=i(41),u=i(42),c={typename:"polygon",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({polygon:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={fill:!0,classificationType:a.default.ClassificationType.BOTH,hierarchy:new o.DynamicProperty([])});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new a.default.Color.fromCssColorString(r||e.style.color||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new a.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"extrudedHeight":var n=0;t.hierarchy&&(n=s.drawutils.getMaxHeightForPositions(t.hierarchy.getValue())),t.extrudedHeight=Number(r)+n;break;case"clampToGround":t.perPositionHeight=!r}}return null==e.style.color&&(t.material=a.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.style.opacity||1)})),t},getEditor:function(e,t,i){return t.polygon.extrudedHeight?new u.PolygonExtrudedEditor(e,t,i):new l.PolygonEditor(e,t,i)},setPositions:function(e,t){if(e.polygon.hierarchy=new o.DynamicProperty(t),e.attribute.style.extrudedHeight){var i=s.drawutils.getMaxHeightForPositions(t);e.polygon.extrudedHeight=i+Number(e.attribute.style.extrudedHeight)}},getPositions:function(e){if(e._draw_positions)return e._draw_positions;var t=e.polygon.hierarchy.getValue();return t.positions&&this.isArray(t.positions)?t.positions:t},isArray:function(e){return"object"==(void 0===e?"undefined":r(e))&&e.constructor==Array},getCoordinates:function(e){var t=this.getPositions(e);return s.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);if(t.length>0){var i=t[0],r=t[t.length-1];i[0]==r[0]&&i[1]==r[1]&&i[2]==r[2]||t.push(i)}return{type:"Feature",properties:e.attribute,geometry:{type:"Polygon",coordinates:[t]}}}};t.PolygonControl=c},function(e,t,i){"use strict";var r,n,a,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s,l){"object"===o(t)&&void 0!==e?l(t,i(5)):(n=[t,i(5)],r=l,void 0!==(a="function"==typeof r?r.apply(t,n):r)&&(e.exports=a))}(0,function(e,t){function i(e){var t="";e.f=e.f||"json";for(var i in e)if(e.hasOwnProperty(i)){var r,n=e[i],a=Object.prototype.toString.call(n);t.length&&(t+="&"),r="[object Array]"===a?"[object Object]"===Object.prototype.toString.call(n[0])?JSON.stringify(n):n.join(","):"[object Object]"===a?JSON.stringify(n):"[object Date]"===a?n.valueOf():n,t+=encodeURIComponent(i)+"="+encodeURIComponent(r)}return t}function r(e,i){var r=new window.XMLHttpRequest;return r.onerror=function(n){r.onreadystatechange=t.Util.falseFn,e.call(i,{error:{code:500,message:"XMLHttpRequest error"}},null)},r.onreadystatechange=function(){var n,a;if(4===r.readyState){try{n=JSON.parse(r.responseText)}catch(e){n=null,a={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!a&&n.error&&(a=n.error,n=null),r.onerror=t.Util.falseFn,e.call(i,a,n)}},r.ontimeout=function(){this.onerror()},r}function n(e,t,n,a){var o=r(n,a);return o.open("POST",e),void 0!==a&&null!==a&&void 0!==a.options&&(o.timeout=a.options.timeout),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.send(i(t)),o}function a(e,t,n,a){var o=r(n,a);return o.open("GET",e+"?"+i(t),!0),void 0!==a&&null!==a&&void 0!==a.options&&(o.timeout=a.options.timeout),o.send(null),o}function o(e,t,n,a){var o=i(t),l=r(n,a),u=(e+"?"+o).length;if(u<=2e3&&U.cors?l.open("GET",e+"?"+o):u>2e3&&U.cors&&(l.open("POST",e),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),void 0!==a&&null!==a&&void 0!==a.options&&(l.timeout=a.options.timeout),u<=2e3&&U.cors)l.send(null);else{if(!(u>2e3&&U.cors))return u<=2e3&&!U.cors?s(e,t,n,a):void A("a request to "+e+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");l.send(o)}return l}function s(e,r,n,a){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var o="c"+J;r.callback="window._EsriLeafletCallbacks."+o,window._EsriLeafletCallbacks[o]=function(e){if(!0!==window._EsriLeafletCallbacks[o]){var t,i=Object.prototype.toString.call(e);"[object Object]"!==i&&"[object Array]"!==i&&(t={error:{code:500,message:"Expected array or object as JSONP response"}},e=null),!t&&e.error&&(t=e,e=null),n.call(a,t,e),window._EsriLeafletCallbacks[o]=!0}};var s=t.DomUtil.create("script",null,document.body);return s.type="text/javascript",s.src=e+"?"+i(r),s.id=o,t.DomUtil.addClass(s,"esri-leaflet-jsonp"),J++,{id:o,url:s.src,abort:function(){window._EsriLeafletCallbacks._callback[o]({code:0,message:"Request aborted."})}}}function l(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function u(e){return l(e[0],e[e.length-1])||e.push(e[0]),e}function c(e){var t,i=0,r=0,n=e.length,a=e[r];for(r;r<n-1;r++)t=e[r+1],i+=(t[0]-a[0])*(t[1]+a[1]),a=t;return i>=0}function d(e,t,i,r){var n=(r[0]-i[0])*(e[1]-i[1])-(r[1]-i[1])*(e[0]-i[0]),a=(t[0]-e[0])*(e[1]-i[1])-(t[1]-e[1])*(e[0]-i[0]),o=(r[1]-i[1])*(t[0]-e[0])-(r[0]-i[0])*(t[1]-e[1]);if(0!==o){var s=n/o,l=a/o;if(s>=0&&s<=1&&l>=0&&l<=1)return!0}return!1}function h(e,t){for(var i=0;i<e.length-1;i++)for(var r=0;r<t.length-1;r++)if(d(e[i],e[i+1],t[r],t[r+1]))return!0;return!1}function f(e,t){for(var i=!1,r=-1,n=e.length,a=n-1;++r<n;a=r)(e[r][1]<=t[1]&&t[1]<e[a][1]||e[a][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[a][0]-e[r][0])*(t[1]-e[r][1])/(e[a][1]-e[r][1])+e[r][0]&&(i=!i);return i}function p(e,t){var i=h(e,t),r=f(e,t[0]);return!(i||!r)}function g(e){for(var t,i,r,n=[],a=[],o=0;o<e.length;o++){var s=u(e[o].slice(0));if(!(s.length<4))if(c(s)){var l=[s.slice().reverse()];n.push(l)}else a.push(s.slice().reverse())}for(var d=[];a.length;){r=a.pop();var f=!1;for(t=n.length-1;t>=0;t--)if(i=n[t][0],p(i,r)){n[t].push(r),f=!0;break}f||d.push(r)}for(;d.length;){r=d.pop();var g=!1;for(t=n.length-1;t>=0;t--)if(i=n[t][0],h(i,r)){n[t].push(r),g=!0;break}g||n.push([r.reverse()])}return 1===n.length?{type:"Polygon",coordinates:n[0]}:{type:"MultiPolygon",coordinates:n}}function m(e){var t=[],i=e.slice(0),r=u(i.shift().slice(0));if(r.length>=4){c(r)||r.reverse(),t.push(r);for(var n=0;n<i.length;n++){var a=u(i[n].slice(0));a.length>=4&&(c(a)&&a.reverse(),t.push(a))}}return t}function y(e){for(var t=[],i=0;i<e.length;i++)for(var r=m(e[i]),n=r.length-1;n>=0;n--){var a=r[n].slice(0);t.push(a)}return t}function v(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function _(e,t){for(var i=t?[t,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<i.length;r++){var n=i[r];if(n in e&&("string"==typeof e[n]||"number"==typeof e[n]))return e[n]}throw Error("No valid id attribute found")}function b(e,t){var i={};if("number"==typeof e.x&&"number"==typeof e.y&&(i.type="Point",i.coordinates=[e.x,e.y],"number"==typeof e.z&&i.coordinates.push(e.z)),e.points&&(i.type="MultiPoint",i.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(i.type="LineString",i.coordinates=e.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=e.paths.slice(0))),e.rings&&(i=g(e.rings.slice(0))),(e.geometry||e.attributes)&&(i.type="Feature",i.geometry=e.geometry?b(e.geometry):null,i.properties=e.attributes?v(e.attributes):null,e.attributes))try{i.id=_(e.attributes,t)}catch(e){}return JSON.stringify(i.geometry)===JSON.stringify({})&&(i.geometry=null),e.spatialReference&&e.spatialReference.wkid&&4326!==e.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),i}function w(e,t){t=t||"OBJECTID";var i,r={wkid:4326},n={};switch(e.type){case"Point":n.x=e.coordinates[0],n.y=e.coordinates[1],n.spatialReference=r;break;case"MultiPoint":n.points=e.coordinates.slice(0),n.spatialReference=r;break;case"LineString":n.paths=[e.coordinates.slice(0)],n.spatialReference=r;break;case"MultiLineString":n.paths=e.coordinates.slice(0),n.spatialReference=r;break;case"Polygon":n.rings=m(e.coordinates.slice(0)),n.spatialReference=r;break;case"MultiPolygon":n.rings=y(e.coordinates.slice(0)),n.spatialReference=r;break;case"Feature":e.geometry&&(n.geometry=w(e.geometry,t)),n.attributes=e.properties?v(e.properties):{},e.id&&(n.attributes[t]=e.id);break;case"FeatureCollection":for(n=[],i=0;i<e.features.length;i++)n.push(w(e.features[i],t));break;case"GeometryCollection":for(n=[],i=0;i<e.geometries.length;i++)n.push(w(e.geometries[i],t))}return n}function C(e,t){return w(e,t)}function x(e,t){return b(e,t)}function P(e){if("NaN"!==e.xmin&&"NaN"!==e.ymin&&"NaN"!==e.xmax&&"NaN"!==e.ymax){var i=t.latLng(e.ymin,e.xmin),r=t.latLng(e.ymax,e.xmax);return t.latLngBounds(i,r)}return null}function M(e){return e=t.latLngBounds(e),{xmin:e.getSouthWest().lng,ymin:e.getSouthWest().lat,xmax:e.getNorthEast().lng,ymax:e.getNorthEast().lat,spatialReference:{wkid:4326}}}function E(e){var t;if(e.objectIdFieldName)t=e.objectIdFieldName;else if(e.fields){for(var i=0;i<=e.fields.length-1;i++)if("esriFieldTypeOID"===e.fields[i].type){t=e.fields[i].name;break}if(!t)for(i=0;i<=e.fields.length-1;i++)if(e.fields[i].name.match(X)){t=e.fields[i].name;break}}return t}function L(e){for(var t in e.attributes)if(t.match(X))return t}function S(e,t){var i,r=e.features||e.results,n=r.length;i=t||E(e);var a={type:"FeatureCollection",features:[]};if(n)for(var o=r.length-1;o>=0;o--){var s=x(r[o],i||L(r[o]));a.features.push(s)}return a}function T(e){return e=t.Util.trim(e),"/"!==e[e.length-1]&&(e+="/"),e}function D(e){if(-1!==e.url.indexOf("?")){e.requestParams=e.requestParams||{};var t=e.url.substring(e.url.indexOf("?")+1);e.url=e.url.split("?")[0],e.requestParams=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return e.url=T(e.url.split("?")[0]),e}function O(e){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(e)}function k(e){var t;switch(e){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":case"MultiPolygon":t="esriGeometryPolygon"}return t}function A(){console&&console.warn&&console.warn.apply(console,arguments)}function N(e){return e.getSize().x-q.attributionWidthOffset+"px"}function I(e){if(e.attributionControl&&!e.attributionControl._esriAttributionAdded){e.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Powered by <a href="https://www.esri.com">Esri</a>');var i=document.createElement("style");i.type="text/css",i.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(i),t.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution:hover");var r=document.createElement("style");r.type="text/css",r.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+N(e)+";}",document.getElementsByTagName("head")[0].appendChild(r),t.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution"),e.on("resize",function(t){e.attributionControl._container.style.maxWidth=N(t.target)}),e.on("unload",function(){i.parentNode.removeChild(i),r.parentNode.removeChild(r);for(var e=document.querySelectorAll(".esri-leaflet-jsonp"),t=0;t<e.length;t++)e.item(t).parentNode.removeChild(e.item(t))}),e.attributionControl._esriAttributionAdded=!0}}function R(e){var i={geometry:null,geometryType:null};return e instanceof t.LatLngBounds?(i.geometry=M(e),i.geometryType="esriGeometryEnvelope",i):(e.getLatLng&&(e=e.getLatLng()),e instanceof t.LatLng&&(e={type:"Point",coordinates:[e.lng,e.lat]}),e instanceof t.GeoJSON&&(e=e.getLayers()[0].feature.geometry,i.geometry=C(e),i.geometryType=k(e.type)),e.toGeoJSON&&(e=e.toGeoJSON()),"Feature"===e.type&&(e=e.geometry),"Point"===e.type||"LineString"===e.type||"Polygon"===e.type||"MultiPolygon"===e.type?(i.geometry=C(e),i.geometryType=k(e.type),i):void A("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object"))}function F(e,i){s(e,{},t.Util.bind(function(e,r){if(!e){i._esriAttributions=[];for(var n=0;n<r.contributors.length;n++)for(var a=r.contributors[n],o=0;o<a.coverageAreas.length;o++){var s=a.coverageAreas[o],l=t.latLng(s.bbox[0],s.bbox[1]),u=t.latLng(s.bbox[2],s.bbox[3]);i._esriAttributions.push({attribution:a.attribution,score:s.score,bounds:t.latLngBounds(l,u),minZoom:s.zoomMin,maxZoom:s.zoomMax})}i._esriAttributions.sort(function(e,t){return t.score-e.score});j({target:i})}},this))}function j(e){var i=e.target,r=i._esriAttributions;if(i&&i.attributionControl&&r){for(var n="",a=i.getBounds(),o=t.latLngBounds(a.getSouthWest().wrap(),a.getNorthEast().wrap()),s=i.getZoom(),l=0;l<r.length;l++){var u=r[l],c=u.attribution;!n.match(c)&&u.bounds.intersects(o)&&s>=u.minZoom&&s<=u.maxZoom&&(n+=", "+c)}n=n.substr(2);var d=i.attributionControl._container.querySelector(".esri-dynamic-attribution");d.innerHTML=n,d.style.maxWidth=N(i),i.fire("attributionupdated",{attribution:n})}}function H(e){return e=D(e),new K(e)}function V(e){return new $(e)}function G(e){return new ee(e)}function B(e){return new te(e)}var z=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,W=""===document.documentElement.style.pointerEvents,U={cors:z,pointerEvents:W},q={attributionWidthOffset:55},J=0,Z=U.cors?a:s;Z.CORS=a,Z.JSONP=s;var Q={request:o,get:Z,post:n},X=/^(OBJECTID|FID|OID|ID)$/i,Y={warn:A,cleanUrl:T,getUrlParams:D,isArcgisOnline:O,geojsonTypeToArcGIS:k,responseToFeatureCollection:S,geojsonToArcGIS:C,arcgisToGeoJSON:x,boundsToExtent:M,extentToBounds:P,calcAttributionWidth:N,setEsriAttribution:I,_setGeometry:R,_getAttributionData:F,_updateMapAttribution:j,_findIdAttributeFromFeature:L,_findIdAttributeFromResponse:E},K=t.Class.extend({options:{proxy:!1,useCors:z},generateSetter:function(e,i){return t.Util.bind(function(t){return this.params[e]=t,this},i)},initialize:function(e){if(e.request&&e.options?(this._service=e,t.Util.setOptions(this,e.options)):(t.Util.setOptions(this,e),this.options.url=T(e.url)),this.params=t.Util.extend({},this.params||{}),this.setters)for(var i in this.setters){var r=this.setters[i];this[i]=this.generateSetter(r,this)}},token:function(e){return this._service?this._service.authenticate(e):this.params.token=e,this},format:function(e){return this.params.returnUnformattedValues=!e,this},request:function(e,i){return this.options.requestParams&&t.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,e,i):this._request("request",this.path,this.params,e,i)},_request:function(e,t,i,r,n){var a=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return"get"!==e&&"request"!==e||this.options.useCors?Q[e](a,i,r,n):Q.get.JSONP(a,i,r,n)}}),$=K.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSr:4326,outFields:"*"},within:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(e,i){return e=t.latLng(e),this.params.geometry=[e.lng,e.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=i,this.params.inSr=4326,this},where:function(e){return this.params.where=e,this},between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},orderBy:function(e,t){return t=t||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[e,t].join(" "),this},run:function(e,t){return this._cleanParams(),this.options.isModern||O(this.options.url)?(this.params.f="geojson",this.request(function(i,r){this._trapSQLerrors(i),e.call(t,i,r,r)},this)):this.request(function(i,r){this._trapSQLerrors(i),e.call(t,i,r&&S(r),r)},this)},count:function(e,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(t,i){e.call(this,t,i&&i.count,i)},t)},ids:function(e,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(t,i){e.call(this,t,i&&i.objectIds,i)},t)},bounds:function(e,t){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(i,r){r&&r.extent&&P(r.extent)?e.call(t,i,P(r.extent),r):(i={message:"Invalid Bounds"},e.call(t,i,null,r))},t)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(e){var i=t.point(e);return this.params.pixelSize=[i.x,i.y],this},layer:function(e){return this.path=e+"/query",this},_trapSQLerrors:function(e){e&&"400"===e.code&&A("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(e){this.params.inSr=4326;var t=R(e);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}}),ee=K.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(e,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[e,t].join(":"),this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},run:function(e,t){return this.request(function(i,r){e.call(t,i,r&&S(r),r)},t)}}),te=K.extend({path:"identify",between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this}});e.VERSION="2.1.4",e.Support=U,e.options=q,e.Util=Y,e.get=Z,e.post=n,e.request=o,e.Task=K,e.task=H,e.Query=$,e.query=V,e.Find=ee,e.find=G,e.Identify=te,e.identify=B})},function(e,t,i){"use strict";var r,n,a;"function"==typeof Symbol&&Symbol.iterator;!function(i,o){n=[],r=o,void 0!==(a="function"==typeof r?r.apply(t,n):r)&&(e.exports=a)}(0,function(){var e=52.35987755982988,t=3.141592653589793,i=6378245,r=.006693421622965943,n=function(e){var t=Number(e[0]),i=Number(e[1]),r=52.35987755982988,n=t-.0065,a=i-.006,o=Math.sqrt(n*n+a*a)-2e-5*Math.sin(a*r),s=Math.atan2(a,n)-3e-6*Math.cos(n*r),l=o*Math.cos(s),u=o*Math.sin(s);return l=Number(l.toFixed(6)),u=Number(u.toFixed(6)),[l,u]},a=function(t){var i=Number(t[0]),r=Number(t[1]),n=Math.sqrt(i*i+r*r)+2e-5*Math.sin(r*e),a=Math.atan2(r,i)+3e-6*Math.cos(i*e),o=n*Math.cos(a)+.0065,s=n*Math.sin(a)+.006;return o=Number(o.toFixed(6)),s=Number(s.toFixed(6)),[o,s]},o=function(e){var n=Number(e[0]),a=Number(e[1]);if(h(n,a))return[n,a];var o=c(n-105,a-35),s=d(n-105,a-35),l=a/180*t,u=Math.sin(l);u=1-r*u*u;var f=Math.sqrt(u);o=180*o/(i*(1-r)/(u*f)*t),s=180*s/(i/f*Math.cos(l)*t);var p=a+o,g=n+s;return g=Number(g.toFixed(6)),p=Number(p.toFixed(6)),[g,p]},s=function(e){var n=Number(e[0]),a=Number(e[1]);if(h(n,a))return[n,a];var o=c(n-105,a-35),s=d(n-105,a-35),l=a/180*t,u=Math.sin(l);u=1-r*u*u;var f=Math.sqrt(u);o=180*o/(i*(1-r)/(u*f)*t),s=180*s/(i/f*Math.cos(l)*t);var p=a+o,g=n+s,m=2*n-g,y=2*a-p;return m=Number(m.toFixed(6)),y=Number(y.toFixed(6)),[m,y]},l=function(e){return s(n(e))},u=function(e){return a(o(e))},c=function(e,i){var r=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return r+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,r+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,r+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},d=function(e,i){var r=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return r+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,r+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,r+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3},h=function(e,t){return e<72.004||e>137.8347||t<.8293||t>55.8271||!1};return{jwd2mct:function(e){var i=Number(e[0]),r=Number(e[1]),n=20037508.34*i/180,a=Math.log(Math.tan((90+r)*t/360))/(t/180);return a=20037508.34*a/180,n=Number(n.toFixed(2)),a=Number(a.toFixed(2)),[n,a]},mct2jwd:function(e){var i=Number(e[0]),r=Number(e[1]),n=i/20037508.34*180,a=r/20037508.34*180;return a=180/t*(2*Math.atan(Math.exp(a*t/180))-t/2),n=Number(n.toFixed(6)),a=Number(a.toFixed(6)),[n,a]},bd2gcj:n,gcj2bd:a,bd2wgs:l,wgs2bd:u,wgs2gcj:o,gcj2wgs:s}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];a.drawutils.createDragger(this.dataSource,{dragger:t,onDrag:function(e,i){var r=new n.default.Cartesian3;n.default.Cartesian3.subtract(i,t.position.getValue(),r),t.position._value=i,t.changeEditing()}})};o.prototype.updateDraggers=function(){},o.prototype.destroy=function(){this.draggers=[]},t.PointEditor=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolylineControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(40),l={typename:"polyline",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({polyline:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={followSurface:!0,positions:new a.DynamicProperty([])});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"lineType":case"color":case"opacity":case"outline":case"outlineWidth":case"outlineColor":case"outlineOpacity":}}var o=new n.default.Color.fromCssColorString(e.style.color||"#FFFF00").withAlpha(Number(e.style.opacity||1));switch(e.style.lineType){default:case"solid":e.style.outline?t.material=new n.default.PolylineOutlineMaterialProperty({color:o,outlineWidth:Number(e.style.outlineWidth||1),outlineColor:new n.default.Color.fromCssColorString(e.style.outlineColor||"#FFFF00").withAlpha(Number(e.style.outlineOpacity||e.style.opacity||1))}):t.material=o;break;case"dash":e.style.outline?t.material=new n.default.PolylineDashMaterialProperty({dashLength:e.style.dashLength||e.style.outlineWidth||16,color:o,gapColor:new n.default.Color.fromCssColorString(e.style.outlineColor||"#FFFF00").withAlpha(Number(e.style.outlineOpacity||e.style.opacity||1))}):t.material=new n.default.PolylineDashMaterialProperty({dashLength:e.style.dashLength||16,color:o});break;case"glow":t.material=new n.default.PolylineGlowMaterialProperty({glowPower:e.style.glowPower||.1,color:o});break;case"arrow":t.material=new n.default.PolylineArrowMaterialProperty(o)}return t},getEditor:function(e,t,i){return new s.PolylineEditor(e,t,i)},setPositions:function(e,t){e.polyline.positions.setValue(t)},getPositions:function(e){return e._draw_positions||e.polyline.positions.getValue()},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"LineString",coordinates:t}}}};t.PolylineControl=l},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonLayer=void 0;var n=i(0),a=r(n),o=i(4),s=r(o),l=i(2),u=i(6),c=i(9),d=i(8),h=i(14),f=i(10),p=u.BaseLayer.extend({dataSource:null,add:function(){this.dataSource?this.viewer.dataSources.add(this.dataSource):this.queryData()},remove:function(){this.viewer.dataSources.remove(this.dataSource)},centerAt:function(e){if(this.config.extent||this.config.center)this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{if(null==this.dataSource)return;this.viewer.flyTo(this.dataSource.entities.values,{duration:e})}},hasOpacity:!0,_opacity:.9,setOpacity:function(e){if(this._opacity=e,null!=this.dataSource)for(var t=this.dataSource.entities.values,i=0,r=t.length;i<r;i++){var n=t[i];n.polygon&&n.polygon.material&&n.polygon.material.color&&(this._updatEntityAlpha(n.polygon.material.color,this._opacity),n.polygon.outlineColor&&this._updatEntityAlpha(n.polygon.outlineColor,this._opacity)),n.polyline&&n.polyline.material&&n.polyline.material.color&&this._updatEntityAlpha(n.polyline.material.color,this._opacity),n.billboard&&(n.billboard.color=new a.default.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),n.model&&(n.model.color=new a.default.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),n.label&&(n.label.fillColor&&this._updatEntityAlpha(n.label.fillColor,this._opacity),n.label.outlineColor&&this._updatEntityAlpha(n.label.outlineColor,this._opacity),n.label.backgroundColor&&this._updatEntityAlpha(n.label.backgroundColor,this._opacity))}},_updatEntityAlpha:function(e,t){var i=e.getValue().withAlpha(t);e.setValue(i)},queryData:function(){var e=this;a.default.GeoJsonDataSource.load(this.config.url,{clampToGround:!0}).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})},showResult:function(e){var t=this;this.dataSource=e,this.viewer.dataSources.add(e),this.config.flyTo&&this.centerAt();for(var i=e.entities.values,r=0,n=i.length;r<n;r++){var a=i[r];this.config.symbol&&("default"==this.config.symbol?this.setDefSymbol(a):this.setConfigSymbol(a,this.config.symbol)),(this.config.columns||this.config.popup)&&(a.popup={html:function(e){var i=t.getEntityAttr(e);return(0,l.isString)(i)?i:t.viewer.mars.popup.getPopupForConfig(t.config,i)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(a.tooltip={html:function(e){var i=t.getEntityAttr(e);return(0,l.isString)(i)?i:t.viewer.mars.popup.getPopupForConfig({popup:t.config.tooltip},i)},anchor:this.config.tooltipAnchor||[0,-15]})}},getEntityAttr:function(e){return e.properties},colorHash:{},setDefSymbol:function(e){if(e.polygon){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=a.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polygon.material=i,e.polygon.outline=!0,e.polygon.outlineColor=a.default.Color.WHITE}else if(e.polyline){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=a.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polyline.material=i,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=a.default.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=a.default.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=e.properties;if(null!=i){var r=t.styleOptions;if(t.styleField){var n=i[t.styleField],o=t.styleFieldOptions[n];null!=o&&(r=(0,l.clone)(r),r=s.default.extend(r,o))}if(r=r||{},this._opacity=r.opacity||1,e.polygon){if(f.PolygonControl.attribute2Entity({style:r},e.polygon),r.outlineWidth&&r.outlineWidth>1){e.polygon.outline=!1;var u={color:r.outlineColor,width:r.outlineWidth,opacity:r.outlineOpacity,lineType:"solid",clampToGround:!0,outline:!1},p=h.PolylineControl.attribute2Entity({style:u});p.positions=e.polygon.hierarchy._value.positions,this.dataSource._entityCollection.add({polyline:p})}if(this.config.buildings){var g=Number(i[this.config.buildings.cloumn]||1),m=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=g*m}}else e.polyline?h.PolylineControl.attribute2Entity({style:r},e.polyline):e.billboard&&(e.billboard.heightReference=a.default.HeightReference.RELATIVE_TO_GROUND,c.BillboardControl.attribute2Entity({style:r},e.billboard),r.label&&r.label.field&&(r.label.heightReference=a.default.HeightReference.RELATIVE_TO_GROUND,e.label=d.LabelControl.attribute2Entity({style:r.label}),e.label.text=i[r.label.field]||""));e.attribute=r}}});t.GeoJsonLayer=p},function(e,t,i){"use strict";function r(e,t,i,n){var a;switch(e.url&&(i&&(e.url=e.url.replace("$serverURL$",i)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),e.type){case"group":if(e.layers&&e.layers.length>0){for(var o=[],b=0;b<e.layers.length;b++){var w=r(e.layers[b],t,i,n);null!=w&&o.push(w)}e._layers=o,a=new s.GroupLayer(e,t)}break;case"www_bing":case"www_osm":case"www_google":case"www_gaode":case"www_tdt":case"arcgis_cache":case"arcgis":case"arcgis_tile":case"arcgis_dynamic":case"wmts":case"tms":case"wms":case"xyz":case"tile":case"single":case"image":case"custom_tilecoord":case"custom_grid":case"sm-img":a=new l.TileLayer(e,t),a.isTile=!0;break;case"www_poi":a=new h.POILayer(e,t);break;case"custom_featuregrid":a=new c.CustomFeatureGridLayer(e,t);break;case"custom_graticule":a=new u.GraticuleLayer(e,t);break;case"3dtiles":a=new m.Tiles3dLayer(e,t);break;case"gltf":a=new g.GltfLayer(e,t);break;case"arcgis_feature":a=new d.ArcFeatureGridLayer(e,t);break;case"arcgis_feature2":a=new p.ArcFeatureLayer(e,t);break;case"geojson":a=new f.GeoJsonLayer(e,t);break;case"kml":a=new y.KmlLayer(e,t);break;case"czml":a=new v.CzmlLayer(e,t);break;case"terrain":a=new _.TerrainLayer(e,t)}if(n){var C=n(e,t,a);C&&(a=C)}return null==a?"group"!=e.type&&console.log("配置中的图层未处理："+JSON.stringify(e)):e._layer=a,a}function n(e,t){e.url&&(t&&(e.url=e.url.replace("$serverURL$",t)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host));var i={};for(var r in e){var n=e[r];if(null!=n)switch(r){default:i[r]=n;break;case"crs":"4326"==n||"EPSG4326"==n.toUpperCase()?i.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||2,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1}):i.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||1,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1});break;case"proxy":i.proxy=new Cesium.DefaultProxy(n);break;case"rectangle":i.rectangle=Cesium.Rectangle.fromDegrees(n.xmin,n.ymin,n.xmax,n.ymax)}}i.proxy&&(i.url=new Cesium.Resource({url:i.url,proxy:i.proxy}));var o;switch(i.type_new||i.type){case"single":case"image":o=new Cesium.SingleTileImageryProvider(i);break;case"xyz":case"tile":i.customTags={"z&1":function(e,t,i,r){return r+1}},o=new Cesium.UrlTemplateImageryProvider(i);break;case"wms":o=new Cesium.WebMapServiceImageryProvider(i);break;case"tms":i.url||(i.url=Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")),o=new Cesium.createTileMapServiceImageryProvider(i);break;case"wmts":o=new Cesium.WebMapTileServiceImageryProvider(i);break;case"sm-img":o=new Cesium.SuperMapImageryProvider(i);break;case"arcgis":case"arcgis_tile":case"arcgis_dynamic":o=new Cesium.ArcGisMapServerImageryProvider(i);break;case"arcgis_cache":Cesium.UrlTemplateImageryProvider.prototype.padLeft0||(Cesium.UrlTemplateImageryProvider.prototype.padLeft0=function(e,t){e=String(e);for(var i=e.length;i<t;)e="0"+e,i++;return e}),i.customTags={arc_x:function(e,t,i,r){return e.padLeft0(t.toString(16),8)},arc_y:function(e,t,i,r){return e.padLeft0(i.toString(16),8)},arc_z:function(e,t,i,r){return e.padLeft0(r.toString(),2)},arc_X:function(e,t,i,r){return e.padLeft0(t.toString(16),8).toUpperCase()},arc_Y:function(e,t,i,r){return e.padLeft0(i.toString(16),8).toUpperCase()},arc_Z:function(e,t,i,r){return e.padLeft0(r.toString(),2).toUpperCase()}},o=new Cesium.UrlTemplateImageryProvider(i);break;case"www_tdt":var s;switch(i.layer){default:case"vec_d":s="vec";break;case"vec_z":s="cva";break;case"img_d":s="img";break;case"img_z":s="cia";break;case"ter_d":s="ter";break;case"ter_z":s="cta"}var l;l=null==i.key||0==i.key.length?"87949882c75775b5069a0076357b7530":a(i.key);if("4326"==e.crs){for(var u=new Array(18),c=0;c<=18;c++)u[c]=(c+1).toString();var d="http://t{s}.tianditu.gov.cn/"+s+"_c/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+s+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+l;o=new Cesium.WebMapTileServiceImageryProvider({url:i.proxy?new Cesium.Resource({url:d,proxy:i.proxy}):d,layer:s,style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:u,tilingScheme:new Cesium.GeographicTilingScheme,maximumLevel:18})}else{for(var u=new Array(18),c=0;c<=18;c++)u[c]=c.toString();var d="http://t{s}.tianditu.gov.cn/"+s+"_w/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+s+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+l;o=new Cesium.WebMapTileServiceImageryProvider({url:i.proxy?new Cesium.Resource({url:d.replace("{s}","0"),proxy:i.proxy}):d,layer:s,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:u,tilingScheme:new Cesium.WebMercatorTilingScheme,maximumLevel:18})}break;case"www_gaode":var d;switch(i.layer){case"vec":default:d="http://"+(i.bigfont?"wprd":"webrd")+"0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}";break;case"img_d":d="http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}";break;case"img_z":d="http://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8";break;case"time":d="http://tm.amap.com/trafficengine/mapabc/traffictile?v=1.0&;t=1&x={x}&y={y}&z={z}&&t="+(new Date).getTime()}o=new Cesium.UrlTemplateImageryProvider({url:i.proxy?new Cesium.Resource({url:d,proxy:i.proxy}):d,subdomains:["1","2","3","4"],maximumLevel:18});break;case"www_google":var d;if("4326"==e.crs||"wgs84"==e.crs)switch(i.layer){default:case"img_d":d="http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}"}else switch(i.layer){case"vec":default:d="http://mt{s}.google.cn/vt/lyrs=m@207000000&hl=zh-CN&gl=CN&src=app&x={x}&y={y}&z={z}&s=Galile";break;case"img_d":d="http://mt{s}.google.cn/vt/lyrs=s&hl=zh-CN&gl=CN&x={x}&y={y}&z={z}&s=Gali";break;case"img_z":d="http://mt{s}.google.cn/vt/imgtp=png32&lyrs=h@207000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galil";break;case"ter":d="http://mt{s}.google.cn/vt/lyrs=t@131,r@227000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile"}o=new Cesium.UrlTemplateImageryProvider({url:i.proxy?new Cesium.Resource({url:d,proxy:i.proxy}):d,subdomains:["1","2","3"],maximumLevel:20});break;case"www_osm":var d="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";o=new Cesium.UrlTemplateImageryProvider({url:i.proxy?new Cesium.Resource({url:d,proxy:i.proxy}):d,subdomains:"abc",maximumLevel:18});break;case"www_bing":var d="https://dev.virtualearth.net",h=i.layer||Cesium.BingMapsStyle.Aerial;o=new Cesium.BingMapsImageryProvider({url:i.proxy?new Cesium.Resource({url:d,proxy:i.proxy}):d,key:i.key||"AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",mapStyle:h});break;case"custom_grid":o=new Cesium.GridImageryProvider;break;case"custom_tilecoord":o=new Cesium.TileCoordinatesImageryProvider;break;case"custom_featuregrid":o=new b.FeatureGridImageryProvider(i);break;default:console.log("config配置图层未处理:"+e)}return o.config=i,o}function a(e){return e[Math.floor(Math.random()*e.length+1)-1]}var o=i(6),s=i(37),l=i(19),u=i(38),c=i(17),d=i(43),h=i(44),f=i(15),p=i(45),g=i(46),m=i(47),y=i(48),v=i(49),_=i(50),b=i(51);t.createLayer=r,t.createImageryProvider=n,t.BaseLayer=o.BaseLayer,t.GroupLayer=s.GroupLayer,t.TileLayer=l.TileLayer,t.GltfLayer=g.GltfLayer,t.Tiles3dLayer=m.Tiles3dLayer,t.GeoJsonLayer=f.GeoJsonLayer,t.ArcFeatureLayer=p.ArcFeatureLayer,t.KmlLayer=y.KmlLayer,t.CzmlLayer=v.CzmlLayer,t.TerrainLayer=_.TerrainLayer,t.CustomFeatureGridLayer=c.CustomFeatureGridLayer,t.ArcFeatureGridLayer=d.ArcFeatureGridLayer,t.POILayer=h.POILayer},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFeatureGridLayer=void 0;var n=i(0),a=r(n),o=i(4),s=r(o),l=i(2),u=i(39),c=i(9),d=i(8),h=i(14),f=i(10),p=u.FeatureGridLayer.extend({_cacheGrid:{},_cacheFeature:{},_addImageryCache:function(e){this._cacheGrid[e.key]={opts:e,isLoading:!0};var t=this;this.getDataForGrid(e,function(i){t._visible&&t._showData(e,i)})},getDataForGrid:function(e,t){this.config.getDataForGrid&&this.config.getDataForGrid(e,t)},checkHasBreak:function(e){return!this._visible||!this._cacheGrid[e]},_showData:function(e,t){var i=e.key;if(!this.checkHasBreak[i]){for(var r=this,n=[],a=0,o=t.length;a<o;a++){var s=t[a],l=s[this.config.IdName||"id"],u=this._cacheFeature[l];if(u)u.grid.push(i),this.updateEntity(u.entity,s);else{var c=this.createEntity(e,s,function(e){r.config.debuggerTileInfo&&(e._temp_id=l,e.popup=function(e){return JSON.stringify(r._cacheFeature[e._temp_id].grid)}),r._cacheFeature[l]={grid:[i],entity:e}});null!=c&&(r.config.debuggerTileInfo&&(c._temp_id=l,c.popup=function(e){return JSON.stringify(r._cacheFeature[e._temp_id].grid)}),r._cacheFeature[l]={grid:[i],entity:c})}n.push(l)}this._cacheGrid[i]=this._cacheGrid[i]||{},this._cacheGrid[i].ids=n,this._cacheGrid[i].isLoading=!1}},createEntity:function(e,t,i){return this.config.createEntity?this.config.createEntity(e,t,i):null},updateEntity:function(e,t){this.config.updateEntity&&this.config.updateEntity(e,t)},removeEntity:function(e){this.config.removeEntity?this.config.removeEntity(e):this.dataSource.entities.remove(e)},_removeImageryCache:function(e){var t=e.key,i=this._cacheGrid[t];if(i){if(i.ids)for(var r=0;r<i.ids.length;r++){var n=i.ids[r],a=this._cacheFeature[n];a&&(a.grid.remove(t),0==a.grid.length&&(delete this._cacheFeature[n],this.removeEntity(a.entity)))}delete this._cacheGrid[t]}},_removeAllImageryCache:function(){this.config.removeAllEntity?this.config.removeAllEntity():(this.dataSource.entities.removeAll(),this.primitives.removeAll()),this._cacheFeature={},this._cacheGrid={}},removeEx:function(){this.config.removeAllEntity?this.config.removeAllEntity():(this.dataSource.entities.removeAll(),this.primitives.removeAll()),this._cacheFeature={},this._cacheGrid={},this.viewer.dataSources.remove(this.dataSource),this.viewer.scene.primitives.remove(this.primitives)},reload:function(){var e=this;for(var t in this._cacheGrid){var i=this._cacheGrid[t];if(null!=i&&null!=i.opts&&!i.isLoading){var r=i.opts;this.getDataForGrid(r,function(t){e._showData(r,t)})}}},hasOpacity:!0,_opacity:1,setOpacity:function(e){this._opacity=e;for(var t in this._cacheFeature){var i=this._cacheFeature[t].entity;i.polygon&&i.polygon.material&&i.polygon.material.color?(this._updatEntityAlpha(i.polygon.material.color,this._opacity),i.polygon.outlineColor&&this._updatEntityAlpha(i.polygon.outlineColor,this._opacity)):i.polyline&&i.polyline.material&&i.polyline.material.color?this._updatEntityAlpha(i.polyline.material.color,this._opacity):i.billboard&&(i.billboard.color=new a.default.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity),i.label&&(i.label.fillColor&&this._updatEntityAlpha(i.label.fillColor,this._opacity),i.label.outlineColor&&this._updatEntityAlpha(i.label.outlineColor,this._opacity),i.label.backgroundColor&&this._updatEntityAlpha(i.label.backgroundColor,this._opacity)))}},_updatEntityAlpha:function(e,t){var i=e.getValue().withAlpha(t);e.setValue(i)},colorHash:{},setDefSymbol:function(e){if(e.polygon){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=a.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polygon.material=i,e.polygon.outline=!0,e.polygon.outlineColor=a.default.Color.WHITE}else if(e.polyline){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=a.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polyline.material=i,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=a.default.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=a.default.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=e.properties,r=t.styleOptions;if(t.styleField){var n=i[t.styleField],o=t.styleFieldOptions[n];null!=o&&(r=(0,l.clone)(r),r=s.default.extend(r,o))}if(r=r||{},this._opacity=r.opacity||1,e.polygon){if(f.PolygonControl.attribute2Entity({style:r},e.polygon),r.outlineWidth&&r.outlineWidth>1){e.polygon.outline=!1;var u={color:r.outlineColor,width:r.outlineWidth,opacity:r.outlineOpacity,lineType:"solid",outline:!1},p=h.PolylineControl.attribute2Entity({style:u});p.positions=e.polygon.hierarchy._value.positions,this.dataSource.entities.add({polyline:p})}if(this.config.buildings){var g=Number(i[this.config.buildings.cloumn]||1),m=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=g*m}}else e.polyline?h.PolylineControl.attribute2Entity({style:r},e.polyline):e.billboard&&(e.billboard.heightReference=a.default.HeightReference.RELATIVE_TO_GROUND,c.BillboardControl.attribute2Entity({style:r},e.billboard),r.label&&r.label.field&&(r.label.heightReference=a.default.HeightReference.RELATIVE_TO_GROUND,e.label=d.LabelControl.attribute2Entity({style:r.label}),e.label.text=i[r.label.field]))}});t.CustomFeatureGridLayer=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(13),l={typename:"point",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({point:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"outlineColor":t.outlineColor=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.color=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"scaleByDistance":t.scaleByDistance=r?new n.default.NearFarScalar(Number(e.style.scaleByDistance_near||1e3),Number(e.style.scaleByDistance_nearValue||1),Number(e.style.scaleByDistance_far||1e6),Number(e.style.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=r?new n.default.DistanceDisplayCondition(Number(e.style.distanceDisplayCondition_near||0),Number(e.style.distanceDisplayCondition_far||1e5)):null}}return e.style.outline||(t.outlineWidth=0),t},getEditor:function(e,t,i){return new s.PointEditor(e,t,i)},setPositions:function(e,t){e.position=new a.DynamicProperty(t)},getPositions:function(e){return[e.position.getValue()]},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.PointControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(6),o=i(16),s=a.BaseLayer.extend({layer:null,add:function(){null!=this.layer&&this.remove(),this.addEx();var e=(0,o.createImageryProvider)(this.config);if(null!=e){var t=this.config,i={show:!0,alpha:this._opacity};if(t.rectangle&&t.rectangle.xmin&&t.rectangle.xmax&&t.rectangle.ymin&&t.rectangle.ymax){var r=t.rectangle.xmin,a=t.rectangle.xmax,s=t.rectangle.ymin,l=t.rectangle.ymax,u=n.default.Rectangle.fromDegrees(r,s,a,l);this.rectangle=u,i.rectangle=u}t.brightness&&(i.brightness=t.brightness),t.contrast&&(i.contrast=t.contrast),t.hue&&(i.hue=t.hue),t.saturation&&(i.saturation=t.saturation),t.gamma&&(i.gamma=t.gamma),t.maximumAnisotropy&&(i.maximumAnisotropy=t.maximumAnisotropy),t.minimumTerrainLevel&&(i.minimumTerrainLevel=t.minimumTerrainLevel),t.maximumTerrainLevel&&(i.maximumTerrainLevel=t.maximumTerrainLevel),this.layer=new n.default.ImageryLayer(e,i),this.layer.transperantBackColor=n.default.Color.fromCssColorString("rgba(0,0,0,0)"),this.layer.transperantBackColorTolerance=.1,this.layer.config=this.config,this.viewer.imageryLayers.add(this.layer),this.setZIndex(this.config.order)}},addEx:function(){},remove:function(){null!=this.layer&&(this.removeEx(),this.viewer.imageryLayers.remove(this.layer,!0),this.layer=null)},removeEx:function(){},centerAt:function(e){if(null!=this.layer)if(this.config.extent||this.config.center)this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else if(this.rectangle)this.viewer.camera.flyTo({destination:this.rectangle,duration:e});else{var t=this.layer.imageryProvider.rectangle;t&&t!=n.default.Rectangle.MAX_VALUE&&t.west>0&&t.south>0&&t.east>0&&t.north>0&&this.viewer.camera.flyTo({destination:t,duration:e})}},hasOpacity:!0,_opacity:1,setOpacity:function(e){this._opacity=e,null!=this.layer&&(this.layer.alpha=e)},hasZIndex:!0,setZIndex:function(e){if(null!=this.layer&&null!=e){this.viewer.imageryLayers.raiseToTop(this.layer);for(var t=this.viewer.imageryLayers._layers,i=t.length-1;i>=0;i--)if(t[i]!=this.layer){var r=t[i].config;r&&r.order&&e<r.order&&this.viewer.imageryLayers.lower(this.layer)}}}});t.TileLayer=s},function(t,i,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0}),i.Draw=void 0;var a=r(0),o=n(a),s=r(4),l=n(s),u=r(2),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(u),d=r(9),h=r(8),f=r(21),p=r(14),g=r(22),m=r(10),y=r(23),v=r(18),_=r(24),b=r(25),w=r(26),C=r(60),x=r(1),P=function(t){function i(e){null!=q&&q==e||(q=e,e?(Q.createEditSelectHandler(function(e){if(!J||!J.inProgress)return null==e?(n(),void(t.onStopEditing&&"function"==typeof t.onStopEditing&&t.onStopEditing(null))):void(e!==J&&(J&&J.stopEditing&&(J.stopEditing(),J=null),(J=e)&&J.startEditing&&J.startEditing()))}),Q.createEditDraggerHandler()):(n(),Q.destroyEditHandler()))}function r(e){if(n(),null==e||null==e.type)throw"请传入需要绘制的类型参数";var t=e.type;if(null==B[t])throw"传入的["+t+"]类型参数有误";var i=e.success;e.success&&delete e.success,e.style=e.style||{},e.attr=e.attr||{},e=F(e);var r=B[t].startDraw(U,e);switch(t){case"label":case"point":case"billboard":case"model":case"ellipse":case"ellipsoid":Q.createDrawPointHandler(r,i);break;case"polyline":case"polylineVolume":Q.createDrawPolylineHandler(r,B[t].getPositions(r),i);break;case"polygon":Q.createDrawPolygonHandler(r,B[t].getPositions(r),i);break;case"rectangle":case"extrudedRectangle":case"measureHeight":Q.createTwoPointsModelHandler(r,B[t].getPositions(r),i);break;case"wall":var a=B[t].getPositions(r),o=B[t].getMinimumHeights(r),s=B[t].getMaximumHeights(r);Q.createDrawWallHandler(r,a,o,s,i)}return u(r),Z.push(r),r.startDrawing(),J=r,r}function n(e){return Q.destroyDrawHandler(),J&&J.inProgress&&(J.stopDrawing(e),U.entities.remove(J),G(Z,J)),J&&J.stopEditing&&(J.stopEditing(e),J=null),this}function a(e,i){if(null!=i&&(J=i),null!=J&&null!=e){e.style=e.style||{},e.attr=e.attr||{};var r=J.attribute.type;return B[r].attribute2Entity(e,J[r]),"model"==r&&B[r].attribute2Model(e,J),J.attribute=e,"ellipse"!=r&&"polygon"!=r&&"wall"!=r&&"rectangle"!=r||J.editor.updateDraggers(),t.tooltip&&(J.attribute.attr&&J.attribute.attr.name?J.tooltip={html:J.attribute.attr.name,check:function(){return!q}}:J.tooltip=null),J}}function s(e,t){if(null==t&&(t=J),null!=t&&null!=e){var i=t.attribute.type;if(B[i].setPositions(t,e),t.editor&&t.editor.destroy){t.editor.destroy();var i=t.attribute.type;t.editor=B[i].getEditor(U,t,{dragIcon:W})}return t}}function u(e){e.startDrawing=function(){(0,l.default)(".cesium-viewer").css("cursor","crosshair");var e=this;t.onStartDrawing&&"function"==typeof t.onStartDrawing&&t.onStartDrawing(e)},e.changeDrawing=function(){var e=this;t.onChangeDrawing&&"function"==typeof t.onChangeDrawing&&t.onChangeDrawing(e)},e.moveDrawing=function(){var e=this;t.onMoveDrawing&&"function"==typeof t.onMoveDrawing&&t.onMoveDrawing(e)},e.stopDrawing=function(){(0,l.default)(".cesium-viewer").css("cursor","");var e=this;t.onStopDrawing&&"function"==typeof t.onStopDrawing&&t.onStopDrawing(e)},e.startEditing=function(){if(q){var e=this;if(J=e,null==e.editor){var i=e.attribute.type;e.editor=B[i].getEditor(U,e,{dragIcon:W})}t.onStartEditing&&"function"==typeof t.onStartEditing&&t.onStartEditing(e)}},e.stopEditing=function(e){var i=this;i.editor&&(i.editor.destroy(),i.editor=null),!e&&t.onStopEditing&&"function"==typeof t.onStopEditing&&t.onStopEditing(i)},e.changeEditing=function(){var e=this;t.onChangeEditing&&"function"==typeof t.onChangeEditing&&t.onChangeEditing(e)},e.updatePositions=function(e){var t=this,i=t.attribute.type;if("ellipse"==i&&!t.attribute.style.clampToGround){var r=Number(o.default.Cartographic.fromCartesian(e).height.toFixed(2));if(t.attribute.style.height=r,t.ellipse.height?t.ellipse.height.setValue(r):t.ellipse.height=r,t.attribute.style.extrudedHeight){var n=r+Number(t.attribute.style.extrudedHeight);t.ellipse.extrudedHeight.setValue(n)}}B[i].setPositions(J,e)}}function P(e){null!=e&&(e.stopEditing(!0),G(Z,e),U.entities.remove(e))}function M(){J&&(J.stopEditing(!0),G(Z,J),U.entities.remove(J),J=null)}function E(){n(),U.entities.removeAll(),Z=[]}function L(e){(0,l.default)(Z).each(function(t,i){e?U.entities.contains(i)||U.entities.add(i):U.entities.contains(i)&&U.entities.remove(i)})}function S(e){var t=e.attribute.type;return B[t].getCoordinates(e)}function T(e){var t=e.attribute.type;return B[t].getPositions(e)}function D(e,t){var i=e.attribute.type,t=B[i].setPositions(e,t)}function O(){return Z.length>0}function k(){return Z}function A(){return U}function N(e){for(var t=0;t<Z.length;t++){var i=Z[t];if(e==i.attribute.attr.id)return i}return null}function I(){return J}function R(e){if(!e.properties||!e.properties.type)return e;var t=e.properties.edittype||e.properties.type,i=X[t];if(!i)return e;var r=c.clone(e);if(e.properties.style){var n={};for(var a in e.properties.style){var o=e.properties.style[a];if(null!=o){var s=i.style[a];s!==o&&(n[a]=o)}}r.properties.style=n}if(e.properties.attr){var l={};for(var a in e.properties.attr){var o=e.properties.attr[a];if(null!=o){var s=i.attr[a];s!==o&&(l[a]=o)}}r.properties.attr=l}return r}function F(e){var t=X[e.edittype||e.type];if(t){e.style=e.style||{};for(var i in t.style){var r=e.style[i];null==r&&(e.style[i]=t.style[i])}e.attr=e.attr||{};for(var i in t.attr){var r=e.attr[i];null==r&&(e.attr[i]=t.attr[i])}}return e}function j(e){if(null==e){if(0==Z.length)return null;for(var t=[],i=0;i<Z.length;i++){var e=Z[i],r=e.attribute.type,n=B[r].toGeoJSON(e);n=R(n),t.push(n)}var n={type:"FeatureCollection",features:t};return n}var r=e.attribute.type,n=B[r].toGeoJSON(e);return n=R(n)}function H(e,i,r){var n=e;try{c.isString(e)&&(n=JSON.parse(e))}catch(e){return void c.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}i&&E();for(var a=[],o=n.features,s=0;s<o.length;s++){var l=o[s];if(!l.properties||!l.properties.type)switch(l.properties=l.properties||{},l.geometry.type){case"MultiPolygon":case"Polygon":l.properties.type="polygon";break;case"MultiLineString":case"LineString":l.properties.type="polyline";break;case"MultiPoint":case"Point":l.properties.type="point"}var d=l.properties.type;if(null==B[d])throw"数据无法识别或者数据的["+d+"]类型参数有误";l.properties.style=l.properties.style||{},l.properties=F(l.properties);var h=B[d].startDraw(U,l.properties),f=x.drawutils.getPositionsFromJson(l.geometry);B[d].setPositions(h,f),u(h),t.tooltip&&(h.attribute.attr&&h.attribute.attr.name?h.tooltip=h.attribute.attr.name:h.tooltip=null),Z.push(h),a.push(h)}return r&&z.flyTo(a),a}function V(t,i,r){var n=t;try{c.isString(t)&&(n=JSON.parse(t))}catch(e){return void c.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}if(!(n instanceof Array))return void c.alert("请确认json文件格式正确!!!");r&&E();for(var a=0;a<n.length;a++){var s=n[a];if(!s.x||!s.y)return void c.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!");var l={id:s.id||s.ID||"",name:s.name||s.NAME||"",remark:s.remark||s.REMA||""},d={type:i.type||"billboard",attr:l,style:i.style},h=o.default.Cartesian3.fromDegrees(s.x,s.y,s.z||0),f=B[d.type].startDraw(U,d);B[d.type].setPositions(f,h),u(f),Z.push(f)}return Z}function G(e,t){for(var i=0;i<e.length;i++)if(e[i]==t){e.splice(i,1);break}}var B={billboard:d.BillboardControl,label:h.LabelControl,ellipse:f.EllipseControl,polyline:p.PolylineControl,polylineVolume:g.PolylineVolumeControl,polygon:m.PolygonControl,ellipsoid:y.EllipsoidControl,wall:w.WallControl,point:v.PointControl,rectangle:_.RectangleControl,model:b.ModelControl},z=t.viewer,W=(z.scene,t.dragIcon);o.default.defaultValue(t.removeScreenSpaceEvent,!0)&&(z.screenSpaceEventHandler.removeInputAction(o.default.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),z.screenSpaceEventHandler.removeInputAction(o.default.ScreenSpaceEventType.LEFT_CLICK));var U=new o.default.CustomDataSource;z.dataSources.add(U);var q,J=null,Z=[],Q=new C.EventControl(z);i(t.hasEdit);var X={label:{edittype:"label",name:"文字",style:{text:"文字",color:"#ffffff",opacity:1,font_family:"楷体",font_size:30,border:!0,border_color:"#000000",border_width:3,background:!1,background_color:"#000000",background_opacity:.5,font_weight:"normal",font_style:"normal",scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},point:{edittype:"point",name:"点标记",style:{pixelSize:10,color:"#3388ff",opacity:1,outline:!0,outlineColor:"#ffffff",outlineOpacity:.6,outlineWidth:2,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},imagepoint:{edittype:"imagepoint",name:"图标点标记",style:{image:"",opacity:1,scale:1,rotation:0,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},model:{edittype:"model",name:"模型",style:{modelUrl:"",scale:1,heading:0,pitch:0,roll:0,fill:!1,color:"#3388ff",opacity:1,silhouette:!1,silhouetteColor:"#ffffff",silhouetteSize:2,silhouetteAlpha:.8},attr:{id:"",name:"",remark:""}},polyline:{edittype:"polyline",name:"线",position:{minCount:2},style:{lineType:"solid",color:"#3388ff",width:4,clampToGround:!1,outline:!1,outlineColor:"#ffffff",outlineWidth:2,opacity:1,zIndex:0},attr:{id:"",name:"",remark:""}},polylineVolume:{edittype:"polylineVolume",name:"管道线",position:{height:!0,minCount:2},style:{color:"#00FF00",radius:10,shape:"pipeline",outline:!1,outlineColor:"#ffffff",opacity:1},attr:{id:"",name:"",remark:""}},polygon:{edittype:"polygon",name:"面",position:{height:!0,minCount:3},style:{fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},polygon_clampToGround:{edittype:"polygon_clampToGround",name:"贴地面",position:{height:!1,minCount:3},style:{color:"#ffff00",opacity:.6,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedPolygon:{edittype:"extrudedPolygon",name:"拉伸面",position:{height:!0,minCount:3},style:{fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,extrudedHeight:100,perPositionHeight:!0,zIndex:0},attr:{id:"",name:"",remark:""}},rectangle:{edittype:"rectangle",name:"矩形",position:{height:!1,minCount:2,maxCount:2},style:{height:0,fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},rectangle_clampToGround:{edittype:"rectangle_clampToGround",name:"贴地矩形",position:{height:!1,minCount:2,maxCount:2},style:{color:"#ffff00",opacity:.6,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},rectangleImg:{edittype:"rectangleImg",name:"贴地图片",position:{height:!1,minCount:2,maxCount:2},style:{image:"",opacity:1,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedRectangle:{edittype:"extrudedRectangle",name:"拉伸矩形",position:{height:!1,minCount:2,maxCount:2},style:{extrudedHeight:40,height:0,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,zIndex:0},attr:{id:"",name:"",remark:""}},ellipse:{edittype:"ellipse",name:"椭圆",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,height:0,fill:!0,color:"#3388ff",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,clampToGround:!1,zIndex:0},attr:{id:"",name:"",remark:""}},ellipse_clampToGround:{edittype:"ellipse_clampToGround",name:"椭圆",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,color:"#ffff00",opacity:.6,rotation:0,clampToGround:!0,zIndex:0},attr:{id:"",name:"",remark:""}},extrudedEllipse:{edittype:"extrudedEllipse",name:"圆柱体",position:{height:!1},style:{semiMinorAxis:200,semiMajorAxis:200,extrudedHeight:200,height:0,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6,rotation:0,zIndex:0},attr:{id:"",name:"",remark:""}},ellipsoid:{edittype:"ellipsoid",name:"球体",style:{extentRadii:200,widthRadii:200,heightRadii:200,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6},attr:{id:"",name:"",remark:""}},wall:{edittype:"wall",name:"墙体",position:{height:!0,minCount:2},style:{extrudedHeight:40,fill:!0,color:"#00FF00",opacity:.6,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.6},attr:{id:"",name:"",remark:""}}};return{startDraw:r,stopDraw:n,updateAttribute:a,updateGeometry:s,toGeoJSON:j,jsonToEntity:H,markersInfoToEntity:V,deleteEntity:P,deleteCurrentEntity:M,deleteAll:E,setVisible:L,hasDraw:O,hasEdit:i,getEntitys:k,getDataSource:A,getEntityById:N,getCurrentEntity:I,getCoordinates:S,getPositions:T,setPositions:D}};i.Draw=P},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(54),l={typename:"ellipse",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({ellipse:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={fill:!0}),e.style.clampToGround&&(e.style.hasOwnProperty("height")&&delete e.style.height,e.style.hasOwnProperty("extrudedHeight")&&delete e.style.extrudedHeight);for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"rotation":t.rotation=n.default.Math.toRadians(r);break;case"height":t.height=Number(r),e.style.extrudedHeight&&(t.extrudedHeight=Number(e.style.extrudedHeight)+Number(r));break;case"extrudedHeight":t.extrudedHeight=Number(t.height||e.style.height||0)+Number(r);break;case"radius":t.semiMinorAxis=Number(r),t.semiMajorAxis=Number(r)}}return t},getEditor:function(e,t,i){return new s.EllipseEditor(e,t,i)},setPositions:function(e,t){e.position=new a.DynamicProperty(t)},getPositions:function(e){return[e.position.getValue()]},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.EllipseControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolylineVolumeControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(55),l={typename:"polylineVolume",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({polylineVolume:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={positions:new a.DynamicProperty([])});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":case"radius":case"shape":break;case"outlineColor":t.outlineColor=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1))}}switch(e.style.radius=e.style.radius||10,e.style.shape){default:case"pipeline":t.shape=this._getCorridorShape1(e.style.radius);break;case"circle":t.shape=this._getCorridorShape2(e.style.radius);break;case"star":t.shape=this._getCorridorShape3(e.style.radius)}return t},_getCorridorShape1:function(e){for(var t=e/3,i=[],r=0;r<=360;r++){var a=n.default.Math.toRadians(r);i.push(new n.default.Cartesian2(e*Math.cos(a),e*Math.sin(a)))}for(var r=360;r>=0;r--){var a=n.default.Math.toRadians(r);i.push(new n.default.Cartesian2((e-t)*Math.cos(a),(e-t)*Math.sin(a)))}return i},_getCorridorShape2:function(e){for(var t=[],i=0;i<=360;i++){var r=n.default.Math.toRadians(i);t.push(new n.default.Cartesian2(e*Math.cos(r),e*Math.sin(r)))}return t},_getCorridorShape3:function(e,t){for(var t=t||6,i=Math.PI/t,r=2*t,a=new Array(r),o=0;o<r;o++){var s=o%2==0?e:e/3;a[o]=new n.default.Cartesian2(Math.cos(o*i)*s,Math.sin(o*i)*s)}return a},getEditor:function(e,t,i){return new s.PolylineVolumeEditor(e,t,i)},setPositions:function(e,t){e.polylineVolume.positions.setValue(t)},getPositions:function(e){return e.polylineVolume.positions.getValue()},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"LineString",coordinates:t}}}};t.PolylineVolumeControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipsoidControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(56),l={typename:"ellipsoid",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({ellipsoid:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={fill:!0});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":case"widthRadii":case"heightRadii":break;case"outlineColor":t.outlineColor=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"extentRadii":var a=e.style.extentRadii||100,o=e.style.widthRadii||100,s=e.style.heightRadii||100;t.radii=new n.default.Cartesian3(a,o,s)}}return t},getEditor:function(e,t,i){return new s.EllipsoidEditor(e,t,i)},setPositions:function(e,t){e.position=new a.DynamicProperty(t)},getPositions:function(e){return[e.position.getValue()]},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.EllipsoidControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=(i(3),i(1)),o=i(57),s=i(58),l={typename:"rectangle",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({rectangle:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},t||(t={fill:!0,closeTop:!0,closeBottom:!0,coordinates:n.default.Rectangle.fromDegrees(78.654473,34.878143,78.654673,34.878316)}),e.style.clampToGround&&(e.style.hasOwnProperty("height")&&delete e.style.height,e.style.hasOwnProperty("extrudedHeight")&&delete e.style.extrudedHeight);for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"height":t.height=Number(r),e.style.extrudedHeight&&(t.extrudedHeight=Number(e.style.extrudedHeight)+Number(r));break;case"extrudedHeight":t.extrudedHeight=Number(t.height)+Number(r);break;case"color":t.material=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"image":t.material=new n.default.ImageMaterialProperty({image:e.style.image,color:new n.default.Color.fromCssColorString("#FFFFFF").withAlpha(Number(e.style.opacity||1))});break;case"rotation":t.rotation=n.default.Math.toRadians(r),e.style.stRotation||(t.stRotation=n.default.Math.toRadians(r));break;case"stRotation":t.stRotation=n.default.Math.toRadians(r)}}return null==t.material&&(t.material=n.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.style.opacity||1)})),t},getEditor:function(e,t,i){return t.rectangle.extrudedHeight?new o.RectangleExtrudedEditor(e,t,i):new s.RectangleEditor(e,t,i)},setPositions:function(e,t){t instanceof Array&&(t=n.default.Rectangle.fromCartesianArray(t)),e.rectangle.coordinates.setValue(t)},getPositions:function(e){return e.rectangle.coordinates},getCoordinates:function(e){var t=this.getDiagonalPositions(e);return a.drawutils.getCoordinates(t)},getDiagonalPositions:function(e){var t=e.rectangle.coordinates._value,i=n.default.Rectangle.northwest(t),r=n.default.Rectangle.southeast(t);return n.default.Cartesian3.fromRadiansArray([i.longitude,i.latitude,r.longitude,r.latitude])},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"MultiPoint",coordinates:t}}}};t.RectangleControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(13),l={typename:"model",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({model:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"silhouette":case"silhouetteColor":case"silhouetteAlpha":case"silhouetteSize":case"fill":case"color":case"opacity":break;case"modelUrl":t.uri=r}}e.style.silhouette?(t.silhouetteColor=new n.default.Color.fromCssColorString(e.style.silhouetteColor||"#FFFFFF").withAlpha(Number(e.style.silhouetteAlpha||1)),t.silhouetteSize=Number(e.style.silhouetteSize||1)):t.silhouetteSize=0;var a=e.style.hasOwnProperty("opacity")?Number(e.style.opacity):1;return e.style.fill?t.color=new n.default.Color.fromCssColorString(e.style.color||"#FFFFFF").withAlpha(a):t.color=new n.default.Color.fromCssColorString("#FFFFFF").withAlpha(a),t},attribute2Model:function(e,t){var i=n.default.Math.toRadians(Number(t.attribute.style.heading||0)),r=n.default.Math.toRadians(Number(t.attribute.style.pitch||0)),a=n.default.Math.toRadians(Number(t.attribute.style.roll||0)),o=new n.default.HeadingPitchRoll(i,r,a);t.orientation&&(t.orientation=n.default.Transforms.headingPitchRollQuaternion(t.position.getValue(),o))},getEditor:function(e,t,i){return new s.PointEditor(e,t,i)},setPositions:function(e,t){e.position=new a.DynamicProperty(t);var i=n.default.Math.toRadians(Number(e.attribute.style.heading||0)),r=n.default.Math.toRadians(Number(e.attribute.style.pitch||0)),o=n.default.Math.toRadians(Number(e.attribute.style.roll||0)),s=new n.default.HeadingPitchRoll(i,r,o);e.orientation=n.default.Transforms.headingPitchRollQuaternion(e.position.getValue(),s)},getPositions:function(e){return[e.position.getValue()]},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.ModelControl=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WallControl=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(3),o=i(1),s=i(59),l={typename:"wall",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({wall:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},t||(t={fill:!0,minimumHeights:[],maximumHeights:[],positions:new a.DynamicProperty([])});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new n.default.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1))}}return null==t.material&&(t.material=n.default.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.style.opacity||1)})),t},getEditor:function(e,t,i){return new s.WallEditor(e,t,i)},setPositions:function(e,t){if(e.wall.positions=new a.DynamicProperty(t),e.wall.maximumHeights&&e.wall.minimumHeights)for(var i=0;i<t.length;i++){var r=n.default.Cartographic.fromCartesian(t[i]);e.wall.minimumHeights._value[i]=Number(r.height),e.wall.maximumHeights._value[i]=Number(r.height)+Number(e.attribute.style.extrudedHeight)}},getPositions:function(e){return e.wall.positions.getValue()},setMaximumHeights:function(e,t){e.wall.maximumHeights=new a.DynamicProperty(t)},getMaximumHeights:function(e){return e.wall.maximumHeights.getValue()},setMinimumHeights:function(e,t){e.wall.minimumHeights=new a.DynamicProperty(t)},getMinimumHeights:function(e){return e.wall.minimumHeights.getValue()},getCoordinates:function(e){var t=this.getPositions(e);return o.drawutils.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"LineString",coordinates:t}}}};t.WallControl=l},function(e,t,i){"use strict";function r(e,t,i){E=e,t=t||{},k=i||"",A=[],x=t.defaultOptions||{windowOptions:{position:"rt",maxmin:!1,resize:!0},autoDisable:!0,disableOhter:!0},"time"==(P=t.version)&&(P=(new Date).getTime());var r=t.widgetsAtStart;if(r&&r.length>0)for(var n=0;n<r.length;n++){var a=r[n];a.hasOwnProperty("uri")&&""!=a.uri?a.hasOwnProperty("visible")&&!a.visible||(a.autoDisable=!1,a.openAtStart=!0,a._nodebug=!0,o(a),A.push(a)):console.log("widget未配置uri："+JSON.stringify(a))}if(M=t.debugger){var l='<div id="widget-testbar" class="widgetbar animation-slide-bottom no-print-view" >      <div style="height: 30px; line-height:30px;"><b style="color: #4db3ff;">widget测试栏</b>&nbsp;&nbsp;<button  id="widget-testbar-remove"  type="button" class="btn btn-link btn-xs">关闭</button> </div>     <button id="widget-testbar-disableAll" type="button" class="btn btn-info" ><i class="fa fa-globe"></i>漫游</button></div>';(0,D.default)("body").append(l),(0,D.default)("#widget-testbar-remove").click(function(e){_()}),(0,D.default)("#widget-testbar-disableAll").click(function(e){h()})}if((r=t.widgets)&&r.length>0){for(var n=0;n<r.length;n++){var a=r[n];if("group"==a.type){for(var l=' <div class="btn-group dropup">  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-align-justify"></i>'+a.name+' <span class="caret"></span></button> <ul class="dropdown-menu">',u=0;u<a.children.length;u++){var f=a.children[u];f.hasOwnProperty("uri")&&""!=f.uri?(l+=' <li data-widget="'+f.uri+'" class="widget-btn" ><a href="#"><i class="fa fa-star"></i>'+f.name+"</a></li>",o(f),A.push(f)):console.log("widget未配置uri："+JSON.stringify(f))}l+="</ul></div>",M&&!a._nodebug&&(0,D.default)("#widget-testbar").append(l)}else{if(!a.hasOwnProperty("uri")||""==a.uri){console.log("widget未配置uri："+JSON.stringify(a));continue}if(M&&!a._nodebug){var l='<button type="button" class="btn btn-primary widget-btn" data-widget="'+a.uri+'"  > <i class="fa fa-globe"></i>'+a.name+" </button>";(0,D.default)("#widget-testbar").append(l)}o(a),A.push(a)}}M&&(0,D.default)("#widget-testbar .widget-btn").each(function(){(0,D.default)(this).click(function(e){var t=(0,D.default)(this).attr("data-widget");null!=t&&""!=t&&(c(t)?d(t):s(t))})})}for(var n=0;n<A.length;n++){var a=A[n];(a.openAtStart||a.createAtStart)&&N.push(a)}(0,D.default)(window).resize(function(){for(var e=0;e<A.length;e++){var t=A[e];t._class&&t._class.indexResize()}}),g()}function n(){return a(x.windowOptions)}function a(e,t){if(null==e||"object"!=(void 0===e?"undefined":C(e)))return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(var i in e)t[i]=void 0===t[i]?a(e[i],null):t[i];return t}function o(e){if(x)for(var t in x)"windowOptions"==t||e.hasOwnProperty(t)||(e[t]=x[t]);e.path=v(k+e.uri),e.name=e.name||e.label}function s(e,t){null==E&&e.viewer&&r(e.viewer),"string"==typeof e?(e={uri:e},null!=t&&(e.disableOhter=!t)):null==e.uri&&console.error("activate激活widget时需要uri参数！");for(var i,n=0;n<A.length;n++){var a=A[n];if(e.uri==a.uri||a.id&&e.uri==a.id){if(i=a,i.isloading)return i;for(var s in e)"uri"!=s&&(i[s]=e[s]);break}}if(null==i&&(o(e),i=e,A.push(e)),M&&console.log("开始激活widget："+i.uri),i.disableOhter?h(i.uri,i.group):f(i.group,i.uri),i._class)if(i._class.isActivate)if(i._class.update)i._class.update();else{i._class.disableBase();var l=setInterval(function(){i._class.isActivate||(i._class.activateBase(),clearInterval(l))},200)}else i._class.activateBase();else{for(var n=0;n<N.length;n++)if(N[n].uri==i.uri)return N[n];N.push(i),1==N.length&&g()}return i}function l(e){for(var t=0;t<A.length;t++){var i=A[t];if(e==i.uri||e==i.id)return i}}function u(e){var t=l(e);return t?t._class:null}function c(e){var t=u(e);return null!=t&&t.isActivate}function d(e){if(null!=e)for(var t=0;t<A.length;t++){var i=A[t];if(i._class&&(e==i.uri||e==i.id)){i._class.disableBase();break}}}function h(e,t){for(var i=0;i<A.length;i++){var r=A[i];if(t&&r.group==t);else if(!r.autoDisable)continue;(!e||e!=r.uri&&e!=r.id)&&(r._class&&r._class.disableBase())}}function f(e,t){if(null!=e)for(var i=0;i<A.length;i++){var r=A[i];if(r.group==e){if(t&&(t==r.uri||t==r.id))continue;r._class&&r._class.disableBase()}}}function p(e){for(var t=0;t<A.length;t++){e(A[t])}}function g(){if(0!=N.length){if(S)return void setTimeout(g,500);S=!0,L=N[0],L.isloading=!0;var e=L.uri;P&&(-1==e.indexOf("?")?e+="?time="+P:e+="&time="+P),window.NProgress&&NProgress.start(),M&&console.log("开始加载js："+k+e),O.Loader.async([k+e],function(){S=!1,L.isloading=!1,M&&console.log("完成js加载："+k+e),window.NProgress&&NProgress.done(!0),N.shift(),g()})}}function m(e){if(null!=L)return L.isloading=!1,L._class=new e(L,E),L._class.activateBase(),L._class;for(var t=y(),i=0;i<A.length;i++){var r=A[i];if(t.endsWith(r.uri))return r.isloading=!1,r._class=new e(r,E),r._class.activateBase(),r._class}}function y(){for(var e,t=document.scripts,i=t.length-1;i>=0;i--)if(null!=(e=t[i].src)&&""!=e&&-1!=e.indexOf("widgets"))return e;return""}function v(e){var t=e.lastIndexOf("/");return e.substring(0,t+1)}function _(){(0,D.default)("#widget-testbar").remove()}function b(){return P}function w(){return k}Object.defineProperty(t,"__esModule",{value:!0});var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.init=r,t.getDefWindowOptions=n,t.activate=s,t.getWidget=l,t.getClass=u,t.isActivate=c,t.disable=d,t.disableAll=h,t.disableGroup=f,t.eachWidget=p,t.bindClass=m,t.removeDebugeBar=_,t.getCacheVersion=b,t.getBasePath=w;var x,P,M,E,L,S,T=i(4),D=function(e){return e&&e.__esModule?e:{default:e}}(T),O=i(28),k="",A=[],N=[]},function(e,t,i){"use strict";function r(e){return"complete"===e.readyState||"loaded"===e.readyState}function n(e,t,i){var r=document.createElement("link");r.rel="stylesheet",s(r,i,"css"),r.async=!0,r.href=e,h.appendChild(r)}function a(e,t,i){var r=document.createElement("script");r.charset="utf-8",s(r,i,"js"),r.async=!t.sync,r.src=e,h.appendChild(r)}function o(e,t){var i;e.sheet&&(i=!0),setTimeout(function(){i?t():o(e,t)},20)}function s(e,t,i){function n(){e.onload=e.onreadystatechange=null,e=null,t()}var a="onload"in e;if("css"===i&&(f||!a))return void setTimeout(function(){o(e,t)},1);a?(e.onload=n,e.onerror=function(){e.onerror=null,"css"==i?console.error("该css文件不存在："+e.href):console.error("该js文件不存在："+e.src),n()}):e.onreadystatechange=function(){r(e)&&n()}}function l(e,t,i,r){function o(){var i=t.indexOf(e);i>-1&&t.splice(i,1),0===t.length&&r()}if(!e)return void setTimeout(function(){o()});d.test(e)?n(e,i,o):a(e,i,o)}function u(e,t,i){var r=function(){i&&i()};if(e=Array.prototype.slice.call(e||[]),0===e.length)return void r();for(var n=0,a=e.length;n<a;n++)l(e[n],e,t,r)}function c(e,t){if(r(e))t();else{var i=!1;window.addEventListener("load",function(){i||(t(),i=!0)}),setTimeout(function(){i||(t(),i=!0)},1500)}}Object.defineProperty(t,"__esModule",{value:!0});var d=new RegExp("\\.css"),h=document.head||document.getElementsByTagName("head")[0],f=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i,"$1")<536,p={async:function(e,t){c(document,function(){u(e,{},t)})},sync:function(e,t){c(document,function(){u(e,{sync:!0},t)})}};t.Loader=p},function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}i(30),i(31);var a=i(0),o=n(a),s=i(32),l=i(16),u=n(l),c=i(12),d=n(c),h=i(5),f=n(h),p=i(11),g=n(p),m=i(7),y=r(m),v=i(2),_=r(v),b=i(52),w=r(b),C=i(53),x=i(65),P=i(66),M=i(67),E=i(20),L=i(1),S=i(3),T=i(9),D=i(8),O=i(21),k=i(14),A=i(22),N=i(10),I=i(23),R=i(18),F=i(24),j=i(25),H=i(26),V=i(27),G=r(V),B=i(68);t.name="MarsGIS for Cesium三维地球框架",t.version="1.6  SM版",t.author="木遥（QQ 346819890，微信 muyao1987）",t.website="http://cesium.marsgis.cn",t.createMap=s.createMap,t.layer=u.default,t.pointconvert=d.default,t.latlng=y,t.point=y,t.util=_,t.matrix=w,t.Measure=C.Measure,t.FlowEcharts=x.FlowEcharts,t.AnimationLineMaterialProperty=P.AnimationLineMaterialProperty,t.ElliposidFadeMaterialProperty=M.ElliposidFadeMaterialProperty,t.Draw=E.Draw,t.draw={},t.draw.utils=L.drawutils,t.draw.DynamicProperty=S.DynamicProperty,t.draw.BillboardControl=T.BillboardControl,t.draw.LabelControl=D.LabelControl,t.draw.EllipseControl=O.EllipseControl,t.draw.PolylineControl=k.PolylineControl,t.draw.PolylineVolumeControl=A.PolylineVolumeControl,t.draw.PolygonControl=N.PolygonControl,t.draw.EllipsoidControl=I.EllipsoidControl,t.draw.PointControl=R.PointControl,t.draw.RectangleControl=F.RectangleControl,t.draw.ModelControl=j.ModelControl,t.draw.WallControl=H.WallControl,t.widget=G,t.widget.BaseWidget=B.BaseWidget,t.L=f.default,t.L.esri=g.default,console.log("当前Cesium版本："+o.default.VERSION+" ， MarsGIS版本："+t.version)},function(e,t){},function(e,t){},function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function initMap(id,config,options){function destroy(){_tooltip.destroy(),_popup.destroy()}function getLayer(e,t){null==t&&(t="name");var i=configdata.basemaps;if(i&&i.length>0)for(var r=0;r<i.length;r++){var n=i[r];if(null!=n&&n[t]==e)return n._layer}if((i=configdata.operationallayers)&&i.length>0)for(var r=0;r<i.length;r++){var n=i[r];if(null!=n&&n[t]==e)return n._layer}return null}function getConfig(){return _util.clone(configdata)}function getTerrainProvider(){if(null==stkTerrainProvider){var e=configdata.terrain;e.url&&(configdata.serverURL&&(e.url=e.url.replace("$serverURL$",configdata.serverURL)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),stkTerrainProvider=_util.getTerrainProvider(e)}return stkTerrainProvider}function hasTerrain(){return null!=stkTerrainProvider&&viewer.terrainProvider!=_util.getEllipsoidTerrain()}function updateTerrainProvider(e){viewer.terrainProvider=e?getTerrainProvider():_util.getEllipsoidTerrain()}function changeBasemap(e){for(var t=viewer.gisdata.config.basemaps,i=0;i<t.length;i++){var r=t[i];"group"==r.type&&null==r.layers||null!=r._layer&&(e==r.name||e==r.id?r._layer.setVisible(!0):r._layer.setVisible(!1))}}function getImageryProviderArr(){var providerViewModels=[];window._temp_createImageryProvider=_layer.createImageryProvider;var layersCfg=configdata.basemaps;if(layersCfg&&layersCfg.length>0)for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if("group"!=item.type||null!=item.layers){var funstr="window._temp_basemaps"+i+" = function () {                        var item = "+JSON.stringify(item)+';                        if (item.type == "group") {                            var arrVec = [];                            for (var index = 0; index < item.layers.length; index++) {                                var temp = window._temp_createImageryProvider(item.layers[index]);                                if (temp == null) continue;                                arrVec.push(temp);                            }                            return arrVec;                        }                        else {                            return window._temp_createImageryProvider(item);                        }                     }';eval(funstr);var imgModel=new _Cesium2.default.ProviderViewModel({name:item.name||"未命名",tooltip:item.name||"未命名",iconUrl:item.icon||"",creationFunction:eval("window._temp_basemaps"+i)});providerViewModels.push(imgModel)}}return providerViewModels}function getTerrainProviderViewModelsArr(){return[new _Cesium2.default.ProviderViewModel({name:"无地形",iconUrl:_Cesium2.default.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84标准椭球，即 EPSG:4326",category:"",creationFunction:function(){return new _Cesium2.default.EllipsoidTerrainProvider({ellipsoid:_Cesium2.default.Ellipsoid.WGS84})}}),new _Cesium2.default.ProviderViewModel({name:"有地形",iconUrl:_Cesium2.default.buildModuleUrl("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"提供的高分辨率全球地形",category:"",creationFunction:function(){return getTerrainProvider()}})]}function centerAt(e,t){if(null==t?t={}:_util.isNumber(t)&&(t={duration:t}),null==e&&(t.isWgs84=!0,e=configdata.extent||configdata.center),e.xmin&&e.xmax&&e.ymin&&e.ymax){var i=e.xmin,r=e.xmax,n=e.ymin,a=e.ymax;if(t.isWgs84){var o=point2map({x:i,y:n});i=o.x,n=o.y;var s=point2map({x:r,y:a});r=s.x,a=s.y}var l=_Cesium2.default.Rectangle.fromDegrees(i,n,r,a);viewer.camera.flyTo({destination:l,duration:t.duration,complete:t.complete})}else{t.isWgs84&&(e=point2map(e));var u=t.minz||2500;viewer.camera.positionCartographic.height<u&&(u=viewer.camera.positionCartographic.height),null!=e.z&&0!=e.z&&(u=e.z),viewer.camera.flyTo({destination:_Cesium2.default.Cartesian3.fromDegrees(e.x,e.y,u),orientation:{heading:_Cesium2.default.Math.toRadians(e.heading||0),pitch:_Cesium2.default.Math.toRadians(e.pitch||-90),roll:_Cesium2.default.Math.toRadians(e.roll||0)},duration:t.duration,complete:t.complete})}}function isFlyAnimation(){return _isFlyAnimation}function openFlyAnimation(e,t){var i=t||point.getCameraView(viewer);_isFlyAnimation=!0,viewer.camera.setView({destination:_Cesium2.default.Cartesian3.fromDegrees(-85.16,13.71,23e6)}),viewer.camera.flyTo({destination:_Cesium2.default.Cartesian3.fromDegrees(i.x,i.y,23e6),duration:2,easingFunction:_Cesium2.default.EasingFunction.LINEAR_NONE,complete:function(){var t=1.2*(i.z||9e4)+8e3;t>23e6&&(t=23e6),viewer.camera.flyTo({destination:_Cesium2.default.Cartesian3.fromDegrees(i.x,i.y,t),complete:function(){centerAt(i,{duration:2,complete:function(){_isFlyAnimation=!1,e&&e()}})}})}})}function rotateAnimation(e,t){var i=point.getCameraView(viewer),r=t/3;viewer.camera.flyTo({destination:_Cesium2.default.Cartesian3.fromDegrees(i.x+120,i.y,i.z),orientation:{heading:_Cesium2.default.Math.toRadians(i.heading),pitch:_Cesium2.default.Math.toRadians(i.pitch),roll:_Cesium2.default.Math.toRadians(i.roll)},duration:r,easingFunction:_Cesium2.default.EasingFunction.LINEAR_NONE,complete:function(){viewer.camera.flyTo({destination:_Cesium2.default.Cartesian3.fromDegrees(i.x+240,i.y,i.z),orientation:{heading:_Cesium2.default.Math.toRadians(i.heading),pitch:_Cesium2.default.Math.toRadians(i.pitch),roll:_Cesium2.default.Math.toRadians(i.roll)},duration:r,easingFunction:_Cesium2.default.EasingFunction.LINEAR_NONE,complete:function(){viewer.camera.flyTo({destination:_Cesium2.default.Cartesian3.fromDegrees(i.x,i.y,i.z),orientation:{heading:_Cesium2.default.Math.toRadians(i.heading),pitch:_Cesium2.default.Math.toRadians(i.pitch),roll:_Cesium2.default.Math.toRadians(i.roll)},duration:r,easingFunction:_Cesium2.default.EasingFunction.LINEAR_NONE,complete:function(){e&&e()}})}})}})}function addLocationWidget(e){(0,_jquery2.default)("#"+viewerDivId).prepend('<div id="location_mars_jwd"  class="location-bar animation-slide-bottom no-print" >                        <div id="location_mars_camera_height" ></div>                        <div id="location_mars_camera_pitch" ></div>                        <div id="location_mars_camera_heading" ></div>                        <div id="location_mars_level" ></div>                        <div id="location_mars_height" ></div>                        <div id="location_mars_lat" ></div>                        <div id="location_mars_lon" ></div>                        <div id="mars_msgbar" style="min-width: 0px;" ></div>                      </div>'),e.style?(0,_jquery2.default)("#location_mars_jwd").css(e.style):(0,_jquery2.default)("#location_mars_jwd").css({left:viewer.animation?"170px":"0",right:"0",bottom:viewer.timeline?"25px":"0"}),new _Cesium2.default.ScreenSpaceEventHandler(viewer.scene.canvas).setInputAction(function(t){var i=point.getCurrentMousePosition(viewer.scene,t.endPosition);if(i){var r=_Cesium2.default.Cartographic.fromCartesian(i),n=_Cesium2.default.Math.toDegrees(r.longitude),a=_Cesium2.default.Math.toDegrees(r.latitude),o=r.height,s={};switch(e.crs){default:var l=e.hasOwnProperty("toFixed")?e.toFixed:6;s.x=n.toFixed(l),s.y=a.toFixed(l);break;case"degree":s.x=_util.formatDegree(n),s.y=_util.formatDegree(a);break;case"project":var l=e.hasOwnProperty("toFixed")?e.toFixed:0;s.x=i.x.toFixed(l),s.y=i.y.toFixed(l);break;case"wgs":var l=e.hasOwnProperty("toFixed")?e.toFixed:6,u=point2wgs({x:n,y:a});s.x=u.x.toFixed(l),s.y=u.y.toFixed(l);break;case"wgs-degree":var u=point2wgs({x:n,y:a});s.x=_util.formatDegree(u.x),s.y=_util.formatDegree(u.y)}(0,_jquery2.default)("#location_mars_lon").html("经度："+s.x),(0,_jquery2.default)("#location_mars_lat").html("纬度："+s.y),0!=o&&o>-500&&(0,_jquery2.default)("#location_mars_height").html("海拔："+o.toFixed(1)+"米")}else(0,_jquery2.default)("#location_mars_lon").html(""),(0,_jquery2.default)("#location_mars_lat").html(""),(0,_jquery2.default)("#location_mars_height").html("")},_Cesium2.default.ScreenSpaceEventType.MOUSE_MOVE),viewer.scene.camera.changed.addEventListener(function(e){var t=viewer.camera.positionCartographic.height.toFixed(1),i=_Cesium2.default.Math.toDegrees(viewer.camera.heading).toFixed(0),r=_Cesium2.default.Math.toDegrees(viewer.camera.pitch).toFixed(0);(0,_jquery2.default)("#location_mars_camera_height").html("视点高："+t+"米"),(0,_jquery2.default)("#location_mars_camera_heading").html("视角方向："+i+"度"),(0,_jquery2.default)("#location_mars_camera_pitch").html("俯仰角："+r+"度")})}function addMsgBarWidget(e){function t(){var t=t.getCenter(viewer);if(t){var i=!1;for(var r in e.data){var n=e.data[r];if(t.x>=n.xmin&&t.x<=n.xmax&&t.y>=n.ymin&&t.y<=n.ymax){(0,_jquery2.default)("#mars_msgbar").html(n.msg),i=!0;break}}}i||(0,_jquery2.default)("#mars_msgbar").html("")}null!=e.data&&0!=e.data.length&&(document.getElementById("mars_msgbar")||((0,_jquery2.default)("#"+viewerDivId).prepend('<div id="mars_msgbar" class="location-bar animation-slide-bottom no-print" ></div>'),e.style&&(0,_jquery2.default)("#mars_msgbar").css(e.style)),viewer.scene.camera.changed.addEventListener(t))}function addNavigationWidget(e){_Cesium2.default.viewerCesiumNavigationMixin&&(viewer.extend(_Cesium2.default.viewerCesiumNavigationMixin,{defaultResetView:_Cesium2.default.Rectangle.fromDegrees(110,20,120,30),enableZoomControls:!0}),viewer.animation?(0,_jquery2.default)(".distance-legend").css({left:"150px",bottom:"25px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}):(0,_jquery2.default)(".distance-legend").css({left:"-10px",bottom:"-1px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}),(0,_jquery2.default)(".navigation-controls").hide(),e.style?(0,_jquery2.default)(".compass").css(e.style):(0,_jquery2.default)(".compass").css({top:"10px",left:"10px"}))}function getCrs(){return crs}function point2map(e){if("gcj"==crs){var t=_util.clone(e),i=_pointconvert2.default.wgs2gcj([t.x,t.y]);return t.x=i[0],t.y=i[1],t}return e}function point2wgs(e){if("gcj"==crs){var t=_util.clone(e),i=_pointconvert2.default.gcj2wgs([t.x,t.y]);return t.x=i[0],t.y=i[1],t}return e}var viewer,viewerDivId,configdata,crs;viewerDivId=id,configdata=config;var defoptions={animation:!1,timeline:!1,fullscreenButton:!0,vrButton:!1,geocoder:!1,sceneModePicker:!1,homeButton:!0,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,infoBox:!0,selectionIndicator:!1,shouldAnimate:!0,showRenderLoopErrors:!0,baseLayerPicker:!1};for(var key in configdata)"crs"!==key&&"controls"!==key&&"minzoom"!==key&&"maxzoom"!==key&&"center"!==key&&"style"!==key&&"terrain"!==key&&"basemaps"!==key&&"operationallayers"!==key&&(defoptions[key]=configdata[key]);null==options&&(options={});for(var i in defoptions)options.hasOwnProperty(i)||(options[i]=defoptions[i]);_Cesium2.default.BingMapsApi.defaultKey="AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",_Cesium2.default.Ion&&(_Cesium2.default.Ion.defaultAccessToken=configdata.ionToken||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1NjM5MjMxOS1lMWVkLTQyNDQtYTM4Yi0wZjA4ZDMxYTlmNDMiLCJpZCI6MTQ4MiwiaWF0IjoxNTI4Njc3NDQyfQ.vVoSexHMqQhKK5loNCv6gCA5d5_z3wE2M0l_rWnIP_w"),_Cesium2.default.AnimationViewModel.defaultTicks=configdata.animationTicks||[.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600],configdata.crs=configdata.crs||"3857",crs=configdata.crs,!0===options.geocoder&&(options.geocoder=new _GaodePOIGeocoder.GaodePOIGeocoder(options.geocoderConfig)),configdata.terrain&&configdata.terrain.visible&&(options.terrainProvider=getTerrainProvider());var hasremoveimagery=!1;if(options.baseLayerPicker?(options.imageryProviderViewModels||(options.imageryProviderViewModels=getImageryProviderArr()),options.terrainProviderViewModels||(options.terrainProviderViewModels=getTerrainProviderViewModelsArr())):null==options.imageryProvider&&(hasremoveimagery=!0,options.imageryProvider=_Cesium2.default.createTileMapServiceImageryProvider({url:_Cesium2.default.buildModuleUrl("Assets/Textures/NaturalEarthII")})),viewer=new _Cesium2.default.Viewer(id,options),viewer.cesiumWidget.creditContainer.style.display="none",viewer.mars={popup:_popup,tooltip:_tooltip,keyboard:function(e){e?_firstPerson.bind(viewer):_firstPerson.unbind(viewer)},centerAt:centerAt,getConfig:getConfig,getLayer:getLayer,changeBasemap:changeBasemap,hasTerrain:hasTerrain,updateTerrainProvider:updateTerrainProvider,isFlyAnimation:isFlyAnimation,openFlyAnimation:openFlyAnimation,rotateAnimation:rotateAnimation,getCrs:getCrs,point2map:point2map,point2wgs:point2wgs,destroy:destroy},hasremoveimagery)for(var imageryLayerCollection=viewer.imageryLayers,length=imageryLayerCollection.length,i=0;i<length;i++){var layer=imageryLayerCollection.get(0);imageryLayerCollection.remove(layer,!0)}viewer.homeButton&&viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(e){centerAt(),e.cancel=!0}),centerAt(null,{duration:0});var orderlayers=[];if(!options.baseLayerPicker){var layersCfg=configdata.basemaps;if(layersCfg&&layersCfg.length>0)for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if(item.visible&&item.crs&&(crs=item.crs),(0,_layer.createLayer)(item,viewer,config.serverURL,options.layerToMap),orderlayers.push(item),"group"==item.type&&item.layers)for(var idx=0;idx<item.layers.length;idx++){var childitem=item.layers[idx];orderlayers.push(childitem)}}}var layersCfg=configdata.operationallayers;if(layersCfg&&layersCfg.length>0)for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if((0,_layer.createLayer)(item,viewer,config.serverURL,options.layerToMap),orderlayers.push(item),"group"==item.type&&item.layers)for(var idx=0;idx<item.layers.length;idx++){var childitem=item.layers[idx];orderlayers.push(childitem)}}for(var i=0;i<orderlayers.length;i++){var item=orderlayers[i],order=Number(item.order);isNaN(order)&&(order=i),item.order=order,null!=item._layer&&item._layer.setZIndex(order)}var lastCameraView;viewer.scene.morphStart.addEventListener(function(e){lastCameraView=point.getCameraView(viewer)}),viewer.scene.morphComplete.addEventListener(function(e){setTimeout(function(){centerAt(lastCameraView,{duration:2})},100)});var hasMouseZomm=!1,controlsCfg=configdata.controls;if(controlsCfg)for(var i=0;i<controlsCfg.length;i++){var item=controlsCfg[i];if(!item.hasOwnProperty("visible")||item.visible)switch(item.type){case"navigation":addNavigationWidget(item);break;case"location":addLocationWidget(item);break;case"msgbar":addMsgBarWidget(item);break;case"mousezoom":hasMouseZomm=!0}}options.geocoder&&(options.geocoder.viewer=viewer),_popup.init(viewer),_tooltip.init(viewer);var scene=viewer.scene;if(scene.globe.baseColor=new _Cesium2.default.Color.fromCssColorString(configdata.baseColor||"#546a53"),configdata.style&&(scene.globe.depthTestAgainstTerrain=configdata.style.testTerrain,scene.globe.enableLighting=configdata.style.lighting,scene.skyAtmosphere.show=configdata.style.atmosphere,scene.globe.showGroundAtmosphere=configdata.style.atmosphere,scene.fog.enabled=configdata.style.fog),scene.screenSpaceCameraController.maximumZoomDistance=configdata.maxzoom||2e7,scene.screenSpaceCameraController.minimumZoomDistance=configdata.minzoom||1,viewer._cesiumWidget._supportsImageRenderingPixelated=_Cesium2.default.FeatureDetection.supportsImageRenderingPixelated(),viewer._cesiumWidget._forceResize=!0,_Cesium2.default.FeatureDetection.supportsImageRenderingPixelated()){for(var _dpr=window.devicePixelRatio;_dpr>=2;)_dpr/=2;viewer.resolutionScale=_dpr}if(copyright){var viewportQuad=new _Cesium2.default.ViewportQuad;viewportQuad.rectangle=new _Cesium2.default.BoundingRectangle(10,5,88,20),viewer.scene.primitives.add(viewportQuad),viewportQuad.material=new _Cesium2.default.Material({fabric:{type:"Image",uniforms:{color:new _Cesium2.default.Color(1,1,1,1),image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAUCAYAAAAJD/ojAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2NUVFNjVDRUFBMDgxMUU5QUM4NDg4MzU3RThBMzcwQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2NUVFNjVDRkFBMDgxMUU5QUM4NDg4MzU3RThBMzcwQiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjY1RUU2NUNDQUEwODExRTlBQzg0ODgzNTdFOEEzNzBCIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjY1RUU2NUNEQUEwODExRTlBQzg0ODgzNTdFOEEzNzBCIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+GxQkfQAADBVJREFUeNrsWHtwVNUd/u7u3d1sNtlNNmQTkiyjkfAIqCD4AOQhGUBAqtMahloFq6KOio9qfVu0VVtrpahtrQOlCsgUlYq0QuMDMojQVFrLo0UeaSIGSAJ57SbZ7Otuv9/ds3ETQeto/+jUM/Obe8+55/E73+9xvnO11h/6cMqiabAYCT4pug5PvAN7dD8u8t6Clm4LcOJdtg8G7HdMh8cbRA52gM1o7gZaeoASL7DtFaCzEZi2CGATgvxW14zHr8jBfdNyzGX2798Pp9OJQYMGIZFIqKU1hEIh1NbWoqioCF6v12xvbW3FkSNHkJOTY7ZbrVbE4/GTqi/fwuEw6uvr4XK5UFxcbM4rpaOjAxaLBdnZ2eb4aDRqridF5pZ+hmH06pJe0nVM1VPvsp682+12s27BFylUEl0EaPlSoPpDwHMjkDl3JvK9Vfhg8xw8MAG4n7LtVSCDgJhravh/LvoX6u1wiImA9z8Gyk4AMyaPRRS/gRjabvMhxw8YUb5n9sVVWTxpUn6IJpLyOUU8QSSRNl7exbNS3vV5RfqLh6bPIUXGp7wutc5/BWDLqTxMMoPFkgUtHqdyydgxYgTISgD5nuUbjDjWENyB6GC9bMIIjDzPA4+jA8cCwDEaIZeA211uevO5jJVRlHaEjc00a50786TBw8lxDWUgZUUkEmmQkEsvEtY2m40ZSx/AajmlhOBk8xlLt42KznZ+q2e4/oP9u6SNexnCtjjTRyNlAdsqY7HY8zTCmjQjfIsyi/IMZVfavOdSrqX8ibK+n6PeROGG8RPO39L7IZSIngpfaDF47Zr+uG7VBxsJbQsCx1qcnqFv2R6taYDmfxEhlJmd6bBoqBuB2rcnYficD5FTdBly9bHoxEUYMTMfRqQBDcdWwe54Bx3WjyePzsJNk7MEhHmU0wnkms7Oznq/32+ncj8Q0Cg1wWCwQTbtcDiuYP00ykrm6oaBAwciKyvrBQI0m8Aso2zguLy0fBSRdCjG4thZJSUlTxDEe8WTaaDJ7FvJ3CtPnbl3UyAQOMQc/X22nUODXs01J/CbGPq9fgBPpNzAbxkKYNEzk3XR7SGOG0BD7uUa1aznsd6sRxInPyAsVgu6u3oOOzTbUq/b81IGovfSYwPvWEZFGx3+C/g+vtdnxL/zSrPgXbhefMy0ThZR744dRqhxIZy1K9AVNRA4EyjMwT0Xy6FglV4C3CUE9ig39gIBiFFBQ3lSuLCwEAUFBYVse47f3ATjFQFJDi9uKkeFd4D1iAI1BXBUaRVQXp8jc1IMvj/PZy2bK8QTOX6Wx+ORqJgrBmd9R+ITV470gyWknq3q+Q3KSBUt4hyi2ww+z1JTVOt+z8nPOY0Ah4iVoWk7XXkYhrbGRVtD47VHXE+Vcdl5SJyEcnAJM1h6sA098fsRbn8XHU1cnvTB5iFkFtxZVo8x2gnsrInBV+TfPsjvv4QbHEPgxCOjKnjMIJJ0wHI2xU2F99KjD8kmMjMze09P1rtF5IRQwKbSQxeSvEX6aDSSmV44z1QV5lKGsP2OpqamlwjwXWQqRxhNQebnEkZIKpBT+b6Q4ytVrp7b1dW1js9fiS6c08lvU9nPzX0sZp+DvSnikiVtp2JoiMWSSTGrsyMRGDHqmT9f9trD7Zm+m3vtmJ7xbDC8bXWvavs3L2kpnlEDP6Onx80VMpN5O2jA59Mx7/w8+Lw6gnoc7uzs7QqAin379mH37t2YMmWKReiUgCUbo/JjBRgCsSk3Nzdx9OhRHD9+HPT6vQRhPPsJfyuiZKcZx1D1QqkwBTQJBRP6xZQxlWCO4LwCvp1rlK9atWr86NGjMyoqKvazvpE5e1L/A5GlkXp+QLlIjM22v1OvoWwfrFKFGED2ciVB3qZ0OahvLP/RZxzjcRM5hHI5zXmLYfct7hM0mpI4/vDN8Lp3f2Q8qMN9qO1N/Uq8EVmAxrgNDXE72sP5pG1BLJ0cwNhBPnR25iJ/QIIGjO1gajjETQ8nqGfSK/bQI0xmQ0AsAgrz4pWK626VjbrdbpNjEvAadhtN+ZeEIuXblKXKc6+i1FFkc9dnZGQ0pNiHyuW5wtZVlOSPGzeum8YTUO9gv4vlYEyHQQ5VxUgOKs5by2cXvX0Uc/dt5ObvcC/foQGb2X4p13uTz2Nc7x4dsyo/g+MQTY2UIav0VkRtD5tsIcWeLea5/fGFsc2rH8GjLVONLbcgUz8tVuZpKg+vPnB7aI3JUT70lOHHsRnY7rwUpcUF5sB4PGklghSh3MLXi3t6eo6Wl5dPJ4DCINDW1ja7paVl28iRI5eJE3FTWyQ8JXQlZ7J8l5s4l217+D5GTnCV9+JsG6JAJHHHDILwPo3yRzGYyq8iVsnJwkCGDRvWSS//Ketn0qBZfBYqIMPylMuNsJn8/PyEpBphOVKncTbw/ed0gKt5PjylWMs1CqVfUtbqaDsFh0gYybyp58xFWH+6r8fyW8zyxARjywNb4tPu0q3GzzotBbz12dARiY45lHCtiNH77cwM+fZ/4rHuPdgWWwZreK3slwDZe1ei11bxVlVF4OwE4sFUO29pt/PG9saCBQuWTJo0CZWVleZtT25c3ORMetWF9Ooa1hfTUxrY5mQk3ElAwjRWFds+4sa97JPNlBIUYMQwBKX/6ZFgexHX3i7eR4Ak3Bepb/PZ/yM+3+d8Or/PUCljHL10HJnPjvb29tvpuWv57XW2/41rXk/Pfpn7ekyMQ3NknQRfIymWvArYXCuQTjQsvA6HOm9EyL3bkR1HXPcu1Y1gccJqXZRJ9Jtixph98ZDeTdKcYVhMaiuEwdLdgea963DAPRaWaACyT3oNdu3aZYb97Nmzn6FyEwnY02yvy8vLWzp06NBlhw8fnvjkk0+eIHi4/PLLzXCl9/yF3nifcBfK+RxTwg2XSR8JDH4fyZDNo9cWEuxAY2NjtazBNNB/p8JYxOuGc/zddXV1Z9AQTczvEmqSwsIc2yGGlXNBjGeGSDxexbl3SDvbXqa4OMcK6i9pZj3rV6QuLvqnrrIJnmw6aZ7dfRY0x28JrksloCDlblhjvzZzs0UyhAVRTQ/bE/Fbu7q73w7b7K/7dPv512i+UZx1Z0JFgx46jlDpRBwovRaNLceh97SK8uahM336dPlPsIQK30AP2LV8+fK7hK5dd911pQTl1urq6k1sn02R/GaO40ZaCPSzBONCethAdaDZVYrQOM6hWIWTkdEjoS3jJKzZR0s7QeQM9ygvXVlVVWUylPnz5wu/H0aQ1nKNA3IG0FAxGrKa883j2lryYuuAon8FqRsh39387qIElAf3o2myvmYvgSVjJVXwm2rEIq8h2nkzNNcx2PU+/xc0NXGws2eDMwOnu3LtrwbCsTm8/+00jchIsEUjaM4/D905ZyAzyPODh5TwWQLs56XhJUXga5gqZtXW1sZ8Pp8cZLcpmnU3ARDeOpcKbxIPFp5JkVtck+K0RyjDlddIKPMeDwEtqMCfyDk2CSB8uvhd6JxT3cA8HGfyotLSUjMNiZMKOOybLVxcMRExboXadqdiOE6O3UiZwvrvWH+PxniW41q4v8vY9sYnAJspgQbN8DhhzXiRyJ2NSPQ4jPiNsBm/h+ikJT718ybRezHhfd6Ceq47y4gjVw7sJMDCCJiLc1zwDx0AI8T98nIjChLEc+QOSGXupGLLZR/yd0tYgvLGe9hvBxWeKwcX36vY12DfbMpY9oko7mtRz++Zfzs0bbQ6+GQSckXUs+9bbJer0UoFTL5KEa2U3bLYtGnTUmxhjTJejTiC6ErgT6Nx97P9kYaGhlViaF6CxrF+VNgC5TlGSJB67WbfhZz/DLFZ3xRhEGCnYx0ytKn0nbXoDixEPByENy8ZTVo6pKcszQS2mWD3MYXNpkPul5w/ve/rIv1///X7WbO+371f2t4T+aI/XhQzWP8fdN2oJF0voW4PyQvTRYrybRZJ/5HE9q18bP0kB5t5mxUbDe3KXo/W5pkI1l6F4lGrzVzce5VO4MuUlA5GUos+P2/+14rk5HS90x0j/R9xkhMk1LXNbv8FCcVwtNQOwcG3ViPG9Ge14evyZf8HZxZlIR6dg0B7E+wFF9A8bcmUpn2NzlcCcKTHAyP6VwSaNiDb1/W113615d8CDAB0JaU81/NTEwAAAABJRU5ErkJggg=="}}})}if(hasMouseZomm&&_util.isPCBroswer()){(0,_jquery2.default)("#"+viewerDivId).append('<div class="cesium-mousezoom"><div class="zoomimg"/></div>');var handler=new _Cesium2.default.ScreenSpaceEventHandler(scene.canvas);handler.setInputAction(function(e){(0,_jquery2.default)(".cesium-mousezoom").addClass("cesium-mousezoom-visible"),setTimeout(function(){(0,_jquery2.default)(".cesium-mousezoom").removeClass("cesium-mousezoom-visible")},200)},_Cesium2.default.ScreenSpaceEventType.WHEEL),handler.setInputAction(function(e){(0,_jquery2.default)(".cesium-mousezoom").css({top:e.endPosition.y+"px",left:e.endPosition.x+"px"})},_Cesium2.default.ScreenSpaceEventType.MOUSE_MOVE)}var stkTerrainProvider,_isFlyAnimation=!1;return viewer}function createMap(e){return e.url?(_jquery2.default.ajax({type:"get",dataType:"json",url:e.url,timeout:0,success:function(t){var i=t.map3d;t.serverURL&&(i.serverURL=t.serverURL),e.serverURL&&(i.serverURL=e.serverURL),createMapByData(e,i,t)},error:function(t,i,r){console.log("Json文件"+e.url+"加载失败！"),_util.alert("Json文件"+e.url+"加载失败！")}}),null):(e.serverURL&&e.data&&(e.data.serverURL=e.serverURL),createMapByData(e,e.data))}function createMapByData(opt,configdata,jsondata){if(null==configdata)return void console.log("配置信息不能为空！");if(copyright)try{eval(function(e,t,i,r,n,a){if(n=function(e){return e.toString(30)},!"".replace(/^/,String)){for(;i--;)a[n(i)]=r[i]||n(i);r=[function(e){return a[e]}],n=function(){return"\\w+"},i=1}for(;i--;)r[i]&&(e=e.replace(new RegExp("\\b"+n(i)+"\\b","g"),r[i]));return e}('1(g(){2.3("\\4\\5\\6\\7\\8\\9\\a\\b d e\\f\\0\\h\\i %c \\j\\k\\l\\m\\n://o.p.q","r:s")},t);',0,30,"u67b6|setTimeout|console|log|u5f53|u524d|u4e09|u7ef4|u5730|u56fe|u4f7f|u7528MarsGIS||for|Cesium|u6846|function|u5b9e|u73b0|u5b98|u65b9|u7f51|u7ad9|uff1ahttp|cesium|marsgis|cn|color|red|6E4".split("|"),0,{}))}catch(e){}var viewer=initMap(opt.id,configdata,opt),gisdata={};return gisdata.config=configdata,viewer.gisdata=gisdata,opt.success&&opt.success(viewer,gisdata,jsondata),viewer}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMap=void 0;var _Cesium=__webpack_require__(0),_Cesium2=_interopRequireDefault(_Cesium),_jquery=__webpack_require__(4),_jquery2=_interopRequireDefault(_jquery),_util2=__webpack_require__(2),_util=_interopRequireWildcard(_util2),_point=__webpack_require__(7),point=_interopRequireWildcard(_point),_popup2=__webpack_require__(33),_popup=_interopRequireWildcard(_popup2),_tooltip2=__webpack_require__(34),_tooltip=_interopRequireWildcard(_tooltip2),_firstPerson2=__webpack_require__(35),_firstPerson=_interopRequireWildcard(_firstPerson2),_pointconvert=__webpack_require__(12),_pointconvert2=_interopRequireDefault(_pointconvert),_GaodePOIGeocoder=__webpack_require__(36),_layer=__webpack_require__(16),copyright=!1;exports.createMap=createMap},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function isOnly(e){_isOnly=e}function setEnable(e){_enable=e,e||close()}function getEnable(e){return _enable}function init(e){viewer=e;(0,_jquery2.default)("#"+viewer._container.id).append('<div id="pupup-all-view" ></div>'),handler=new _Cesium2.default.ScreenSpaceEventHandler(viewer.scene.canvas),handler.setInputAction(mousePickingClick,_Cesium2.default.ScreenSpaceEventType.LEFT_CLICK),viewer.scene.postRender.addEventListener(bind2scene)}function mousePickingClick(e){if(removeFeature(),unHighlighPick(),_isOnly&&close(),_enable){var t=e.position,i=viewer.scene.pick(t);if(i&&_Cesium2.default.defined(i.id)&&i.id instanceof _Cesium2.default.Entity){var r=i.id;if(_Cesium2.default.defined(r.popup)){var n=(0,_point.getCurrentMousePosition)(viewer.scene,t);show(r,n,t)}return void(r.click&&"function"==typeof r.click&&r.click(r,t))}if(i&&_Cesium2.default.defined(i.tileset)&&_Cesium2.default.defined(i.getProperty)){for(var a={},o=i.getPropertyNames(),s=0;s<o.length;s++){var l=o[s];if(i.hasProperty(l)){var u=i.getProperty(l);null!=u&&(a[l]=u)}}var c=i.tileset._config;if(c){if(_Cesium2.default.defined(c.popup)){var n=(0,_point.getCurrentMousePosition)(viewer.scene,t);show({id:i._batchId,popup:{html:getPopupForConfig(c,a),anchor:c.popupAnchor||[0,-15]}},n,t)}return c.showClickFeature&&highlighPick(i,c.clickFeatureColor),void(c.click&&"function"==typeof c.click&&c.click({attr:a,feature:i},t))}}if(i&&_Cesium2.default.defined(i.primitive)){var d=i.primitive;if(_Cesium2.default.defined(d.popup)){var n=(0,_point.getCurrentMousePosition)(viewer.scene,t);show(d,n,t)}return void(d.click&&"function"==typeof d.click&&d.click(d,t))}pickImageryLayerFeatures(t)}}function pickImageryLayerFeatures(e){var t=viewer.scene,i=t.camera.getPickRay(e),r=t.imageryLayers.pickImageryLayerFeatures(i,t);_Cesium2.default.defined(r)&&_Cesium2.default.when(r,function(t){if(_Cesium2.default.defined(t)&&0!==t.length){var i=t[0];if(null!=i.imageryLayer&&null!=i.imageryLayer.config){var r=i.imageryLayer.config;r.showClickFeature&&i.data&&showFeature(i.data,r.pickFeatureStyle);var n=getPopupForConfig(i.imageryLayer.config,i.properties);if(n){var a=(0,_point.getCurrentMousePosition)(viewer.scene,e);show({id:"imageryLayerFeaturePromise",popup:{html:n,anchor:i.imageryLayer.config.popupAnchor||[0,-12]}},a,e)}r.click&&"function"==typeof r.click&&r.click(i.properties,e)}}},function(){})}function removeFeature(){null!=lastShowFeature&&(viewer.dataSources.remove(lastShowFeature),lastShowFeature=null)}function showFeature(e,t){removeFeature();var i=e;if(e.geometryType&&-1!=e.geometryType.indexOf("esri")){if(JSON.stringify(e.geometry).length<1e4){var r=window.mars3d.L||window.L;if(!r.esri)return void console.log("需要引入 mars-esri 插件解析arcgis标准的json数据！");i=mars3d.L.esri.Util.arcgisToGeoJSON(e.geometry)}}else if(e.geometry&&e.geometry.type){var r=window.mars3d.L||window.L;if(r){var n=r.geoJSON(e.geometry,{coordsToLatLng:function(e){return e[0]>180||e[0]<-180?r.CRS.EPSG3857.unproject(r.point(e[0],e[1])):new r.LatLng(e[1],e[0],e[2])}});i=n.toGeoJSON()}}if(null!=i){t=t||{};_Cesium2.default.GeoJsonDataSource.load(i,{clampToGround:!0,stroke:new _Cesium2.default.Color.fromCssColorString(t.stroke||"#ffff00"),strokeWidth:t.strokeWidth||3,fill:new _Cesium2.default.Color.fromCssColorString(t.fill||"#ffff00").withAlpha(t.fillAlpha||.7)}).then(function(e){viewer.dataSources.add(e),lastShowFeature=e}).otherwise(function(e){console.log(e)})}}function unHighlighPick(){if(_Cesium2.default.defined(highlighted.feature)){try{highlighted.feature.color=highlighted.originalColor}catch(e){}highlighted.feature=void 0}}function highlighPick(e,t){unHighlighPick(),highlighted.feature=e,_Cesium2.default.Color.clone(e.color,highlighted.originalColor),t&&"string"==typeof t&&(t=new _Cesium2.default.Color.fromCssColorString(t)),e.color=t||defaultHighlightedClr}function show(e,t,i){if(null!=e&&null!=e.popup){var r=getPopupId(e);close(r),objPopup[r]={id:e.id,popup:e.popup,cartesian:t,viewPoint:i};var n;n="object"===_typeof(e.popup)?e.popup.html:e.popup,n&&("function"==typeof n&&(n=n(e,t,function(n){_showHtml(n,r,e,t,i)})),n&&_showHtml(n,r,e,t,i))}}function _showHtml(e,t,i,r,n){if((0,_jquery2.default)("#pupup-all-view").append('<div id="'+t+'" class="cesium-popup">            <a class="cesium-popup-close-button cesium-popup-color" href="javascript:viewer.mars.popup.close(\''+t+'\',true)">×</a>            <div class="cesium-popup-content-wrapper cesium-popup-background">                <div class="cesium-popup-content cesium-popup-color">'+e+'</div>            </div>            <div class="cesium-popup-tip-container"><div class="cesium-popup-tip cesium-popup-background"></div></div>        </div>'),!updateViewPoint(t,r,i.popup,n))return void close(t)}function updateViewPoint(e,t,i,r){var n=_Cesium2.default.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene,t);if(n&&(r=n,objPopup[e]&&(objPopup[e].viewPoint=n)),null==r)return console.log("wgs84ToWindowCoordinates无法转换为屏幕坐标"),!1;var a=viewer.scene;if(a.mode===_Cesium2.default.SceneMode.SCENE3D){var o;if(a.mode===_Cesium2.default.SceneMode.SCENE3D){var s=a.camera.getPickRay(r);o=a.globe.pick(s,a)}else o=a.camera.pickEllipsoid(r,a.globe.ellipsoid);if(o){if(_Cesium2.default.Cartesian3.distance(t,o)>1e6)return!1}}var l=(0,_jquery2.default)("#"+e),u=r.x-l.width()/2,c=r.y-l.height();return i&&"object"===(void 0===i?"undefined":_typeof(i))&&i.anchor&&(u+=i.anchor[0],c+=i.anchor[1]),l.css("transform","translate3d("+u+"px,"+c+"px, 0)"),!0}function bind2scene(){for(var e in objPopup){var t=objPopup[e];updateViewPoint(e,t.cartesian,t.popup,t.viewPoint)||close(e)}}function getPopupId(e){return"popup_"+((e.id||"")+"").replace(new RegExp("[^0-9a-zA-Z_]","gm"),"_")}function close(e,t){if(!_isOnly&&e){"object"===(void 0===e?"undefined":_typeof(e))&&(e=getPopupId(e));for(var i in objPopup)if(e==objPopup[i].id||e==i){(0,_jquery2.default)("#"+i).remove(),delete objPopup[i];break}}else(0,_jquery2.default)("#pupup-all-view").empty(),objPopup={};t&&(removeFeature(),unHighlighPick())}function destroy(){close(),handler.destroy(),viewer.scene.postRender.removeEventListener(bind2scene)}function template(e,t){for(var i in t){var r=t[i];null!=r&&"Null"!=r&&"Unknown"!=r||(r=""),"_"==i.substr(0,1)&&(i=i.substring(1)),e=e.replace(new RegExp("{"+i+"}","gm"),r)}return e}function getAttrVal(e){try{var t={};if(e._propertyNames&&e._propertyNames.length>0){var i=!0,r=!1,n=void 0;try{for(var a,o=e._propertyNames[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value;t[s]=e[s].getValue()}}catch(e){r=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(r)throw n}}}else for(var l in e)"function"!=typeof e[l]&&(t[l]=e[l]);return t}catch(e){console.log(e)}return e}function getPopupForConfig(e,t){var i=e.popupNameField?t[e.popupNameField]:e.name;return e.popup?getPopup(e.popup,t,i):!!e.columns&&getPopup(e.columns,t,i)}function getPopup(cfg,attr,title){if(!attr)return!1;if(title=title||"",_leaflet2.default.Util.isArray(cfg)){for(var countsok=0,inhtml='<div class="mars-popup-titile">'+title+'</div><div class="mars-popup-content" >',i=0;i<cfg.length;i++){var thisfield=cfg[i],col=thisfield.field;if(null!=col&&null!=attr[col]&&("object"===_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue()),"function"!=typeof attr[col]))if("details"!=thisfield.type){var showval=_jquery2.default.trim(attr[col]);if(null!=showval&&""!=showval&&"Null"!=showval&&"Unknown"!=showval&&"0"!=showval&&0!=showval.length){if(thisfield.format)try{showval=eval(thisfield.format+"("+showval+")")}catch(e){console.log("getPopupByConfig error:"+thisfield.format)}thisfield.unit&&(showval+=thisfield.unit),inhtml+="<div><label>"+thisfield.name+"</label>"+showval+"</div>",countsok++}}else{var showval=_jquery2.default.trim(attr[col||"OBJECTID"]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval)continue;inhtml+='<div style="text-align: center;padding: 10px 0;"><button type="button" onclick="'+thisfield.calback+"('"+showval+'\');" " class="btn btn-info  btn-sm">'+(thisfield.name||"查看详情")+"</button></div>"}}return inhtml+="</div>",0!=countsok&&inhtml}if("object"!==(void 0===cfg?"undefined":_typeof(cfg))){if("function"==typeof cfg)return cfg(attr);if("all"==cfg){var countsok=0,inhtml='<div class="mars-popup-titile">'+title+'</div><div class="mars-popup-content" >';for(var col in attr)try{if(null==col||null==attr[col])continue;if("Shape"==col||"FID"==col||"OBJECTID"==col||"_definitionChanged"==col||"_propertyNames"==col)continue;if("_"==col.substr(0,1)&&(col=col.substring(1)),"object"===_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue()),"function"==typeof attr[col])continue;var showval=_jquery2.default.trim(attr[col]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval||"0"==showval||0==showval.length)continue;inhtml+="<div><label>"+col+"</label>"+showval+"</div>",countsok++}catch(e){console.log(e)}return inhtml+="</div>",0!=countsok&&inhtml}return template(cfg,attr)}switch(cfg.type){case"iframe":var _url=_util.template(cfg.url,attr),inhtml='<iframe id="ifarm" src="'+_url+'"  style="width:'+(cfg.width||"300")+"px;height:"+(cfg.height||"300")+'px;overflow:hidden;margin:0;" scrolling="no" frameborder="0" ></iframe>';return inhtml;case"javascript":return eval(cfg.calback+"("+JSON.stringify(getAttrVal(attr))+")")}return!1}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports.isOnly=isOnly,exports.setEnable=setEnable,exports.getEnable=getEnable,exports.init=init,exports.show=show,exports.getPopupId=getPopupId,exports.close=close,exports.destroy=destroy,exports.getPopupForConfig=getPopupForConfig,exports.getPopup=getPopup;var _Cesium=__webpack_require__(0),_Cesium2=_interopRequireDefault(_Cesium),_jquery=__webpack_require__(4),_jquery2=_interopRequireDefault(_jquery),_leaflet=__webpack_require__(5),_leaflet2=_interopRequireDefault(_leaflet),_esriLeaflet=__webpack_require__(11),_esriLeaflet2=_interopRequireDefault(_esriLeaflet),_point=__webpack_require__(7),viewer,handler,objPopup={},_isOnly=!0,_enable=!0,lastShowFeature,highlighted={feature:void 0,originalColor:new _Cesium2.default.Color},defaultHighlightedClr=new _Cesium2.default.Color.fromCssColorString("#95e40c")},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e){h=e;(0,_.default)("#"+h._container.id).append('<div id="tooltip-view" class="cesium-popup" style="display:none;">     <div class="cesium-popup-content-wrapper  cesium-popup-background">         <div id="tooltip-content" class="cesium-popup-content cesium-popup-color"></div>     </div>     <div class="cesium-popup-tip-container"><div class="cesium-popup-tip  cesium-popup-background"></div></div></div> '),f=new y.default.ScreenSpaceEventHandler(h.scene.canvas),f.setInputAction(a,y.default.ScreenSpaceEventType.MOUSE_MOVE)}function a(e){if((0,_.default)(".cesium-viewer").css("cursor",""),!h.scene||!1===h.scene.screenSpaceCameraController.enableRotate||!1===h.scene.screenSpaceCameraController.enableTilt||!1===h.scene.screenSpaceCameraController.enableTranslate)return void s();var t,i=e.endPosition,r=h.scene.pick(i);if(r&&y.default.defined(r.id)&&r.id instanceof y.default.Entity?t=r.id:r&&y.default.defined(r.primitive)&&(t=r.primitive),t)if((t.popup||t.click||t.cursorCSS)&&(0,_.default)(".cesium-viewer").css("cursor",t.cursorCSS||"pointer"),t.noMouseMove||(clearTimeout(g),g=setTimeout(function(){l(t,i)},20)),t.tooltip){var n=(0,b.getCurrentMousePosition)(h.scene,i);o(t,n,i)}else s();else s(),clearTimeout(g),g=setTimeout(u,20)}function o(e,t,i){if(null!=e&&null!=e.tooltip){if(null==i&&(i=y.default.SceneTransforms.wgs84ToWindowCoordinates(h.scene,t)),null==i)return void s();var r,n=(0,_.default)("#tooltip-view");if("object"===d(e.tooltip)){if(r=e.tooltip.html,e.tooltip.check&&!e.tooltip.check())return void s()}else r=e.tooltip;if("function"==typeof r&&(r=r(e,t)),r){(0,_.default)("#tooltip-content").html(r),n.show();var a=i.x-n.width()/2,o=i.y-n.height(),l=e.tooltip;l&&"object"===(void 0===l?"undefined":d(l))&&l.anchor?(a+=l.anchor[0],o+=l.anchor[1]):o-=15,n.css("transform","translate3d("+a+"px,"+o+"px, 0)")}}}function s(){(0,_.default)("#tooltip-content").empty(),(0,_.default)("#tooltip-view").hide()}function l(e,t){p!==e&&(u(),e.mouseover&&"function"==typeof e.mouseover&&e.mouseover(e,t),p=e)}function u(){null!=p&&(p.mouseout&&"function"==typeof p.mouseout&&p.mouseout(p),p=null)}function c(){s(),f.destroy()}Object.defineProperty(t,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.init=n,t.show=o,t.close=s,t.destroy=c;var h,f,p,g,m=i(0),y=r(m),v=i(4),_=r(v),b=i(7)},function(e,t,i){"use strict";function r(e,t){function i(e){switch(e){case 38:case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):case 40:return"moveBackward";case"D".charCodeAt(0):case 39:return"moveRight";case"A".charCodeAt(0):case 37:return"moveLeft";case"Q".charCodeAt(0):return"moveUp";case"E".charCodeAt(0):return"moveDown";default:return}}function r(t){var i=e.camera,r=i.direction,n=s.default.Cartesian3.normalize(i.position,new s.default.Cartesian3),a=s.default.Cartesian3.cross(r,n,new s.default.Cartesian3);r=s.default.Cartesian3.cross(n,a,new s.default.Cartesian3),r=s.default.Cartesian3.normalize(r,r),r=s.default.Cartesian3.multiplyByScalar(r,t,r),i.position=s.default.Cartesian3.add(i.position,r,i.position)}var n=e.scene,o=e.canvas;o.setAttribute("tabindex","0"),o.onclick=function(){o.focus()};var l=n.globe.ellipsoid;n.screenSpaceCameraController.enableRotate=!1,n.screenSpaceCameraController.enableTranslate=!1,n.screenSpaceCameraController.enableZoom=!1,n.screenSpaceCameraController.enableTilt=!1,n.screenSpaceCameraController.enableLook=!1;var u,c,d={looking:!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1};t=t||100;var h=new s.default.ScreenSpaceEventHandler(o);h.setInputAction(function(e){d.looking=!0,c=u=s.default.Cartesian3.clone(e.position)},s.default.ScreenSpaceEventType.LEFT_DOWN),h.setInputAction(function(e){c=e.endPosition},s.default.ScreenSpaceEventType.MOUSE_MOVE),h.setInputAction(function(e){d.looking=!1},s.default.ScreenSpaceEventType.LEFT_UP),h.setInputAction(function(e){t*=e>0?.9:1.1,console.log(e)},s.default.ScreenSpaceEventType.WHEEL),document.addEventListener("keydown",function(e){var t=i(e.keyCode);void 0!==t&&(d[t]=!0)},!1),document.addEventListener("keyup",function(e){var t=i(e.keyCode);void 0!==t&&(d[t]=!1)},!1),a=function(i){var n=e.camera;if(d.looking){var a=o.clientWidth,h=o.clientHeight,f=(c.x-u.x)/a,p=-(c.y-u.y)/h;n.lookRight(.05*f),n.lookUp(.05*p);var g=n.direction,m=s.default.Cartesian3.normalize(n.position,new s.default.Cartesian3),y=s.default.Cartesian3.cross(g,m,new s.default.Cartesian3);m=s.default.Cartesian3.cross(y,g,new s.default.Cartesian3),n.up=m,n.right=y}var v=l.cartesianToCartographic(n.position).height,_=v/t;d.moveForward&&r(_),d.moveBackward&&r(-_),d.moveUp&&n.moveUp(_),d.moveDown&&n.moveDown(_),d.moveLeft&&n.moveLeft(_),d.moveRight&&n.moveRight(_)},e.clock.onTick.addEventListener(a)}function n(e){var t=e.scene;e.canvas;t.screenSpaceCameraController.enableRotate=!0,t.screenSpaceCameraController.enableTranslate=!0,t.screenSpaceCameraController.enableZoom=!0,t.screenSpaceCameraController.enableTilt=!0,t.screenSpaceCameraController.enableLook=!0,a&&(e.clock.onTick.removeEventListener(a),a=void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.bind=r,t.unbind=n;var a,o=i(0),s=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GaodePOIGeocoder=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(0),s=r(o),l=i(12),u=r(l),c=i(2);t.GaodePOIGeocoder=function(){function e(t){n(this,e),t=t||{},this.citycode=t.citycode||"",this.gaodekey=t.key||["f2fedb9b08ae13d22f1692cd472d345e","81825d9f2bafbb14f235d2779be90c0f","b185732970a4487de104fa71ef575f29","2e6ca4aeb6867fb637a5bee8333e5d3a","027187040fa924e56048468aaa77b62c"]}return a(e,[{key:"getOneKey",value:function(){var e=this.gaodekey;return e[Math.floor(Math.random()*e.length+1)-1]}},{key:"geocode",value:function(e,t){var i=this,r=this.getOneKey();return new s.default.Resource({url:"http://restapi.amap.com/v3/place/text",queryParameters:{key:r,city:this.citycode,keywords:e}}).fetchJson().then(function(t){if(0==t.status)return void(0,c.msg)("请求失败("+t.infocode+")："+t.info);if(0===t.pois.length)return void(0,c.msg)("未查询到“"+e+"”相关数据！");var r=3e3;return i.viewer.camera.positionCartographic.height<r&&(r=i.viewer.camera.positionCartographic.height),t.pois.map(function(e){var t=e.location.split(",");t=u.default.gcj2wgs(t);var n=i.viewer.mars.point2map({x:t[0],y:t[1]});return{displayName:e.name,destination:s.default.Cartesian3.fromDegrees(n.x,n.y,r)}})})}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupLayer=void 0;var r=i(6),n=r.BaseLayer.extend({create:function(){for(var e=this.config._layers,t=0,i=e.length;t<i;t++)this.hasOpacity=e[t].hasOpacity,this.hasZIndex=e[t].hasZIndex},setVisible:function(e){for(var t=this.config._layers,i=0,r=t.length;i<r;i++)t[i].setVisible(e)},add:function(){for(var e=this.config._layers,t=0,i=e.length;t<i;t++)e[t].setVisible(!0)},remove:function(){for(var e=this.config._layers,t=0,i=e.length;t<i;t++)e[t].setVisible(!1)},centerAt:function(e){for(var t=this.config._layers,i=0,r=t.length;i<r;i++)t[i].centerAt(e)},setOpacity:function(e){for(var t=this.config._layers,i=0,r=t.length;i<r;i++)t[i].setOpacity(e)}});t.GroupLayer=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraticuleLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(6),o=a.BaseLayer.extend({model:null,add:function(){null==this.model&&this.initData(),this.model.setVisible(!0)},remove:function(){null!=this.model&&this.model.setVisible(!1)},initData:function(){function e(e,t){e=e||{},this._tilingScheme=e.tilingScheme||new n.default.GeographicTilingScheme,this._color=e.color||new n.default.Color(1,1,1,.4),this._tileWidth=e.tileWidth||256,this._tileHeight=e.tileHeight||256,this._ready=!0,this._sexagesimal=e.sexagesimal||!1,this._numLines=e.numLines||50,this._scene=t,this._labels=new n.default.LabelCollection,t.primitives.add(this._labels),this._polylines=new n.default.PolylineCollection,t.primitives.add(this._polylines),this._ellipsoid=t.globe.ellipsoid;var i=document.createElement("canvas");i.width=256,i.height=256,this._canvas=i;var r=this;t.camera.moveEnd.addEventListener(function(){r._show&&(r._polylines.removeAll(),r._labels.removeAll(),r._currentExtent=null,r._drawGrid(r._getExtentView()))}),t.imageryLayers.addImageryProvider(this)}function t(e){return e<.01?2:e<.1?1:0}var i=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(e){return!1}}(),r=Object.defineProperties;i&&r||(r=function(e){return e}),r(e.prototype,{url:{get:function(){}},proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),e.prototype.makeLabel=function(e,t,i,r,a){this._labels.add({position:this._ellipsoid.cartographicToCartesian(new n.default.Cartographic(e,t,10)),text:i,font:"normal small-caps normal 16px 楷体",style:n.default.LabelStyle.FILL_AND_OUTLINE,fillColor:n.default.Color.AZURE,outlineColor:n.default.Color.BLACK,outlineWidth:2,pixelOffset:new n.default.Cartesian2(5,r?5:-5),eyeOffset:n.default.Cartesian3.ZERO,horizontalOrigin:n.default.HorizontalOrigin.LEFT,verticalOrigin:r?n.default.VerticalOrigin.BOTTOM:n.default.VerticalOrigin.TOP,scale:1})},e.prototype._drawGrid=function(e){if(!this._currentExtent||!this._currentExtent.equals(e)){this._currentExtent=e,this._polylines.removeAll(),this._labels.removeAll();var i,r=(this._canvasSize,0),o=0;for(i=0;i<a.length&&r<(e.north-e.south)/10;i++)r=a[i];for(i=0;i<a.length&&o<(e.east-e.west)/10;i++)o=a[i];var s=(e.west<0?Math.ceil(e.west/o):Math.floor(e.west/o))*o,l=(e.south<0?Math.ceil(e.south/r):Math.floor(e.south/r))*r,u=(e.east<0?Math.ceil(e.east/r):Math.floor(e.east/r))*r,c=(e.north<0?Math.ceil(e.north/o):Math.floor(e.north/o))*o;s=Math.max(s-2*o,-Math.PI),u=Math.min(u+2*o,Math.PI),l=Math.max(l-2*r,-Math.PI/2),c=Math.min(c+2*o,Math.PI/2);var d,h,f=this._ellipsoid,p=n.default.Math.toRadians(1),g=l+Math.floor((c-l)/r/2)*r;for(h=s;h<u;h+=o){var m=[];for(d=l;d<c;d+=p)m.push(new n.default.Cartographic(h,d));m.push(new n.default.Cartographic(h,c)),this._polylines.add({positions:f.cartographicArrayToCartesianArray(m),width:1});var y=n.default.Math.toDegrees(h);this.makeLabel(h,g,this._sexagesimal?this._decToSex(y):y.toFixed(t(o)),!1)}var v=s+Math.floor((u-s)/o/2)*o;for(d=l;d<c;d+=r){var m=[];for(h=s;h<u;h+=p)m.push(new n.default.Cartographic(h,d));m.push(new n.default.Cartographic(u,d)),this._polylines.add({positions:f.cartographicArrayToCartesianArray(m),width:1});var _=n.default.Math.toDegrees(d);this.makeLabel(v,d,this._sexagesimal?this._decToSex(_):_.toFixed(t(r)),!0)}}},e.prototype.requestImage=function(e,t,i){return this._show&&this._drawGrid(this._getExtentView()),this._canvas},e.prototype.setVisible=function(e){this._show=e,e?(this._currentExtent=null,this._drawGrid(this._getExtentView())):(this._polylines.removeAll(),this._labels.removeAll())},e.prototype.isVisible=function(){return this._show},e.prototype._decToSex=function(e){var t=Math.floor(e),i=(60*(Math.abs(e)-t)).toFixed(2);return"60.00"==i&&(t+=1,i="0.00"),[t,":",i].join("")},e.prototype._getExtentView=function(){for(var e=this._scene.camera,t=this._scene.canvas,i=[e.pickEllipsoid(new n.default.Cartesian2(0,0),this._ellipsoid),e.pickEllipsoid(new n.default.Cartesian2(t.width,0),this._ellipsoid),e.pickEllipsoid(new n.default.Cartesian2(0,t.height),this._ellipsoid),e.pickEllipsoid(new n.default.Cartesian2(t.width,t.height),this._ellipsoid)],r=0;r<4;r++)if(void 0===i[r])return n.default.Rectangle.MAX_VALUE;return n.default.Rectangle.fromCartographicArray(this._ellipsoid.cartesianArrayToCartographicArray(i))};var a=[n.default.Math.toRadians(.05),n.default.Math.toRadians(.1),n.default.Math.toRadians(.2),n.default.Math.toRadians(.5),n.default.Math.toRadians(1),n.default.Math.toRadians(2),n.default.Math.toRadians(5),n.default.Math.toRadians(10)];this.model=new e({numLines:10},this.viewer.scene)}});t.GraticuleLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGridLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(19),o=a.TileLayer.extend({dataSource:null,hasOpacity:!1,create:function(){this.dataSource=new n.default.CustomDataSource,this.primitives=new n.default.PrimitiveCollection;var e=this;this.config.type_new="custom_featuregrid",this.config.addImageryCache=function(t){return e._addImageryCache(t)},this.config.removeImageryCache=function(t){return e._removeImageryCache(t)},this.config.removeAllImageryCache=function(t){return e._removeAllImageryCache(t)}},getLength:function(){return this.primitives.length+this.dataSource.entities.values.length},addEx:function(){this.viewer.dataSources.add(this.dataSource),this.viewer.scene.primitives.add(this.primitives)},removeEx:function(){this.viewer.dataSources.remove(this.dataSource),this.viewer.scene.primitives.remove(this.primitives)},_addImageryCache:function(e){},_removeImageryCache:function(e){},_removeAllImageryCache:function(){}});t.FeatureGridLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolylineEditor=void 0;var r=i(0),n=(function(e){e&&e.__esModule}(r),i(1)),a=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];for(var r=t.polyline.positions.getValue(),a=0;a<r.length;a++){var o=r[a],s=n.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:o,onDrag:function(e,i){r[e.index]=i,t._draw_positions=r,t.changeEditing()}});s.index=a,this.draggers.push(s)}};a.prototype.updateDraggers=function(){for(var e=this.entity.polyline.positions.getValue(),t=0;t<this.draggers.length;t++){var i=e[t];this.draggers[t].position=i}},a.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.PolylineEditor=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolygonEditor=void 0;var r=i(0),n=(function(e){e&&e.__esModule}(r),i(1)),a=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];for(var r=t.polygon.hierarchy.getValue(),a=0;a<r.length;a++){var o=r[a],s=n.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:o,clampToGround:t.attribute.style.hasOwnProperty("clampToGround")?t.attribute.style.clampToGround:!t.attribute.style.perPositionHeight,onDrag:function(e,i){e.positions[e.index]=i,t.changeEditing()}});s.index=a,s.positions=r,this.draggers.push(s)}};a.prototype.updateDraggers=function(){for(var e=this.entity.polygon.hierarchy.getValue(),t=0;t<this.draggers.length;t++){var i=e[t];this.draggers[t].position=i}},a.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.PolygonEditor=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolygonExtrudedEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[],this.heightDraggers=[];var r=this,o=0,s=t.polygon.hierarchy.getValue();for(o=0;o<s.length;o++){var l=s[o];if(void 0!=t.polygon.height){var u=n.default.Cartographic.fromCartesian(l);u.height+=t.polygon.height.getValue(),l=n.default.Cartesian3.fromRadians(u.longitude,u.latitude,u.height)}var c=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:l,onDrag:function(e,i){e.positions[e.index]=i;for(var a=t.polygon.hierarchy.getValue(),o=a[0],s=1;s<a.length;s++){var l=n.default.Cartographic.fromCartesian(o),u=n.default.Cartographic.fromCartesian(a[s]);Number(u.height)>Number(l.height)&&(o=a[s])}var c=Number(t.polygon.extrudedHeight)-Number(n.default.Cartographic.fromCartesian(o).height);t.attribute.style.extrudedHeight=Number(c.toFixed(2)),r.updateDraggers(),t.changeEditing()}});c.index=o,c.positions=s,this.draggers.push(c)}if(t.polygon.extrudedHeight)for(o=0;o<s.length;o++){var d=s[o],h=n.default.Cartographic.fromCartesian(d);h.height=t.polygon.extrudedHeight.getValue();var f=n.default.Cartesian3.fromRadians(h.longitude,h.latitude,h.height),c=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:f,color:a.drawutils.MoveHeightPointColor,tooltip:a.drawutils.MoveHeightTooltip,onDrag:function(e,i){for(var a=r.entity.polygon.hierarchy.getValue(),o=a[0],s=1;s<a.length;s++){var l=n.default.Cartographic.fromCartesian(o),u=n.default.Cartographic.fromCartesian(a[s]);Number(u.height)>Number(l.height)&&(o=a[s])}var c=n.default.Cartographic.fromCartesian(i);t.polygon.extrudedHeight=new n.default.ConstantProperty(Number(c.height));var d=Number(c.height)-Number(n.default.Cartographic.fromCartesian(o).height);t.attribute.style.extrudedHeight=Number(d.toFixed(2)),r.updateDraggers(),t.changeEditing()},vertical:!0,horizontal:!1});c.index=o,this.heightDraggers.push(c)}};o.prototype.updateDraggers=function(){var e=this.entity.polygon.hierarchy.getValue(),t=this.entity.polygon.extrudedHeight.getValue(),i=0;void 0!=this.entity.polygon.height&&(i=this.entity.polygon.height.getValue());for(var r=0;r<this.heightDraggers.length;r++){var a=e[r],o=this.heightDraggers[r],s=n.default.Cartographic.fromCartesian(a);s.height=t;var l=n.default.Cartesian3.fromRadians(s.longitude,s.latitude,s.height);o.position=l;var u=this.draggers[r],c=n.default.Cartographic.fromCartesian(a);c.height+=i,l=n.default.Cartesian3.fromRadians(c.longitude,c.latitude,c.height),u.position=l}},o.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);for(this.draggers=[],e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]},t.PolygonExtrudedEditor=o},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ArcFeatureGridLayer=void 0;var n=i(0),a=r(n),o=i(5),s=r(o),l=i(11),u=r(l),c=i(17),d=c.CustomFeatureGridLayer.extend({getDataForGrid:function(e,t){var i=this,r=this.config.url;this.config.layers&&this.config.layers.length>0&&(r+="/"+this.config.layers[0]);var n=u.default.query({url:r}),a=s.default.latLngBounds(s.default.latLng(e.rectangle.ymin,e.rectangle.xmin),s.default.latLng(e.rectangle.ymax,e.rectangle.xmax));n.within(a),this.config.where&&n.where(this.config.where),n.run(function(r,n,a){if(i._visible&&i._cacheGrid[e.key])return null!=r&&r.code>0?void console.log("arcgis服务访问出错"+r.message):void(void 0!=n&&null!=n&&("Feature"==n.type&&(n={type:"FeatureCollection",features:[n]}),t(n.features)))})},createEntity:function(e,t,i){var r=this;return a.default.GeoJsonDataSource.load(t,{clampToGround:!0}).then(function(t){if(!r.checkHasBreak[e.key]){if(0==t.entities.values.length)return null;var n=t.entities.values[0];n._id=r.config.id+"_"+e.key+"_"+n.id,r._addEntity(n,i)}}).otherwise(function(e){r.showError("服务出错",e)}),null},_addEntity:function(e,t){var i=this,r=this.config.symbol;r&&("function"==typeof r?r(e,e.properties):"default"==r?this.setDefSymbol(e):this.setConfigSymbol(e,r)),(this.config.columns||this.config.popup)&&(e.popup={html:function(e){return i.viewer.mars.popup.getPopupForConfig(i.config,e.properties)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(e.tooltip={html:function(e){return i.viewer.mars.popup.getPopupForConfig({popup:i.config.tooltip},e.properties)},anchor:this.config.tooltipAnchor||[0,-15]}),this.dataSource.entities.add(e),t(e)}});t.ArcFeatureGridLayer=d},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.POILayer=void 0;var n=i(0),a=r(n),o=i(4),s=r(o),l=i(12),u=r(l),c=i(17),d=i(18),h=i(9),f=i(8),p=c.CustomFeatureGridLayer.extend({_keys:null,_key_index:0,getKey:function(){this._keys||(this._keys=this.config.key||["c95467d0ed2a3755836e37dc27369f97","4320dda936d909d73ab438b4e29cf2a2","e64a96ed7e361cbdc0ebaeaf3818c564","df3247b7df64434adecb876da94755d7","d4375ec477cb0a473c448fb1f83be781","13fdd7b2b90a9d326ae96867ebcc34ce","c34502450ae556f42b21760faf6695a0","57f8ebe12797a73fc5b87f5d4ef859b1"]);var e=this._key_index++%this._keys.length;return this._keys[e]},getDataForGrid:function(e,t){var i=u.default.wgs2gcj([e.rectangle.xmin,e.rectangle.ymax]),r=u.default.wgs2gcj([e.rectangle.xmax,e.rectangle.ymin]),n=i[0]+","+i[1]+"|"+r[0]+","+r[1],a=this.config.filter||{};a.output="json",a.key=this.getKey(),a.polygon=n,a.offset||(a.offset=25),a.types||(a.types="120000|130000|190000");s.default.ajax({url:"http://restapi.amap.com/v3/place/polygon",type:"get",dataType:"json",timeout:"5000",data:a,success:function(e){if("10000"!==e.infocode)return void console.log("POI 请求失败("+e.infocode+")："+e.info);var i=e.pois;t(i)},error:function(e){console.log("POI 请求出错("+e.status+")："+e.statusText)}})},createEntity:function(e,t){var i="<div>名称："+t.name+"</div><div>地址："+t.address+"</div><div>区域："+t.pname+t.cityname+t.adname+"</div><div>类别："+t.type+"</div>",r=t.location.split(",");r=u.default.gcj2wgs(r);var n=this.viewer.mars.point2map({x:r[0],y:r[1]}),o={name:t.name,position:a.default.Cartesian3.fromDegrees(n.x,n.y,this.config.height||3),popup:{html:i,anchor:[0,-15]},properties:t},l=this.config.symbol;if(l){var c=l.styleOptions;if(l.styleField){var p=attr[l.styleField],g=l.styleFieldOptions[p];null!=g&&(c=s.default.extend({},c),c=s.default.extend(c,g))}c=c||{},c.image?(o.billboard=h.BillboardControl.attribute2Entity({style:c}),o.billboard.heightReference=a.default.HeightReference.RELATIVE_TO_GROUND):o.point=d.PointControl.attribute2Entity({style:c}),c.label&&(o.label=f.LabelControl.attribute2Entity({style:c.label}),o.label.heightReference=a.default.HeightReference.RELATIVE_TO_GROUND,o.label.text=t.name)}else o.point={color:new a.default.Color.fromCssColorString("#3388ff"),pixelSize:10,outlineColor:new a.default.Color.fromCssColorString("#ffffff"),outlineWidth:2,heightReference:a.default.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new a.default.NearFarScalar(1e3,1,2e4,.5)},o.label={text:t.name,font:"normal small-caps normal 16px 楷体",style:a.default.LabelStyle.FILL_AND_OUTLINE,fillColor:a.default.Color.AZURE,outlineColor:a.default.Color.BLACK,outlineWidth:2,horizontalOrigin:a.default.HorizontalOrigin.CENTER,verticalOrigin:a.default.VerticalOrigin.BOTTOM,pixelOffset:new a.default.Cartesian2(0,-15),heightReference:a.default.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new a.default.NearFarScalar(1e3,1,5e3,.8),distanceDisplayCondition:new a.default.DistanceDisplayCondition(0,5e3)};return this.dataSource.entities.add(o)}});t.POILayer=p},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ArcFeatureLayer=void 0;var n=i(0),a=r(n),o=i(5),s=(r(o),i(11)),l=r(s),u=i(15),c=i(2),d=u.GeoJsonLayer.extend({queryData:function(){var e=this,t=this.config.url;this.config.layers&&this.config.layers.length>0&&(t+="/"+this.config.layers[0]);var i=l.default.query({url:t});this.config.where&&i.where(this.config.where),i.run(function(t,i,r){if(null!=t&&t.code>0)return void(0,c.alert)(t.message,"服务访问出错");if(void 0==i||null==i||0==i.features.length)return void(0,c.msg)("未找到符合查询条件的要素！");for(var n=[],o=0;o<i.features.length;o++){var s=i.features[o];null!=s&&null!=s.geometry&&(s.geometry.coordinates&&0==s.geometry.coordinates.length||n.push(s))}i.features=n,a.default.GeoJsonDataSource.load(i,{clampToGround:!0}).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})})}});t.ArcFeatureLayer=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GltfLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(6),o=a.BaseLayer.extend({model:null,add:function(){this.model?this.viewer.entities.add(this.model):this.initData()},remove:function(){this.viewer.entities.remove(this.model)},centerAt:function(e){if(null!=this.model)if(this.config.extent||this.config.center)this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{var t=this.config.position;this.viewer.mars.centerAt(t,{duration:e,isWgs84:!0})}},initData:function(){var e=this.config.position;e=this.viewer.mars.point2map(e);var t=n.default.Cartesian3.fromDegrees(e.x,e.y,e.z||0),i=n.default.Math.toRadians(e.heading||0),r=n.default.Math.toRadians(e.pitch||0),a=n.default.Math.toRadians(e.roll||0),o=new n.default.HeadingPitchRoll(i,r,a),s=n.default.Transforms.headingPitchRollQuaternion(t,o),l={uri:this.config.url};for(var u in this.config)"url"!=u&&"name"!=u&&"position"!=u&&"center"!=u&&"tooltip"!=u&&"popup"!=u&&(l[u]=this.config[u]);this.model=this.viewer.entities.add({name:this.config.name,position:t,orientation:s,model:l,_config:this.config,tooltip:this.config.tooltip,popup:this.config.popup})},hasOpacity:!0,setOpacity:function(e){null!=this.model&&(this.model.model.color=new n.default.Color.fromCssColorString("#FFFFFF").withAlpha(e))}});t.GltfLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tiles3dLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(6),o=i(2),s=i(7),l=a.BaseLayer.extend({model:null,originalCenter:null,boundingSphere:null,add:function(){this.model?this.viewer.scene.primitives.add(this.model):this.initData()},remove:function(){this.viewer.scene.primitives.remove(this.model),this.model=null},centerAt:function(e){this.config.extent||this.config.center?this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.boundingSphere&&this.viewer.camera.flyToBoundingSphere(this.boundingSphere,{offset:new n.default.HeadingPitchRange(0,-.5,2*this.boundingSphere.radius),duration:e})},initData:function(){this.config.maximumScreenSpaceError=this.config.maximumScreenSpaceError||1,this.model=this.viewer.scene.primitives.add(new n.default.Cesium3DTileset(this.config)),this.model._config=this.config,this.model.tooltip=this.config.tooltip,this.model.popup=this.config.popup;var e=this;this.model.readyPromise.then(function(t){e.hasOpacity&&1!=e._opacity&&e.setOpacity(e._opacity);var i=t.boundingSphere;e.boundingSphere=i;var r=i.center,a=n.default.Cartographic.fromCartesian(r),o=Number(a.height.toFixed(2)),s=Number(n.default.Math.toDegrees(a.longitude).toFixed(6)),l=Number(n.default.Math.toDegrees(a.latitude).toFixed(6));e.originalCenter={x:s,y:l,z:o},console.log((e.config.name||"")+" 模型原始位置:"+JSON.stringify(e.originalCenter));var u=e.viewer.mars.point2map(e.originalCenter);if(u.x!=e.originalCenter.x||u.y!=e.originalCenter.y||null!=e.config.offset){e.config.offset=e.config.offset||{},e.config.offset.x&&e.config.offset.y&&(e.config.offset=e.viewer.mars.point2map(e.config.offset));var c={x:e.config.offset.x||u.x,y:e.config.offset.y||u.y,z:e.config.offset.z||0,heading:e.config.offset.heading||0};"-height"==e.config.offset.z?(c.z=5-o,e.updateMatrix(c)):"auto"==e.config.offset.z?e.autoHeight(r,c):e.updateMatrix(c)}!e.viewer.mars.isFlyAnimation()&&e.config.flyTo&&e.centerAt(0),e.config.calback&&e.config.calback(t)})},updateMatrix:function(e){if(null!=this.model){console.log(" 模型修改后位置:"+JSON.stringify(e));var t=!1;if(0!=e.heading&&this.model._root&&this.model._root.transform){var i=n.default.Matrix4.fromArray(this.model._root.transform),r=n.default.Matrix4.getTranslation(i,new n.default.Cartesian3);if(n.default.Cartographic.fromCartesian(r)){var a=n.default.Cartesian3.fromDegrees(e.x,e.y,e.z),i=n.default.Transforms.eastNorthUpToFixedFrame(a),o=n.default.Matrix4.fromRotationTranslation(n.default.Matrix3.fromRotationZ(n.default.Math.toRadians(e.heading)));n.default.Matrix4.multiply(i,o,i),this.model._root.transform=i,t=!0}}if(!t){var s=this.model.boundingSphere,l=n.default.Cartographic.fromCartesian(s.center),u=n.default.Cartesian3.fromRadians(l.longitude,l.latitude,0),c=n.default.Cartesian3.fromDegrees(e.x,e.y,e.z),d=n.default.Cartesian3.subtract(c,u,new n.default.Cartesian3);this.model.modelMatrix=n.default.Matrix4.fromTranslation(d)}}},autoHeight:function(e,t){var i=this;(0,o.terrainPolyline)({viewer:this.viewer,positions:[e,e],calback:function(e,r){if(null!=e&&0!=e.length&&!r){var n=(0,s.formatPositon)(e[0]),a=n.z-i.originalCenter.z+1;t.z=a,i.updateMatrix(t)}}})},hasOpacity:!0,setOpacity:function(e){this._opacity=e,this.model&&(this.model.style=new n.default.Cesium3DTileStyle({color:"color() *vec4(1,1,1,"+e+")"}))}});t.Tiles3dLayer=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KmlLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(15),o=a.GeoJsonLayer.extend({queryData:function(){var e=this;n.default.KmlDataSource.load(this.config.url,{camera:this.viewer.scene.camera,canvas:this.viewer.scene.canvas}).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})},getEntityAttr:function(e){var t={name:e._name},i=e._kml.extendedData;for(var r in i)t[r]=i[r].value;return t}});t.KmlLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CzmlLayer=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(15),o=a.GeoJsonLayer.extend({queryData:function(){var e=this;n.default.CzmlDataSource.load(this.config.url).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})},getEntityAttr:function(e){if(e.description&&e.description.getValue)return e.description.getValue()}});t.CzmlLayer=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainLayer=void 0;var r=i(0),n=(function(e){e&&e.__esModule}(r),i(6)),a=i(2),o=n.BaseLayer.extend({terrain:null,add:function(){this.terrain||(this.terrain=(0,a.getTerrainProvider)(this.config)),this.viewer.terrainProvider=this.terrain},remove:function(){this.viewer.terrainProvider=(0,a.getEllipsoidTerrain)()}});t.TerrainLayer=o},function(e,t,i){"use strict";function r(e){if(e=a.default.defaultValue(e,a.default.defaultValue.EMPTY_OBJECT),this.options=e,this._tileWidth=a.default.defaultValue(e.tileWidth,256),this._tileHeight=a.default.defaultValue(e.tileHeight,256),this._minimumLevel=a.default.defaultValue(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,e.rectangle&&e.rectangle.xmin&&e.rectangle.xmax&&e.rectangle.ymin&&e.rectangle.ymax){var t=e.rectangle.xmin,i=e.rectangle.xmax,r=e.rectangle.ymin,n=e.rectangle.ymax;e.rectangle=a.default.Rectangle.fromDegrees(t,r,i,n)}this._tilingScheme=a.default.defaultValue(e.tilingScheme,new a.default.GeographicTilingScheme({ellipsoid:e.ellipsoid})),this._rectangle=a.default.defaultValue(e.rectangle,this._tilingScheme.rectangle),this._rectangle=a.default.Rectangle.intersection(this._rectangle,this._tilingScheme.rectangle),this._hasAlphaChannel=a.default.defaultValue(e.hasAlphaChannel,!0),this._errorEvent=new a.default.Event,this._readyPromise=a.default.when.resolve(!0),this._credit=void 0,this._ready=!0}Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGridImageryProvider=void 0;var n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n);a.default.defineProperties(r.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){var r=document.createElement("canvas");if(r.width=256,r.height=256,i<this._minimumLevel)return r;if(this.options.debuggerTileInfo){var n=r.getContext("2d");n.strokeStyle="#ffff00",n.lineWidth=2,n.strokeRect(1,1,255,255);var a="L"+i+"X"+e+"Y"+t;n.font="bold 25px Arial",n.textAlign="center",n.fillStyle="black",n.fillText(a,127,127),n.fillStyle="#ffff00",n.fillText(a,124,124)}return r},r.prototype._getGridKey=function(e){return e.level+"_x"+e.x+"_y"+e.y},r.prototype.addImageryCache=function(e){e.level<this._minimumLevel||e.level<e.maxLevel-1||this.options.addImageryCache&&(e.key=this._getGridKey(e),this.options.addImageryCache(e))},r.prototype.removeImageryCache=function(e){e.maxLevel<this._minimumLevel&&this.options.removeAllImageryCache&&this.options.removeAllImageryCache(),e.level<this._minimumLevel||this.options.removeImageryCache&&(e.key=this._getGridKey(e),this.options.removeImageryCache(e))},t.FeatureGridImageryProvider=r},function(e,t,i){"use strict";function r(e,t){return n(e,u.default.Matrix4.fromRotationTranslation(u.default.Matrix3.fromQuaternion(t,c),e,d))}function n(e,t){var i=u.default.Transforms.eastNorthUpToFixedFrame(e,u.default.Ellipsoid.WGS84,new u.default.Matrix4),r=u.default.Matrix4.multiply(u.default.Matrix4.inverse(i,new u.default.Matrix4),t,new u.default.Matrix4),n=u.default.Matrix4.getRotation(r,new u.default.Matrix3),a=u.default.Quaternion.fromRotationMatrix(n);return u.default.HeadingPitchRoll.fromQuaternion(a)}function a(e,t,i){i=i||u.default.Ellipsoid.WGS84;var r=u.default.Cartesian3.normalize(u.default.Cartesian3.subtract(t,e,h),h);u.default.Transforms.rotationMatrixFromPositionVelocity(e,r,i,f);var a=u.default.Matrix4.fromRotationTranslation(f,e,d);return u.default.Matrix4.multiplyTransformation(a,u.default.Axis.Z_UP_TO_X_UP,a),n(e,a)}function o(e,t,i){var r=u.default.Cartographic.fromCartesian(e);r.height=0;var n=u.default.Cartographic.toCartesian(r),a=u.default.Cartesian3.normalize(u.default.Cartesian3.subtract(n,e,new u.default.Cartesian3),new u.default.Cartesian3),o=u.default.Quaternion.fromAxisAngle(a,u.default.Math.toRadians(i)),s=u.default.Matrix3.fromQuaternion(o),l=u.default.Matrix4.fromRotationTranslation(s),c=u.default.Cartesian3.subtract(t,e,new u.default.Cartesian3),d=u.default.Matrix4.multiplyByPoint(l,c,new u.default.Cartesian3);return u.default.Cartesian3.add(d,e,new u.default.Cartesian3)}function s(e,t,i,r){i=i||0,r=r||"z";var n=u.default.Math.toRadians(-i);r="UNIT_"+r.toUpperCase();var a=u.default.Quaternion.fromAxisAngle(u.default.Cartesian3[r],n),o=u.default.Matrix3.fromQuaternion(a),s=new u.default.Cartesian3(t.x,t.y,t.z),l=u.default.Matrix4.fromRotationTranslation(o,u.default.Cartesian3.ZERO);u.default.Matrix4.multiplyByTranslation(l,s,l);var c=u.default.Ellipsoid.WGS84.cartographicToCartesian(u.default.Cartographic.fromCartesian(e)),d=u.default.Transforms.eastNorthUpToFixedFrame(c);u.default.Matrix4.multiplyTransformation(d,l,l);var h=new u.default.Cartesian3;return u.default.Matrix4.getTranslation(l,h),h}Object.defineProperty(t,"__esModule",{value:!0}),t.getHeadingPitchRollByOrientation=r,t.getHeadingPitchRollByMatrix=n,t.getHeadingPitchRollForLine=a,t.getRotateCenterPoint=o,t.getPositionTranslation=s;var l=i(0),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c=new u.default.Matrix3,d=new u.default.Matrix4,h=new u.default.Cartesian3,d=new u.default.Matrix4,f=new u.default.Matrix3},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Measure=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(20),o=i(8),s=i(10),l=i(1),u=i(2),c=i(7),d=function(e){function t(e){p(),C="length",e=e||{},e.type=C,e.hasOwnProperty("terrain")||(e.terrain=!0),M.start(e)}function i(e){p(),C="section",e=e||{},e.type=C,e.terrain=!0,M.start(e)}function r(e){p(),C="area",e=e||{},e.type=C,E.start(e)}function d(e){p(),C="volume",e=e||{},e.type=C,L.start(e)}function h(e){p(),e=e||{},e.hasOwnProperty("isSuper")&&!e.isSuper?(C="height",e.type=C,S.start(e)):(C="super_height",e.type=C,T.start(e))}function f(e){p(),C="angle",e=e||{},e.type=C,D.start(e)}function p(){M.clearLastNoEnd(),E.clearLastNoEnd(),L.clearLastNoEnd(),S.clearLastNoEnd(),T.clearLastNoEnd(),D.clearLastNoEnd(),x.stopDraw()}function g(){C="",p(),x.deleteAll()}function m(e,t){var i=P.entities.values;for(var r in i){var n=i[r];if(n.label&&n.isMarsMeasureLabel&&n.attribute&&n.attribute.value){if(n.attribute.type!=e)continue;"area"==e?n.label.text._value=(n.attribute.textEx||"")+y(n.attribute.value,t):n._label.text._value=(n.attribute.textEx||"")+v(n.attribute.value,t)}}}function y(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e6?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"平方米";break;case"km":i=(e/1e6).toFixed(2)+"平方公里";break;case"mu":i=(.0015*e).toFixed(2)+"亩";break;case"ha":i=(1e-4*e).toFixed(2)+"公顷"}return i}function v(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e3?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"米";break;case"km":i=(.001*e).toFixed(2)+"公里";break;case"mile":i=(54e-5*e).toFixed(2)+"海里";break;case"zhang":i=(.3*e).toFixed(2)+"丈"}return i}var _=e.viewer,b={color:"#ffffff",font_family:"楷体",font_size:20,border:!0,border_color:"#000000",border_width:3,background:!0,background_color:"#000000",background_opacity:.5,scaleByDistance:!0,scaleByDistance_far:8e5,scaleByDistance_farValue:.5,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,pixelOffset:[0,-15],disableDepthTestDistance:Number.POSITIVE_INFINITY};if(e.label)for(var w in e.label)b[w]=e.label[w];var C="",x=new a.Draw({viewer:_,hasEdit:!1,onChangeDrawing:function(e){switch(C){case"length":case"section":M.showAddPointLength(e);break;case"area":E.showAddPointLength(e);break;case"volume":L.showAddPointLength(e);break;case"height":S.showAddPointLength(e);break;case"super_height":T.showAddPointLength(e);break;case"angle":D.showAddPointLength(e)}},onMoveDrawing:function(e){switch(C){case"length":case"section":M.showMoveDrawing(e);break;case"area":E.showMoveDrawing(e);break;case"volume":L.showMoveDrawing(e);break;case"height":S.showMoveDrawing(e);break;case"super_height":T.showMoveDrawing(e);break;case"angle":D.showMoveDrawing(e)}},onStopDrawing:function(e){switch(C){case"length":case"section":M.showDrawEnd(e);break;case"area":E.showDrawEnd(e);break;case"volume":L.showDrawEnd(e);break;case"height":S.showDrawEnd(e);break;case"super_height":T.showDrawEnd(e);break;case"angle":D.showDrawEnd(e)}}}),P=x.getDataSource(),M={options:null,arrLables:[],totalLable:null,clearLastNoEnd:function(){if(null!=this.totalLable&&P.entities.remove(this.totalLable),this.arrLables&&this.arrLables.length>0){var e=this.arrLables;if(e&&e.length>0)for(var t in e)P.entities.remove(e[t])}this.totalLable=null,this.arrLables=[]},start:function(e){this.options=e;var t=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.LEFT,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=P.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.arrLables=[],x.startDraw({type:"polyline",addHeight:e.addHeight,style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1,clampToGround:"section"==this.options.type||this.options.terrain}})},showAddPointLength:function(e){var t=x.getPositions(e),i=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.LEFT,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!0}),r=P.entities.add({position:t[t.length-1],label:i,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}});if(1==t.length)r.label.text="起点";else{var a=this.getLength(t),s=v(a,this.options.unit);r.label.text=s,r.attribute.value=a,this.getLength([t[t.length-2],t[t.length-1]])<5&&(r.show=!1)}this.arrLables.push(r)},showMoveDrawing:function(e){var t=x.getPositions(e);if(!(t.length<2)){var i=this.getLength(t),r=v(i,this.options.unit);this.totalLable.position=t[t.length-1],this.totalLable.label.text="总长:"+r,this.totalLable.label.show=!0,this.totalLable.attribute.value=i,this.totalLable.attribute.textEx="总长:",this.options.calback&&this.options.calback(r,i)}},showDrawEnd:function(e){var t=x.getPositions(e),i=this.arrLables.length-t.length;if(i>=0){for(var r=this.arrLables.length-1;r>=t.length-1;r--)P.entities.remove(this.arrLables[r]);this.arrLables.splice(t.length-1,i+1)}e._totalLable=this.totalLable,e._arrLables=this.arrLables,this.totalLable=null,this.arrLables=[],null!=e.polyline&&("section"==this.options.type?this.updateSectionForTerrain(e):this.options.terrain&&this.updateLengthForTerrain(e))},updateLengthForTerrain:function(e){function t(){s++;var c=[r[s-1],r[s]];(0,u.terrainPolyline)({viewer:_,positions:c,calback:function(u,d){if(l=d?1==s?l.concat(c):l.concat([r[s]]):l.concat(u),s>=r.length-1){if(e.polyline.positions.setValue(l),a){var h=i.getLength(l),f=v(h,o);a.label.text="总长:"+f,a.attribute.value=h,i.options.calback&&i.options.calback(f,h)}}else{var h=i.getLength(u),f=v(h,o),p=n[s];p.label.text=f,p.attribute.value=h,t()}}})}var i=this,r=e.polyline.positions.getValue(),n=e._arrLables,a=e._totalLable,o=a&&a.unit,s=0,l=[];t()},updateSectionForTerrain:function(e){function t(){s++;var e=[i[s-1],i[s]];(0,u.terrainPolyline)({viewer:_,positions:e,calback:function(u,y){l=y?1==s?l.concat(e):l.concat([i[s]]):l.concat(u);for(var _=n.default.Cartographic.fromCartesian(i[s-1]).height,b=n.default.Cartographic.fromCartesian(i[s]).height,w=(b-_)/u.length,C=0;C<u.length;C++){0!=C&&(d+=n.default.Cartesian3.distance(u[C],u[C-1])),h.push(Number(d.toFixed(1)));var x=(0,c.formatPositon)(u[C]);f.push(x.z),g.push(x);var P=Number((_+w*C).toFixed(1));p.push(P)}if(s>=i.length-1){if(a){var M=m.getLength(l),E=v(M,o);a.label.text="总长:"+E,a.attribute.value=M}m.options.calback&&m.options.calback({distancestr:E,distance:M,arrLen:h,arrLX:p,arrHB:f,arrPoint:g})}else{var M=m.getLength(u),E=v(M,o),L=r[s];L.label.text=E,L.attribute.value=M,t()}}})}var i=e.polyline.positions.getValue();if(!(i.length<2)){var r=e._arrLables,a=e._totalLable,o=a&&a.unit,s=0,l=[],d=0,h=[],f=[],p=[],g=[],m=this;t()}},getLength:function(e){for(var t=0,i=0,r=e.length-1;i<r;i++)t+=n.default.Cartesian3.distance(e[i],e[i+1]);return t}},E={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&P.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.CENTER,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=P.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),x.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:1,opacity:.4,clampToGround:!0}})},showAddPointLength:function(e){},showMoveDrawing:function(e){var t=x.getPositions(e);if(!(t.length<3)){var i=s.PolygonControl.toGeoJSON(e),r=turf.area(i),a=y(r,this.options.unit),o=turf.centerOfMass(i),u=l.drawutils.getMaxHeightForPositions(t),c=n.default.Cartesian3.fromDegrees(o.geometry.coordinates[0],o.geometry.coordinates[1],u+1);this.totalLable.position=c,this.totalLable.label.text="面积:"+a,this.totalLable.label.show=!0,this.totalLable.attribute.value=r,this.totalLable.attribute.textEx="面积:",this.options.calback&&this.options.calback(a,r)}},showDrawEnd:function(e){if(null!=e.polygon){for(var t=e.polygon.hierarchy.getValue(),i=0,r=t.length;i<r;i++)t[i].z=t[i].z+1;e._totalLable=this.totalLable,this.totalLable=null}}},L={options:null,totalLable:null,prevEntity:null,clearLastNoEnd:function(){null!=this.totalLable&&P.entities.remove(this.totalLable),this.totalLable=null,null!=this.prevEntity&&P.entities.remove(this.prevEntity),this.prevEntity=null},start:function(e){this.options=e;var t=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.CENTER,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=P.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),x.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:1,opacity:.4,clampToGround:!0}})},showAddPointLength:function(e){},showMoveDrawing:function(e){},showDrawEnd:function(e){if(null!=e.polygon){var t=e.polygon.hierarchy.getValue(),i=this.computeCutVolume(t),r=i.maxHeight,a=i.totalCutVolume,o=a.toFixed(2)+"立方米",s=this.computeCentroidOfPolygon(t),l=n.default.Cartesian3.fromRadians(s.longitude,s.latitude,r+10);this.totalLable.position=l,this.totalLable.label.text="挖方体积:"+o,this.totalLable.label.show=!0,this.totalLable.attribute.value=a,this.totalLable.attribute.textEx="挖方体积:",this.options.calback&&this.options.calback(areastr,a),P.entities.remove(e),e=P.entities.add({polygon:{hierarchy:{positions:t},extrudedHeight:r,closeTop:!1,closeBottom:!1,material:new n.default.Color.fromCssColorString("#00fff2").withAlpha(.5),outline:!0,outlineColor:new n.default.Color.fromCssColorString("#fafa5a").withAlpha(.4),outlineWidth:1}}),e._totalLable=this.totalLable,this.totalLable=null}},computeCutVolume:function(e){for(var t=15e3,i=0;i<e.length;i++){var r=n.default.Cartographic.fromCartesian(e[i]),a=_.scene.globe.getHeight(r);t>a&&(t=a)}var o=Math.PI/Math.pow(2,11);o/=64;for(var s,l,u,c,d,h,f,p,g,m,r,y,v=new n.default.PolygonGeometry.fromPositions({positions:e,vertexFormat:n.default.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:o}),b=new n.default.PolygonGeometry.createGeometry(v),w=0,C=0,i=0;i<b.indices.length;i+=3){s=b.indices[i],l=b.indices[i+1],u=b.indices[i+2],m=new n.default.Cartesian3(b.attributes.position.values[3*s],b.attributes.position.values[3*s+1],b.attributes.position.values[3*s+2]),r=n.default.Cartographic.fromCartesian(m),c=_.scene.globe.getHeight(r),f=n.default.Cartesian3.fromRadians(r.longitude,r.latitude,0),C<c&&(C=c),m=new n.default.Cartesian3(b.attributes.position.values[3*l],b.attributes.position.values[3*l+1],b.attributes.position.values[3*l+2]),r=n.default.Cartographic.fromCartesian(m),d=_.scene.globe.getHeight(r);var p=n.default.Cartesian3.fromRadians(r.longitude,r.latitude,0);C<d&&(C=d),m=new n.default.Cartesian3(b.attributes.position.values[3*u],b.attributes.position.values[3*u+1],b.attributes.position.values[3*u+2]),r=n.default.Cartographic.fromCartesian(m),h=_.scene.globe.getHeight(r),g=n.default.Cartesian3.fromRadians(r.longitude,r.latitude,0),C<h&&(C=h),y=this.computeAreaOfTriangle(f,p,g),w+=y*(c-t+d-t+h-t)/3}return{maxHeight:C,totalCutVolume:w}},computeAreaOfTriangle:function(e,t,i){var r=n.default.Cartesian3.distance(e,t),a=n.default.Cartesian3.distance(t,i),o=n.default.Cartesian3.distance(i,e),s=(r+a+o)/2;return Math.sqrt(s*(s-r)*(s-a)*(s-o))},computeCentroidOfPolygon:function(e){for(var t=[],i=[],r=0;r<e.length;r++){var a=n.default.Cartographic.fromCartesian(e[r]);t.push(a.longitude),i.push(a.latitude)}var o=0,s=0,l=0,u=0,c=0,d=0,h=0,f=0;for(r=0;r<e.length;r++)o=t[r],s=i[r],r==e.length-1?(l=t[0],u=i[0]):(l=t[r+1],u=i[r+1]),d=o*u-l*s,c+=d,h+=(o+l)*d,f+=(s+u)*d;return c*=.5,h/=6*c,f/=6*c,new n.default.Cartographic(h,f)}},S={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&P.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.RIGHT,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=P.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),x.startDraw({type:"polyline",minMaxPoints:{min:2,max:2,isSuper:!1},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){},showMoveDrawing:function(e){var t=x.getPositions(e);if(!(t.length<2)){var i=n.default.Cartographic.fromCartesian(t[0]),r=n.default.Cartographic.fromCartesian(t[1]),a=Math.abs(r.height-i.height),o=v(a,this.options.unit);this.totalLable.position=l.drawutils.getMidPosition(t[0],t[1]),this.totalLable.label.text="高度差:"+o,this.totalLable.label.show=!0,this.totalLable.attribute.value=a,this.totalLable.attribute.textEx="高度差:",this.options.calback&&this.options.calback(o,a)}},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null}},T={options:null,totalLable:null,xLable:null,hLable:null,clearLastNoEnd:function(){null!=this.totalLable&&P.entities.remove(this.totalLable),null!=this.xLable&&P.entities.remove(this.xLable),null!=this.hLable&&P.entities.remove(this.hLable),this.totalLable=null,this.xLable=null,this.hLable=null},start:function(e){this.options=e;var t=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.RIGHT,verticalOrigin:n.default.VerticalOrigin.CENTER,show:!1});this.totalLable=P.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}});var i=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.CENTER,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!1});i.pixelOffset=new n.default.Cartesian2(0,0),this.xLable=P.entities.add({label:i,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.hLable=P.entities.add({label:i,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),x.startDraw({type:"polyline",minMaxPoints:{min:2,max:2,isSuper:!0},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){var t=x.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var r=l.drawutils.getZHeightPosition(t[0],t[1]);l.drawutils.getHDistance(t[0],t[1])>3&&(t.push(r),t.push(t[0]))}this.showSuperHeight(t)},showMoveDrawing:function(e){var t=x.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var r=l.drawutils.getZHeightPosition(t[0],t[1]);l.drawutils.getHDistance(t[0],t[1])>3&&(t.push(r),t.push(t[0]))}this.showSuperHeight(t)},showDrawEnd:function(e){e._arrLables=[this.totalLable,this.hLable,this.xLable],this.totalLable=null,this.hLable=null,this.xLable=null},showSuperHeight:function(e){var t,i,r,a;if(4==e.length){var o,s,u=l.drawutils.getMidPosition(e[0],e[1]),c=n.default.Cartographic.fromCartesian(e[0]),d=n.default.Cartographic.fromCartesian(e[1]),h=n.default.Cartographic.fromCartesian(e[2]),f=d.height-h.height;a=d.height-c.height,r=n.default.Cartesian3.distance(e[0],e[1]),a>-1&&a<1?(s=e[1],this.updateSuperHeightLabel(this.totalLable,s,"高度差:",a),this.updateSuperHeightLabel(this.hLable,u,"",r)):(f>-.1&&f<.1?(o=l.drawutils.getMidPosition(e[2],e[1]),s=l.drawutils.getMidPosition(e[2],e[3]),i=n.default.Cartesian3.distance(e[1],e[2]),t=n.default.Cartesian3.distance(e[3],e[2])):(s=l.drawutils.getMidPosition(e[2],e[1]),o=l.drawutils.getMidPosition(e[2],e[3]),i=n.default.Cartesian3.distance(e[3],e[2]),t=n.default.Cartesian3.distance(e[1],e[2])),this.updateSuperHeightLabel(this.totalLable,s,"高度差:",t),this.updateSuperHeightLabel(this.xLable,o,"",i),this.updateSuperHeightLabel(this.hLable,u,"",r))}else if(2==e.length){t=n.default.Cartesian3.distance(e[1],e[0]);var s=l.drawutils.getMidPosition(e[0],e[1]);xLable.label.show&&(xLable.label.show=!1,hLable.label.show=!1),this.updateSuperHeightLabel(this.totalLable,s,"高度差:",t)}var p=v(t,this.options.unit);this.options.calback&&this.options.calback(p,t)},updateSuperHeightLabel:function(e,t,i,r){null!=e&&(e.position=t,e.label.text=i+v(r,this.options.unit),e.label.show=!0,e.attribute.value=r,e.attribute.textEx=i)}},D={options:null,totalLable:null,exLine:null,clearLastNoEnd:function(){null!=this.totalLable&&P.entities.remove(this.totalLable),this.totalLable=null,null!=this.exLine&&P.entities.remove(this.exLine),this.exLine=null},start:function(e){this.options=e;var t=o.LabelControl.attribute2Entity({style:b},{horizontalOrigin:n.default.HorizontalOrigin.LEFT,verticalOrigin:n.default.VerticalOrigin.BOTTOM,show:!1});this.totalLable=P.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),x.startDraw({type:"polyline",minMaxPoints:{min:2,max:2},style:e.style||{lineType:"arrow",color:"#ebe967",width:9,clampToGround:!0}})},showAddPointLength:function(e){},showMoveDrawing:function(e){var t=x.getPositions(e);if(!(t.length<2)){var i=n.default.Cartesian3.distance(t[0],t[1]),r=(0,c.formatPositon)(t[0]),a=(0,c.formatPositon)(t[1]),o=turf.point([r.x,r.y,r.z]),s=turf.point([a.x,a.y,a.z]),l=Math.round(turf.rhumbBearing(o,s)),u=turf.destination(o,i/3e3,0,{units:"kilometers"});u={x:u.geometry.coordinates[0],y:u.geometry.coordinates[1],z:r.z};var d=n.default.Cartesian3.fromDegrees(u.x,u.y,u.z);this.updateExLine([t[0],d]),this.totalLable.position=t[1],this.totalLable.label.text="角度:"+l+"°\n距离:"+v(i),this.totalLable.label.show=!0,this.totalLable.attribute.value=l,this.totalLable.attribute.textEx="角度:",this.options.calback&&this.options.calback(l+"°",l)}},updateExLine:function(e){this.exLine?this.exLine.polyline.positions.setValue(e):this.exLine=P.entities.add({polyline:{positions:e,width:3,clampToGround:!0,material:new n.default.PolylineDashMaterialProperty({color:n.default.Color.RED})}})},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null,this.exLine=null}};return{measuerLength:t,measureHeight:h,measureArea:r,measureVolume:d,measureSection:i,measureAngle:f,updateUnit:m,clearMeasure:g,formatArea:y,formatLength:v}};t.Measure=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){this.dataSource=e,this.entity=t,this.options=i,this.draggers=[],this.heightDraggers=[],this.initDraggers()};o.prototype.initDraggers=function(){var e=this,t=this.entity.position.getValue(),i=n.default.Cartographic.fromCartesian(t);this.entity.attribute.style.height!=i.height&&(t=n.default.Cartesian3.fromRadians(i.longitude,i.latitude,this.entity.attribute.style.height),this.entity.position.setValue(t));var r=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:t,clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=new n.default.Cartesian3;if(n.default.Cartesian3.subtract(i,e.entity.position.getValue(),r),!e.entity.attribute.style.clampToGround){var a=n.default.Cartographic.fromCartesian(i);e.entity.ellipse.height=new n.default.ConstantProperty(a.height),e.entity.attribute.style.height=Number(a.height.toFixed(2))}e.entity.position.setValue(i);var o=new n.default.Cartesian3;n.default.Cartesian3.add(t.majorDragger.position.getValue(),r,o),t.majorDragger.position=new n.default.ConstantProperty(o),t.minorDragger&&(n.default.Cartesian3.add(t.minorDragger.position.getValue(),r,o),t.minorDragger.position=new n.default.ConstantProperty(o)),void 0!=e.entity.attribute.style.extrudedHeight&&e.updateHeightDraggers(),e.entity.changeEditing()}});this.draggers.push(r);var o=n.default.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMinorAxis:this.entity.ellipse.semiMinorAxis.getValue(),semiMajorAxis:this.entity.ellipse.semiMajorAxis.getValue(),rotation:n.default.Math.toRadians(Number(this.entity.attribute.style.rotation||0)),granularity:2},!0,!1),s=new n.default.Cartesian3(o.positions[0],o.positions[1],o.positions[2]),l=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:s,clampToGround:this.entity.attribute.style.clampToGround,color:a.drawutils.MovePointColor,tooltip:this.entity.attribute.style.radius?a.drawutils.MoveRadiusTooltip:a.drawutils.MoveEllipseMajorTooltip,onDrag:function(t,i){var r=n.default.Cartesian3.distance(e.entity.position.getValue(),i),a=Number(r.toFixed(2));a<e.entity.ellipse.semiMinorAxis&&(a=e.entity.ellipse.semiMinorAxis),e.entity.ellipse.semiMajorAxis=new n.default.ConstantProperty(a),e.entity.attribute.style.radius?(e.entity.attribute.style.radius=a,e.entity.ellipse.semiMinorAxis=new n.default.ConstantProperty(a)):e.entity.attribute.style.semiMajorAxis=a,void 0!=e.entity.attribute.style.extrudedHeight&&e.updateHeightDraggers(),e.entity.changeEditing()}});if(r.majorDragger=l,this.draggers.push(l),!this.entity.attribute.style.radius){var u=new n.default.Cartesian3(o.positions[3],o.positions[4],o.positions[5]),c=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:u,clampToGround:this.entity.attribute.style.clampToGround,color:a.drawutils.MovePointColor,tooltip:a.drawutils.MoveEllipseMinorTooltip,onDrag:function(t,i){var r=n.default.Cartesian3.distance(e.entity.position.getValue(),i),a=Number(r.toFixed(2));e.entity.ellipse.semiMajorAxis<a&&(a=e.entity.ellipse.semiMajorAxis),e.entity.ellipse.semiMinorAxis=new n.default.ConstantProperty(a),e.entity.attribute.style.radius?(e.entity.attribute.style.radius=a,e.entity.ellipse.semiMajorAxis=new n.default.ConstantProperty(a)):e.entity.attribute.style.semiMinorAxis=a,void 0!=e.entity.attribute.style.extrudedHeight&&e.updateHeightDraggers(),e.entity.changeEditing()}});r.minorDragger=c,this.draggers.push(c)}void 0!=this.entity.attribute.style.extrudedHeight&&this.initHeightDraggers()},o.prototype.initHeightDraggers=function(){var e=this,t=Number(this.entity.attribute.style.extrudedHeight),i=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:a.drawutils.getPositionsWithHeight(this.entity.position.getValue(),t),clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=n.default.Cartographic.fromCartesian(i);r.height=Number(e.entity.ellipse.height),i=n.default.Cartesian3.fromRadians(r.longitude,r.latitude,r.height),e.entity.position.setValue(i),e.updateDraggers(),e.entity.changeEditing()}});this.heightDraggers.push(i);var r=n.default.EllipseGeometryLibrary.computeEllipsePositions({center:this.entity.position.getValue(),semiMinorAxis:this.entity.ellipse.semiMinorAxis.getValue(),semiMajorAxis:this.entity.ellipse.semiMajorAxis.getValue(),rotation:n.default.Math.toRadians(Number(this.entity.attribute.style.rotation||0)),granularity:2},!0,!1),o=new n.default.Cartesian3(r.positions[0],r.positions[1],r.positions[2]),s=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:a.drawutils.getPositionsWithHeight(o,t),clampToGround:this.entity.attribute.style.clampToGround,color:a.drawutils.MoveHeightPointColor,tooltip:a.drawutils.MoveHeightTooltip,onDrag:function(t,i){var r=n.default.Cartographic.fromCartesian(i);e.entity.ellipse.extrudedHeight=new n.default.ConstantProperty(r.height);var a=r.height-Number(e.entity.ellipse.height);e.entity.attribute.style.extrudedHeight=Number(a.toFixed(2)),e.updateHeightDraggers(),e.entity.changeEditing()},vertical:!0,horizontal:!1});this.heightDraggers.push(s);var l=new n.default.Cartesian3(r.positions[3],r.positions[4],r.positions[5]),u=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:a.drawutils.getPositionsWithHeight(l,t),clampToGround:this.entity.attribute.style.clampToGround,color:a.drawutils.MoveHeightPointColor,tooltip:a.drawutils.MoveHeightTooltip,onDrag:function(t,i){var r=n.default.Cartographic.fromCartesian(i);e.entity.ellipse.extrudedHeight=new n.default.ConstantProperty(r.height);var a=r.height-Number(e.entity.ellipse.height);e.entity.attribute.style.extrudedHeight=Number(a.toFixed(2)),e.updateHeightDraggers(),e.entity.changeEditing()},vertical:!0,horizontal:!1});this.heightDraggers.push(u)},o.prototype.updateDraggers=function(){this.destroy(),this.initDraggers()},o.prototype.updateHeightDraggers=function(){for(var e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[],this.initHeightDraggers()},o.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);if(this.draggers=[],void 0!=this.entity.attribute.style.extrudedHeight){for(e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]}},t.EllipseEditor=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolylineVolumeEditor=void 0;var r=i(0),n=(function(e){e&&e.__esModule}(r),i(1)),a=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];for(var r=t.polylineVolume.positions.getValue(),a=0;a<r.length;a++){var o=r[a],s=n.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:o,onDrag:function(e,i){r[e.index]=i,t.polylineVolume.positions=r,t.changeEditing()}});s.index=a,this.draggers.push(s)}};a.prototype.updateDraggers=function(){for(var e=this.entity.polylineVolume.positions.getValue(),t=0;t<this.draggers.length;t++){var i=e[t];this.draggers[t].position=i}},a.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.PolylineVolumeEditor=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipsoidEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){this.dataSource=e,this.entity=t,this.options=i,this.draggers=[],this.initDraggers()};o.prototype.initDraggers=function(){var e=this,t=this.entity.position.getValue(),i=n.default.Cartographic.fromCartesian(t),r=Number(this.entity.attribute.style.heightRadii)||0;i.height+=r;var o=n.default.Cartesian3.fromRadians(i.longitude,i.latitude,i.height),s=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:o,onDrag:function(t,i){var r=new n.default.Cartesian3;n.default.Cartesian3.subtract(i,e.entity.position.getValue(),r),e.entity.position.setValue(i);var a=n.default.Cartographic.fromCartesian(i);a.height+=Number(e.entity.attribute.style.heightRadii),i=n.default.Cartesian3.fromRadians(a.longitude,a.latitude,a.height),t.position.setValue(i);var o=new n.default.Cartesian3;n.default.Cartesian3.add(t.majorDragger.position.getValue(),r,o),t.majorDragger.position=new n.default.ConstantProperty(o),n.default.Cartesian3.add(t.minorDragger.position.getValue(),r,o),t.minorDragger.position=new n.default.ConstantProperty(o),e.entity.changeEditing()}});this.draggers.push(s);var l=n.default.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:Number(this.entity.attribute.style.extentRadii),semiMinorAxis:Number(this.entity.attribute.style.widthRadii),rotation:n.default.Math.toRadians(0),granularity:2},!0,!1),u=new n.default.Cartesian3(l.positions[0],l.positions[1],l.positions[2]),c=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:u,color:a.drawutils.MovePointColor,tooltip:a.drawutils.MoveEllipseMajorTooltip,onDrag:function(t,i){var r=n.default.Cartesian3.distance(e.entity.position.getValue(),i),a=Number(r.toFixed(2));e.entity.attribute.style.extentRadii=a,e.updateRadii(),e.entity.changeEditing()}});s.majorDragger=c,this.draggers.push(c);var d=new n.default.Cartesian3(l.positions[3],l.positions[4],l.positions[5]),h=a.drawutils.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:d,color:a.drawutils.MovePointColor,tooltip:a.drawutils.MoveEllipseMinorTooltip,onDrag:function(t,i){var r=n.default.Cartesian3.distance(e.entity.position.getValue(),i),a=Number(r.toFixed(2));e.entity.attribute.style.widthRadii=a,e.updateRadii(),e.entity.changeEditing()}});s.minorDragger=h,this.draggers.push(h)},o.prototype.updateRadii=function(){var e=Number(this.entity.attribute.style.extentRadii),t=Number(this.entity.attribute.style.widthRadii),i=Number(this.entity.attribute.style.heightRadii);this.entity.ellipsoid.radii=new n.default.Cartesian3(e,t,i)},o.prototype.updateDraggers=function(){this.destroy(),this.initDraggers()},o.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.EllipsoidEditor=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleExtrudedEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[],this.heightDraggers=[];var r=this,o=0,s=this.getDraggersPositions();for(o=0;o<s.length;o++){var l=s[o];if(void 0!=t.rectangle.height){var u=n.default.Cartographic.fromCartesian(l);u.height+=t.rectangle.height._value,l=n.default.Cartesian3.fromRadians(u.longitude,u.latitude,u.height)}var c=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:l,clampToGround:t.attribute.style.clampToGround,onDrag:function(e,i){e.positions[e.index]=i;var a;a=0==e.index?n.default.Rectangle.fromCartesianArray([i,e.positions[1]]):n.default.Rectangle.fromCartesianArray([i,e.positions[0]]),t.rectangle.coordinates.setValue(a),r.updateDraggers(),t.changeEditing()}});c.index=o,c.positions=s,this.draggers.push(c)}if(t.rectangle.extrudedHeight)for(o=0;o<s.length;o++){var d=s[o],u=n.default.Cartographic.fromCartesian(d);u.height+=t.rectangle.extrudedHeight._value;var l=n.default.Cartesian3.fromRadians(u.longitude,u.latitude,u.height),c=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:l,color:a.drawutils.MoveHeightPointColor,onDrag:function(e,i){var a=n.default.Cartographic.fromCartesian(i);t.rectangle.extrudedHeight=new n.default.ConstantProperty(a.height);var o=Number(a.height)-Number(t.rectangle.height);t.attribute.style.extrudedHeight=Number(o.toFixed(2)),r.updateDraggers(),t.changeEditing()},vertical:!0,horizontal:!1});c.index=o,this.heightDraggers.push(c)}};o.prototype.updateDraggers=function(){var e=this.getDraggersPositions(),t=this.entity.rectangle.extrudedHeight._value,i=0;void 0!=this.entity.rectangle.height&&(i=this.entity.rectangle.height._value);for(var r=0;r<this.heightDraggers.length;r++){var a=e[r],o=this.heightDraggers[r],s=n.default.Cartographic.fromCartesian(a);s.height+=t;var l=n.default.Cartesian3.fromRadians(s.longitude,s.latitude,s.height);o.position=l;var u=this.draggers[r],c=n.default.Cartographic.fromCartesian(a);c.height+=i,l=n.default.Cartesian3.fromRadians(c.longitude,c.latitude,c.height),u.position=l}},o.prototype.getDraggersPositions=function(){var e=this.entity.rectangle.coordinates._value,t=n.default.Rectangle.northwest(e),i=n.default.Rectangle.southeast(e);return n.default.Cartesian3.fromRadiansArray([t.longitude,t.latitude,i.longitude,i.latitude])},o.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);for(this.draggers=[],e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]},t.RectangleExtrudedEditor=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){var r=this;this.dataSource=e,this.entity=t,this.draggers=[];for(var o=this.getDraggersPositions(),s=0;s<o.length;s++){var l=o[s];if(void 0!=t.rectangle.height){var u=n.default.Cartographic.fromCartesian(l);u.height+=t.rectangle.height._value,l=n.default.Cartesian3.fromRadians(u.longitude,u.latitude,u.height)}var c=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:l,clampToGround:t.attribute.style.clampToGround,onDrag:function(e,i){e.positions[e.index]=i;var a;a=0==e.index?n.default.Rectangle.fromCartesianArray([i,e.positions[1]]):n.default.Rectangle.fromCartesianArray([e.positions[0],i]),t.rectangle.coordinates.setValue(a),r.updateDraggers(),t.changeEditing()}});c.index=s,c.positions=o,this.draggers.push(c)}};o.prototype.updateDraggers=function(){var e=this.getDraggersPositions(),t=0;void 0!=this.entity.rectangle.height&&(t=this.entity.rectangle.height._value);for(var i=0;i<this.draggers.length;i++){var r=e[i];if(!this.entity.attribute.style.clampToGround){var a=this.draggers[i],o=n.default.Cartographic.fromCartesian(r);o.height+=t,a.position=n.default.Cartesian3.fromRadians(o.longitude,o.latitude,o.height)}}},o.prototype.getDraggersPositions=function(){var e=this.entity.rectangle.coordinates._value,t=n.default.Rectangle.northwest(e),i=n.default.Rectangle.southeast(e);return n.default.Cartesian3.fromRadiansArray([t.longitude,t.latitude,i.longitude,i.latitude])},o.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.RectangleEditor=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WallEditor=void 0;var r=i(0),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=i(1),o=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[],this.heightDraggers=[];var r=this,o=0,s=t.wall.positions._value;for(o=0;o<s.length;o++){var l=s[o],u=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:l,onDrag:function(e,i){e.positions[e.index]=i,r.updateDraggers(),t.changeEditing()}});u.index=o,u.positions=s,this.draggers.push(u)}if(t.wall.maximumHeights)for(o=0;o<s.length;o++){var c=s[o],d=n.default.Cartographic.fromCartesian(c.clone());d.height=t.wall.maximumHeights._value[o];var l=n.default.Cartesian3.fromRadians(d.longitude,d.latitude,d.height),u=a.drawutils.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:l,color:a.drawutils.MoveHeightPointColor,tooltip:a.drawutils.MoveHeightTooltip,onDrag:function(e,i){var a=n.default.Cartographic.fromCartesian(i),o=r.entity.wall.minimumHeights._value,s=Number(a.height)-Number(o[e.index]);t.attribute.style.extrudedHeight=s.toFixed(2),r.updateDraggers(),t.changeEditing()},vertical:!0,horizontal:!1});u.index=o,this.heightDraggers.push(u)}};o.prototype.updateDraggers=function(){for(var e=this.entity.wall.positions._value,t=this.entity.wall.minimumHeights._value,i=this.entity.wall.maximumHeights._value,r=0;r<this.heightDraggers.length;r++){var o=e[r].clone(),s=this.heightDraggers[r],l=n.default.Cartographic.fromCartesian(o);t[r]=l.height,i[r]=Number(l.height)+Number(this.entity.attribute.style.extrudedHeight),s.position=a.drawutils.getPositionsWithHeight(o,this.entity.attribute.style.extrudedHeight),this.draggers[r].position=o}},o.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);for(this.draggers=[],e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]},t.WallEditor=o},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EventControl=void 0;var n=i(0),a=r(n),o=i(4),s=r(o),l=i(7),u=i(1),c=(i(61),function(e){this.viewer=e});c.prototype.setCursor=function(e){(0,s.default)("#"+this.viewer._container.id).css("cursor",e||"")},c.prototype.createDrawPointHandler=function(e,t){this.setCursor("crosshair");var i=this;e.inProgress=!0;var r=new a.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);return r.setInputAction(function(n){var a=(0,l.getCurrentMousePosition)(i.viewer.scene,n.position,e);a&&(i.setCursor(),e.updatePositions(a),e.inProgress=!1,r.destroy(),i.drawHandler=null,i.pickedEntity=e,e.stopDrawing(),e.startEditing(),t&&t(e))},a.default.ScreenSpaceEventType.LEFT_CLICK),this.drawHandler=r,r},c.prototype.createDrawPolylineHandler=function(e,t,i){this.setCursor("crosshair");var r=this;e.inProgress=!0;var n=new a.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);return n.lastPointTemporary=!1,n.setInputAction(function(a){var o=(0,l.getCurrentMousePosition)(r.viewer.scene,a.position,e);o&&(n.lastPointTemporary&&t.pop(),e.attribute&&e.attribute.addHeight&&(o=u.drawutils.getPositionsWithHeight(o,e.attribute.addHeight)),t.push(o),n.lastPointTemporary=!1,e.attribute&&e.attribute.minMaxPoints&&(t.length==e.attribute.minMaxPoints.min&&t.length==e.attribute.minMaxPoints.max||e.attribute.minMaxPoints.isSuper&&4==t.length)&&(e.inProgress=!1,n.destroy(),r.drawHandler=null,r.pickedEntity=e,r.setCursor(),e.stopDrawing(),e.startEditing(),i&&i(e)),e.changeDrawing())},a.default.ScreenSpaceEventType.LEFT_CLICK),n.setInputAction(function(i){if(i.endPosition){var a=(0,l.getCurrentMousePosition)(r.viewer.scene,i.endPosition,e);a&&(n.lastPointTemporary&&t.pop(),t.push(a),n.lastPointTemporary=!0,e.moveDrawing())}},a.default.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction(function(a){e.inProgress=!1,n.destroy(),r.drawHandler=null,r.pickedEntity=e,r.setCursor(),t.pop(),e.stopDrawing(),e.startEditing(),i&&i(e)},a.default.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.drawHandler=n,n},c.prototype.createDrawPolygonHandler=function(e,t,i){this.setCursor("crosshair");var r=this;e.inProgress=!0;var n=new a.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);return n.lastPointTemporary=!1,n.setInputAction(function(i){var a=(0,l.getCurrentMousePosition)(r.viewer.scene,i.position,e);if(a){if(n.lastPointTemporary&&t.pop(),t.push(a),e.attribute.style.extrudedHeight){var o=u.drawutils.getMaxHeightForPositions(t);e.polygon.extrudedHeight=o+Number(e.attribute.style.extrudedHeight)}n.lastPointTemporary=!1,e.changeDrawing()}},a.default.ScreenSpaceEventType.LEFT_CLICK),n.setInputAction(function(i){if(i.endPosition){var a=(0,l.getCurrentMousePosition)(r.viewer.scene,i.endPosition,e);if(a){if(n.lastPointTemporary&&t.pop(),t.push(a),e.attribute.style.extrudedHeight){var o=u.drawutils.getMaxHeightForPositions(t);e.polygon.extrudedHeight=o+Number(e.attribute.style.extrudedHeight)}n.lastPointTemporary=!0,e.moveDrawing()}}},a.default.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction(function(a){e.inProgress=!1,n.destroy(),r.drawHandler=null,r.setCursor(),r.pickedEntity=e,t.pop(),e.stopDrawing(),e.startEditing(),i&&i(e)},a.default.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.drawHandler=n,n},c.prototype.createTwoPointsModelHandler=function(e,t,i){this.setCursor("crosshair");var r=this;e.inProgress=!0;var n=[],o=new a.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);return o.lastPointTemporary=!1,o.setInputAction(function(s){var u=(0,l.getCurrentMousePosition)(r.viewer.scene,s.position,e);if(u){if(o.lastPointTemporary&&n.pop(),n.push(u),1==n.length&&!e.attribute.style.clampToGround){var c=Number(a.default.Cartographic.fromCartesian(u).height.toFixed(2));e.rectangle.height=c,e.attribute.style.height=c,e.attribute.style.extrudedHeight&&(e.rectangle.extrudedHeight=c+Number(e.attribute.style.extrudedHeight))}if(2==n.length){var d=a.default.Rectangle.fromCartesianArray(n);t.setValue(d)}o.lastPointTemporary=!1,e.changeDrawing(),2==n.length&&(e.inProgress=!1,o.destroy(),r.drawHandler=null,r.setCursor(),r.pickedEntity=e,e.stopDrawing(),e.startEditing(),i&&i(e))}},a.default.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(i){if(i.endPosition){var s=(0,l.getCurrentMousePosition)(r.viewer.scene,i.endPosition,e);if(s){if(o.lastPointTemporary&&n.pop(),n.push(s),2==n.length){var u=a.default.Rectangle.fromCartesianArray(n);t.setValue(u)}o.lastPointTemporary=!0,e.moveDrawing()}}},a.default.ScreenSpaceEventType.MOUSE_MOVE),this.drawHandler=o,o},c.prototype.createDrawWallHandler=function(e,t,i,r,n){this.setCursor("crosshair");var o=this;e.inProgress=!0;var s=new a.default.ScreenSpaceEventHandler(this.viewer.scene.canvas);return s.lastPointTemporary=!1,s.setInputAction(function(n){var u=(0,l.getCurrentMousePosition)(o.viewer.scene,n.position,e);if(u){s.lastPointTemporary&&(t.pop(),i.pop(),r.pop()),t.push(u);var c=a.default.Cartographic.fromCartesian(u),d=Number(c.height.toFixed(2)),h=Number(d)+Number(e.attribute.style.extrudedHeight);i.push(d),r.push(h),s.lastPointTemporary=!1,e.changeDrawing()}},a.default.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction(function(n){if(n.endPosition){var u=(0,l.getCurrentMousePosition)(o.viewer.scene,n.endPosition,e);if(u){s.lastPointTemporary&&(t.pop(),i.pop(),r.pop()),t.push(u);var c=a.default.Cartographic.fromCartesian(u),d=Number(c.height.toFixed(2)),h=Number(d)+Number(e.attribute.style.extrudedHeight);i.push(d),r.push(h),s.lastPointTemporary=!0,e.moveDrawing()}}},a.default.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction(function(a){e.inProgress=!1,s.destroy(),o.drawHandler=null,o.setCursor(),o.pickedEntity=e,t.pop(),i.pop(),r.pop(),e.stopDrawing(),e.startEditing(),n&&n(e)},a.default.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.drawHandler=s,this.pickedEntity=e,s},c.prototype.destroyDrawHandler=function(){this.setCursor(),this.drawHandler&&(this.setCursor(),this.drawHandler.destroy(),this.drawHandler=null)},c.prototype.createEditSelectHandler=function(e){var t=this,i=new a.default.ScreenSpaceEventHandler(this.viewer.canvas);i.setInputAction(function(i){var r=t.viewer.scene.pick(i.position),n=null;if(a.default.defined(r)){var o=a.default.defaultValue(r.id,r.primitive.id);if(o instanceof a.default.Entity){a.default.defaultValue(o.inProgress,!1)||(n=o)}}t.pickedEntity=n,e(n)},a.default.ScreenSpaceEventType.LEFT_CLICK),this.selectHandler=i},c.prototype.createEditDraggerHandler=function(){var e=new a.default.ScreenSpaceEventHandler(this.viewer.canvas);e.dragger=null;var t=this;e.setInputAction(function(i){var r=t.viewer.scene.pick(i.position);if(a.default.defined(r)){var n=r.id;n&&a.default.defaultValue(n._isDragger,!1)&&(n.billboard&&(n.billboard.scale_src=n.billboard.scale._value,n.billboard.scale._value=1.2*n.billboard.scale_src),e.dragger=n,t.viewer.scene.screenSpaceCameraController.enableRotate=!1,t.viewer.scene.screenSpaceCameraController.enableTilt=!1,t.viewer.scene.screenSpaceCameraController.enableTranslate=!1)}},a.default.ScreenSpaceEventType.LEFT_DOWN),e.setInputAction(function(i){var r=t.viewer.scene.pick(i.position);if(a.default.defined(r)){var n=r.id;n&&a.default.defaultValue(n._isDragger,!1)&&(n.billboard&&(n.billboard.scale_src=n.billboard.scale._value,n.billboard.scale._value=1.2*n.billboard.scale_src),e.dragger=n,t.viewer.scene.screenSpaceCameraController.enableRotate=!1,t.viewer.scene.screenSpaceCameraController.enableTilt=!1,t.viewer.scene.screenSpaceCameraController.enableTranslate=!1)}},a.default.ScreenSpaceEventType.LEFT_DOWN,a.default.KeyboardEventModifier.CTRL),e.setInputAction(function(r){if(e.dragger){if(e.dragger.horizontal){var n;if(e.dragger.model){var o=t.viewer.scene,s=o.pick(r.endPosition);if(a.default.defined(s)&&s.id==e.dragger){var u=o.camera.getPickRay(r.endPosition);n=o.globe.pick(u,o)}}null==n&&(n=(0,l.getCurrentMousePosition)(t.viewer.scene,r.endPosition,t.pickedEntity)),n&&(e.dragger.position=n,e.dragger.onDrag&&e.dragger.onDrag(e.dragger,n))}if(e.dragger.vertical){var c=r.endPosition.y-r.startPosition.y,d=e.dragger.position._value,h=new a.default.EllipsoidTangentPlane(d);i.center=d,i.radius=1;var f=t.viewer.scene.frameState.camera.getPixelSize(i,t.viewer.scene.frameState.context.drawingBufferWidth,t.viewer.scene.frameState.context.drawingBufferHeight),p=new a.default.Cartesian3;a.default.Cartesian3.multiplyByScalar(h.zAxis,-c*f,p);var g=a.default.Cartesian3.clone(d);a.default.Cartesian3.add(d,p,g),e.dragger.position=g,e.dragger.onDrag&&e.dragger.onDrag(e.dragger,g)}}},a.default.ScreenSpaceEventType.MOUSE_MOVE);var i=new a.default.BoundingSphere;e.setInputAction(function(r){if(e.dragger&&e.dragger.verticalCtrl){var n=r.endPosition.y-r.startPosition.y,o=e.dragger.position._value,s=new a.default.EllipsoidTangentPlane(o);i.center=o,i.radius=1;var l=t.viewer.scene.frameState.camera.getPixelSize(i,t.viewer.scene.frameState.context.drawingBufferWidth,t.viewer.scene.frameState.context.drawingBufferHeight),u=new a.default.Cartesian3;a.default.Cartesian3.multiplyByScalar(s.zAxis,-n*l,u);var c=a.default.Cartesian3.clone(o);a.default.Cartesian3.add(o,u,c),e.dragger.position=c,e.dragger.onDrag&&e.dragger.onDrag(e.dragger,c)}},a.default.ScreenSpaceEventType.MOUSE_MOVE,a.default.KeyboardEventModifier.CTRL),e.setInputAction(function(){e.dragger&&(e.dragger.billboard&&(e.dragger.billboard.scale._value=e.dragger.billboard.scale_src),e.dragger=null,t.viewer.scene.screenSpaceCameraController.enableRotate=!0,t.viewer.scene.screenSpaceCameraController.enableTilt=!0,t.viewer.scene.screenSpaceCameraController.enableTranslate=!0)},a.default.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(){e.dragger&&(e.dragger.billboard&&(e.dragger.billboard.scale._value=e.dragger.billboard.scale_src),e.dragger=null,t.viewer.scene.screenSpaceCameraController.enableRotate=!0,t.viewer.scene.screenSpaceCameraController.enableTilt=!0,t.viewer.scene.screenSpaceCameraController.enableTranslate=!0)},a.default.ScreenSpaceEventType.LEFT_UP,a.default.KeyboardEventModifier.CTRL),this.draggerHandler=e},c.prototype.destroyEditHandler=function(){this.selectHandler&&(this.selectHandler.destroy(),this.selectHandler=null),this.draggerHandler&&(this.draggerHandler.destroy(),this.draggerHandler=null)},t.EventControl=c},function(e,t,i){(function(e){function r(e,i){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(i)?r.showHidden=i:i&&t._extend(r,i),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=n),s(r,e,r.depth)}function n(e,t){var i=r.styles[t];return i?"["+r.colors[i][0]+"m"+e+"["+r.colors[i][1]+"m":e}function a(e,t){return e}function o(e){var t={};return e.forEach(function(e,i){t[e]=!0}),t}function s(e,i,r){if(e.customInspect&&i&&M(i.inspect)&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var n=i.inspect(r,e);return v(n)||(n=s(e,n,r)),n}var a=l(e,i);if(a)return a;var p=Object.keys(i),g=o(p);if(e.showHidden&&(p=Object.getOwnPropertyNames(i)),P(i)&&(p.indexOf("message")>=0||p.indexOf("description")>=0))return u(i);if(0===p.length){if(M(i)){var m=i.name?": "+i.name:"";return e.stylize("[Function"+m+"]","special")}if(w(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return e.stylize(Date.prototype.toString.call(i),"date");if(P(i))return u(i)}var y="",_=!1,b=["{","}"];if(f(i)&&(_=!0,b=["[","]"]),M(i)){y=" [Function"+(i.name?": "+i.name:"")+"]"}if(w(i)&&(y=" "+RegExp.prototype.toString.call(i)),x(i)&&(y=" "+Date.prototype.toUTCString.call(i)),P(i)&&(y=" "+u(i)),0===p.length&&(!_||0==i.length))return b[0]+y+b[1];if(r<0)return w(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special");e.seen.push(i);var C;return C=_?c(e,i,r,g,p):p.map(function(t){return d(e,i,r,g,t,_)}),e.seen.pop(),h(C,y,b)}function l(e,t){if(b(t))return e.stylize("undefined","undefined");if(v(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}return y(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function c(e,t,i,r,n){for(var a=[],o=0,s=t.length;o<s;++o)D(t,String(o))?a.push(d(e,t,i,r,String(o),!0)):a.push("");return n.forEach(function(n){n.match(/^\d+$/)||a.push(d(e,t,i,r,n,!0))}),a}function d(e,t,i,r,n,a){var o,l,u;if(u=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]},u.get?l=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(l=e.stylize("[Setter]","special")),D(r,n)||(o="["+n+"]"),l||(e.seen.indexOf(u.value)<0?(l=g(i)?s(e,u.value,null):s(e,u.value,i-1),l.indexOf("\n")>-1&&(l=a?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),b(o)){if(a&&n.match(/^\d+$/))return l;o=JSON.stringify(""+n),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+l}function h(e,t,i){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return null==e}function y(e){return"number"==typeof e}function v(e){return"string"==typeof e}function _(e){return"symbol"==typeof e}function b(e){return void 0===e}function w(e){return C(e)&&"[object RegExp]"===L(e)}function C(e){return"object"==typeof e&&null!==e}function x(e){return C(e)&&"[object Date]"===L(e)}function P(e){return C(e)&&("[object Error]"===L(e)||e instanceof Error)}function M(e){return"function"==typeof e}function E(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function L(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}function T(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),F[e.getMonth()],t].join(" ")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function O(e,t){if(!e){var i=new Error("Promise was rejected with a falsy value");i.reason=e,e=i}return t(e)}function k(t){function i(){for(var i=[],r=0;r<arguments.length;r++)i.push(arguments[r]);var n=i.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return n.apply(a,arguments)};t.apply(this,i).then(function(t){e.nextTick(o,null,t)},function(t){e.nextTick(O,t,o)})}if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');return Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.defineProperties(i,A(t)),i}var A=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),i={},r=0;r<t.length;r++)i[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return i},N=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(r(arguments[i]));return t.join(" ")}for(var i=1,n=arguments,a=n.length,o=String(e).replace(N,function(e){if("%%"===e)return"%";if(i>=a)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return e}}),s=n[i];i<a;s=n[++i])g(s)||!C(s)?o+=" "+s:o+=" "+r(s);return o},t.deprecate=function(i,r){function n(){if(!a){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),a=!0}return i.apply(this,arguments)}if(void 0!==e&&!0===e.noDeprecation)return i;if(void 0===e)return function(){return t.deprecate(i,r).apply(this,arguments)};var a=!1;return n};var I,R={};t.debuglog=function(i){if(b(I)&&(I=e.env.NODE_DEBUG||""),i=i.toUpperCase(),!R[i])if(new RegExp("\\b"+i+"\\b","i").test(I)){var r=e.pid;R[i]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",i,r,e)}}else R[i]=function(){};return R[i]},t.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=m,t.isNumber=y,t.isString=v,t.isSymbol=_,t.isUndefined=b,t.isRegExp=w,t.isObject=C,t.isDate=x,t.isError=P,t.isFunction=M,t.isPrimitive=E,t.isBuffer=i(63);var F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",T(),t.format.apply(t,arguments))},t.inherits=i(64),t._extend=function(e,t){if(!t||!C(t))return e;for(var i=Object.keys(t),r=i.length;r--;)e[i[r]]=t[i[r]];return e};var j="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;t.promisify=function(e){function t(){for(var t,i,r=new Promise(function(e,r){t=e,i=r}),n=[],a=0;a<arguments.length;a++)n.push(arguments[a]);n.push(function(e,r){e?i(e):t(r)});try{e.apply(this,n)}catch(e){i(e)}return r}if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(j&&e[j]){var t=e[j];if("function"!=typeof t)throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,j,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),j&&Object.defineProperty(t,j,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,A(e))},t.promisify.custom=j,t.callbackify=k}).call(t,i(62))},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(e){if(c===setTimeout)return setTimeout(e,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function a(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function o(){g&&f&&(g=!1,f.length?p=f.concat(p):m=-1,p.length&&s())}function s(){if(!g){var e=n(o);g=!0;for(var t=p.length;t;){for(f=p,p=[];++m<t;)f&&f[m].run();m=-1,t=p.length}f=null,g=!1,a(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,d,h=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var f,p=[],g=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new l(e,t)),1!==p.length||g||n(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.prependListener=u,h.prependOnceListener=u,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.FlowEcharts=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(0),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=o.default.Math.toRadians(80),l=function(){function e(t,i){r(this,e),this._GLMap=t,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=i}return n(e,[{key:"setMapOffset",value:function(e){this._mapOffset=e}},{key:"getBMap",value:function(){return this._GLMap}},{key:"dataToPoint",value:function(e){var t=[99999,99999],i=o.default.Cartesian3.fromDegrees(e[0],e[1]);if(!i)return t;var r=this._GLMap.cartesianToCanvasCoordinates(i);if(!r)return t;var n=this._GLMap;if(n.mode===o.default.SceneMode.SCENE3D){if(o.default.Cartesian3.angleBetween(n.camera.position,i)>s)return!1}return[r.x-this._mapOffset[0],r.y-this._mapOffset[1]]}},{key:"pointToData",value:function(e){var t=this._mapOffset,e=this._bmap.project([e[0]+t[0],e[1]+t[1]]);return[e.lng,e.lat]}},{key:"getViewRect",value:function(){var e=this._api;return new echarts.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())}},{key:"getRoamTransform",value:function(){return echarts.matrix.create()}}]),e}();l.dimensions=["lng","lat"],l.create=function(e,t){var i;e.eachComponent("GLMap",function(e){var r=t.getZr().painter;if(r){var n=(r.getViewportRoot(),echarts.glMap);i=new l(n,t),i.setMapOffset(e.__mapOffset||[0,0]),e.coordinateSystem=i}}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=i)})},window.echarts&&(echarts.registerCoordinateSystem("GLMap",l),echarts.registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),echarts.extendComponentModel({type:"GLMap",getBMap:function(){return this.__GLMap},defaultOption:{roam:!1}}),echarts.extendComponentView({type:"GLMap",init:function(e,t){this.api=t,echarts.glMap.postRender.addEventListener(this.moveHandler,this)},moveHandler:function(e,t){this.api.dispatchAction({type:"GLMapRoam"})},render:function(e,t,i){},dispose:function(e){echarts.glMap.postRender.removeEventListener(this.moveHandler,this)}}));t.FlowEcharts=function(){function e(t,i){r(this,e),this._mapContainer=t,this._overlay=this._createChartOverlay(),this._overlay.setOption(i)}return n(e,[{key:"_createChartOverlay",value:function(){var e=this._mapContainer.scene;e.canvas.setAttribute("tabIndex",0);var t=document.createElement("div");return t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.width+"px",t.style.height=e.canvas.height+"px",t.style.pointerEvents="none",t.setAttribute("id","echarts"),t.setAttribute("class","echartMap"),this._mapContainer.container.appendChild(t),this._echartsContainer=t,echarts.glMap=e,echarts.init(t)}},{key:"dispose",value:function(){this._echartsContainer&&(this._mapContainer.container.removeChild(this._echartsContainer),this._echartsContainer=null),this._overlay&&(this._overlay.dispose(),this._overlay=null)}},{key:"destroy",value:function(){this.dispose()}},{key:"updateOverlay",value:function(e){this._overlay&&this._overlay.setOption(e)}},{key:"getMap",value:function(){return this._mapContainer}},{key:"getOverlay",value:function(){return this._overlay}},{key:"show",value:function(){document.getElementById(this._id).style.visibility="visible"}},{key:"hide",value:function(){document.getElementById(this._id).style.visibility="hidden"}}]),e}()},function(e,t,i){"use strict";function r(e){e=s(e,s.EMPTY_OBJECT),this._definitionChanged=new c,this._color=void 0,this._colorSubscription=void 0,this.color=e.color||p,this._duration=e.duration||1e3;var t=r.getImageMaterial(e.url,e.repeat);this._materialType=t.type,this._materialImage=t.image,this._time=void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationLineMaterialProperty=void 0;var n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=a.default.Color,s=a.default.defaultValue,l=a.default.defined,u=a.default.defineProperties,c=a.default.Event,d=a.default.createPropertyDescriptor,h=a.default.Property,f=a.default.Material,p=new a.default.Color(0,0,0,0);u(r.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:d("color")}),r.prototype.getType=function(e){return this._materialType},r.prototype.getValue=function(e,t){return l(t)||(t={}),t.color=h.getValueOrClonedDefault(this._color,e,p,t.color),t.image=this._materialImage,void 0===this._time&&(this._time=e.secondsOfDay),t.time=1e3*(e.secondsOfDay-this._time)/this._duration,t},r.prototype.equals=function(e){return this===e||e instanceof r&&h.equals(this._color,e._color)};var g=0;r.getImageMaterial=function(e,t){g++;var i="AnimationLine"+g+"Type",r="AnimationLine"+g+"Image";return f[i]=i,f[r]=e,f._materialCache.addMaterial(f[i],{fabric:{type:f.PolylineArrowLinkType,uniforms:{color:new o(1,0,0,1),image:f[r],time:0,repeat:t||new a.default.Cartesian2(1,1)},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                        {\n                            czm_material material = czm_getDefaultMaterial(materialInput);\n                            vec2 st = repeat * materialInput.st;\n                            vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n                            if(color.a == 0.0)\n                            {\n                                material.alpha = colorImage.a;\n                                material.diffuse = colorImage.rgb; \n                            }\n                            else\n                            {\n                                material.alpha = colorImage.a * color.a;\n                                material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                            }\n                            return material;\n                        }"},translucent:function(){return!0}}),{type:f[i],image:f[r]}},t.AnimationLineMaterialProperty=r},function(e,t,i){"use strict";function r(e){e=s(e,s.EMPTY_OBJECT),this._definitionChanged=new c,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this._time=void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.ElliposidFadeMaterialProperty=void 0;var n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=a.default.Color,s=a.default.defaultValue,l=a.default.defined,u=a.default.defineProperties,c=a.default.Event,d=a.default.createPropertyDescriptor,h=a.default.Property,f=a.default.Material,p=o.WHITE;u(r.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:d("color")}),r.prototype.getType=function(e){return f.EllipsoidFadeType},r.prototype.getValue=function(e,t){return l(t)||(t={}),t.color=h.getValueOrClonedDefault(this._color,e,p,t.color),void 0===this._time&&(this._time=e.secondsOfDay),t.time=e.secondsOfDay-this._time,t},r.prototype.equals=function(e){return this===e||e instanceof r&&h.equals(this._color,e._color)};var f=a.default.Material;f.EllipsoidFadeType="EllipsoidFade",f._materialCache.addMaterial(f.EllipsoidFadeType,{fabric:{type:f.EllipsoidFadeType,uniforms:{color:new o(1,0,0,1),time:1},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    material.diffuse = 1.5 * color.rgb;\n                    vec2 st = materialInput.st;\n                    float dis = distance(st, vec2(0.5, 0.5));\n                    float per = fract(time);\n                    if(dis > per * 0.5){\n                        //material.alpha = 0.0;\n                        discard;\n                    }else {\n                            material.alpha = color.a  * dis / per / 2.0;\n                    }\n                    return material;\n                }"},translucent:function(){return!0}}),t.ElliposidFadeMaterialProperty=r},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseWidget=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(4),o=r(a),s=i(5),l=r(s),u=i(28),c=i(27),d=[],h=l.default.Class.extend({viewer:null,options:{},config:{},path:"",isActivate:!1,isCreate:!1,initialize:function(e,t){this.viewer=t,this.config=e,this.path=e.path||"",this.init()},addCacheVersion:function(e){if(null==e)return e;var t=(0,c.getCacheVersion)();return t&&(-1==e.indexOf("?")?e+="?time="+t:-1==e.indexOf("time="+t)&&(e+="&time="+t)),e},activateBase:function(){var e=this;if(this.isActivate)return void this.changeWidgetView(function(e){e._dom&&((0,o.default)(".layui-layer").each(function(){(0,o.default)(this).css("z-index",19891e3)}),(0,o.default)(e._dom).css("z-index",19891014))});if(this.beforeActivate(),this.isActivate=!0,!this.isCreate){if(this.options.resources&&this.options.resources.length>0){for(var t=[],i=0;i<this.options.resources.length;i++){var r=this.options.resources[i];r=this._getUrl(r),-1==d.indexOf(r)&&t.push(r)}return d=d.concat(t),void u.Loader.async(t,function(){if(!e.create(function(){e._createWidgetView(),e.isCreate=!0})){if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);e._createWidgetView(),e.isCreate=!0}})}if(this.create(function(){e._createWidgetView(),this.isCreate=!0}))return;if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);this.isCreate=!0}return this._createWidgetView(),this},_createWidgetView:function(){var e=this.options.view;if(void 0===e||null===e)this._startActivate();else if(l.default.Util.isArray(e)){this._viewcreate_allcount=e.length,this._viewcreate_okcount=0;for(var t=0;t<e.length;t++)this.createItemView(e[t])}else this._viewcreate_allcount=1,this._viewcreate_okcount=0,this.createItemView(e)},changeWidgetView:function(e){var t=this.options.view;if(void 0===t||null===t)return!1;if(l.default.Util.isArray(t)){for(var i=!1,r=0;r<t.length;r++)i=i||e(t[r]);return i}return e(t)},createItemView:function(e){switch(e.type){default:case"window":this._openWindow(e);break;case"divwindow":this._openDivWindow(e);break;case"append":this._appendView(e);break;case"custom":var t=this._getUrl(e.url),i=this;e.open(t,function(t){i.winCreateOK(e,t),++i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(t)},this)}},_viewcreate_allcount:0,_viewcreate_okcount:0,_openWindow:function(e){var t=this,i=this._getUrl(e.url),r={type:2,content:[i,"no"],success:function(r){e._layerOpening=!1,e._dom=r;var n=window[r.find("iframe")[0].name];t.config.hasOwnProperty("visible")&&!t.config.visible&&(0,o.default)(r).hide(),layer.setTop(r),t.winCreateOK(e,n),t._viewcreate_okcount++,t._viewcreate_okcount>=t._viewcreate_allcount&&t._startActivate(r),n&&n.initWidgetView?n.initWidgetView(t):console.error(i+"页面没有定义function initWidgetView(widget)方法，无法初始化widget页面!")}};e._layerIdx,e._layerOpening=!0,e._layerIdx=layer.open(this._getWinOpt(e,r))},_openDivWindow:function(e){var t=this._getUrl(e.url),i=this;this.getHtml(t,function(t){var r={type:1,content:t,success:function(t){e._layerOpening=!1,e._dom=t,i.config.hasOwnProperty("visible")&&!i.config.visible&&(0,o.default)(t).hide(),layer.setTop(t),i.winCreateOK(e,t),++i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(t)}};e._layerOpening=!0,e._layerIdx=layer.open(i._getWinOpt(e,r))})},_getUrl:function(e){return e=this.addCacheVersion(e),e.startsWith("/")||e.startsWith(".")||e.startsWith("http")?e:this.path+e},_getWinOpt:function(e,t){var i=(0,c.getDefWindowOptions)(),r=o.default.extend(i,e.windowOptions);r=o.default.extend(r,this.config.windowOptions),e.windowOptions=r;var n=this,a=this._getWinSize(r),s={title:!r.noTitle&&(this.config.name||" "),area:a.area,offset:a.offset,shade:0,maxmin:!1,zIndex:layer.zIndex,end:function(){e._layerIdx=-1,e._dom=null,n.disableBase()},full:function(e){n.winFull(e)},min:function(e){n.winMin(e)},restore:function(e){n.winRestore(e)}},l=o.default.extend(s,r);return o.default.extend(l,t||{})},_getWinSize:function(e){var t=this.bfb2Number(e.width,document.documentElement.clientWidth,e),i=this.bfb2Number(e.height,document.documentElement.clientHeight,e),r="",a=e.position;if(a)if("string"==typeof a)r=a;else if("object"==(void 0===a?"undefined":n(a))){var o,s;if(a.hasOwnProperty("top")&&null!=a.top&&(o=this.bfb2Number(a.top,document.documentElement.clientHeight,e)),a.hasOwnProperty("bottom")&&null!=a.bottom){e._hasresize=!0;var l=this.bfb2Number(a.bottom,document.documentElement.clientHeight,e);null!=o?i=document.documentElement.clientHeight-o-l:o=document.documentElement.clientHeight-i-l}if(a.hasOwnProperty("left")&&null!=a.left&&(s=this.bfb2Number(a.left,document.documentElement.clientWidth,e)),a.hasOwnProperty("right")&&null!=a.right){e._hasresize=!0;var u=this.bfb2Number(a.right,document.documentElement.clientWidth,e);null!=s?t=document.documentElement.clientWidth-s-u:s=document.documentElement.clientWidth-t-u}null==o&&(o=(document.documentElement.clientHeight-i)/2),null==s&&(s=(document.documentElement.clientWidth-t)/2),r=[o+"px",s+"px"]}e.hasOwnProperty("minHeight")&&i<e.minHeight&&(e._hasresize=!0,i=e.minHeight),e.hasOwnProperty("maxHeight")&&i>e.maxHeight&&(e._hasresize=!0,i=e.maxHeight),e.hasOwnProperty("minHeight")&&t<e.minWidth&&(e._hasresize=!0,t=e.minWidth),e.hasOwnProperty("maxWidth")&&t>e.maxWidth&&(e._hasresize=!0,t=e.maxWidth);var c;return c=t&&i?[t+"px",i+"px"]:t+"px",{area:c,offset:r}},bfb2Number:function(e,t,i){return"string"==typeof e&&-1!=e.indexOf("%")?(i._hasresize=!0,t*Number(e.replace("%",""))/100):e},_appendView:function(e){if(this.isCreate&&e._dom)(0,o.default)(e._dom).show({duration:500}),this._startActivate(e._dom);else{var t=this._getUrl(e.url),i=this;i.getHtml(t,function(t){e._dom=(0,o.default)(t).appendTo(e.parent||"body"),i.winCreateOK(e,t),++i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(t)})}},disableBase:function(){if(this.isActivate){this.beforeDisable();this.changeWidgetView(function(e){return null!=e._layerIdx&&-1!=e._layerIdx?(e._layerOpening,layer.close(e._layerIdx),!0):("append"==e.type&&e._dom&&(0,o.default)(e._dom).hide({duration:1e3}),"custom"==e.type&&e.close&&e.close(),!1)})||(this.disable(),this.isActivate=!1)}},setViewVisible:function(e){this.changeWidgetView(function(t){null!=t._layerIdx&&-1!=t._layerIdx?e?(0,o.default)("#layui-layer"+t._layerIdx).show():(0,o.default)("#layui-layer"+t._layerIdx).hide():"append"==t.type&&t._dom&&(e?(0,o.default)(t._dom).show():(0,o.default)(t._dom).hide())})},setViewCss:function(e){this.changeWidgetView(function(t){null!=t._layerIdx&&-1!=t._layerIdx?(0,o.default)("#layui-layer"+t._layerIdx).css(e):"append"==t.type&&t._dom&&(0,o.default)(t._dom).css(e)})},indexResize:function(){if(this.isActivate){var e=this;this.changeWidgetView(function(t){if(null!=t._layerIdx&&-1!=t._layerIdx&&null!=t.windowOptions&&t.windowOptions._hasresize){var i=e._getWinSize(t.windowOptions),r={width:i.area[0],height:i.area[1],top:i.offset[0],left:i.offset[1]};(0,o.default)(t._dom).attr("myTopLeft",!0),layer.style(t._layerIdx,r),"divwindow"==t.type&&layer.iframeAuto(t._layerIdx)}})}},_startActivate:function(e){this.activate(e),this.config.success&&this.config.success(this),this.isActivate||this.disableBase()},init:function(){},create:function(e){},beforeActivate:function(){},activate:function(e){},beforeDisable:function(){},disable:function(){},winCreateOK:function(e,t){},winFull:function(){},winMin:function(){},winRestore:function(){},getHtml:function(e,t){o.default.ajax({url:e,type:"GET",dataType:"html",timeout:0,success:function(e){t(e)}})}});t.BaseWidget=h}])});